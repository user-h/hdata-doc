---
title: 华为高斯数据库
date: 2022-07-21 11:18:24
permalink: /pages/e461e3/
---

#### 简介

GaussDB(for openGauss)是基于华为主导的openGauss生态推出的企业级分布式关系型数据库。该产品具备企业级复杂事务混合负载能力，同时支持分布式事务，同城跨AZ部署，数据0丢失，支持1000+的扩展能力，PB级海量存储。

目前官方收费版本：（2019年10月左右，命名再次调整）

- gaussdb 100，更名为 GaussDB T (以OLTP和集群为方向，在线事务处理）
- gaussdb 200 合并 300 的部分设计，更名为 GaussDB A (主打OLAP 在线分析处理）
- gaussdb 300 型号取消，涉及功能并入 100 或 200

目前免费开源版本：openGauss

#### 关于数据迁移

GaussDB 最初是由 PostgreSQL 开源项目自研而来，虽几乎已经是全部自研，但还保留了驱动包以及驱动类。

官方提供了3个驱动包：（任意一个都行，但需注意冲突问题）
1. gsjdbc4.jar：驱动类为 `org.postgresql.Driver` 
> 与 PostgreSQL 驱动类名一样，在无 PostgreSQL 时使用
2. gsjdbc200.jar：驱动类为 `com.huawei.gauss200.jdbc.Driver`
> 解决类名冲突问题，项目中同时有 PostgreSQL 和 GaussDB 时使用
3. openguassjdbc.jar：驱动类为 `com.huawei.opengauss.jdbc.Driver`

任意一个驱动类都行，可以通过使用 gsjdbc4.jar 替换 Datax、Kettle 等工具中 PostgreSQL 驱动包，来使其支持 GaussDB，从而进行数据迁移。

#### 常用SQL

##### 查询所有模式

```sql
SELECT
            pn.oid AS schema_oid
           ,iss.CATALOG_NAME
           ,iss.schema_owner
           ,iss.SCHEMA_NAME 
      FROM information_schema.schemata iss
INNER JOIN pg_namespace pn 
        ON pn.nspname = iss.SCHEMA_NAME;
```

##### 查询当前模式下的所有表名以及中文注释

```sql
SELECT DISTINCT "table_name", obj_description ( oid, 'pg_class' ) AS table_alias 
  FROM information_schema.tables t1, pg_class t2 
 WHERE table_schema = 'gisdb' 
   AND t1."table_name" = t2.relname
```


##### 表名查询字段属性

```sql
# 方式1：（支持查询指定模式schema下某张表的字段信息）
    SELECT u.relname, a.attname AS field, t.typname AS type
      FROM (select c.relname,c.oid,n.nspname from pg_class c left join pg_catalog.pg_namespace n on c.relnamespace = n.oid) u,
           pg_attribute a,
           pg_type t
     WHERE u.relname = '实际的表名'
       AND u.nspname = '实际的schema名称'
       AND a.attnum > 0
       AND a.attrelid = u.oid
       AND a.atttypid = t.oid
  ORDER BY a.attnum;
  
# 方式:2：
    SELECT a.attnum, a.attname AS field, t.typname AS type, a.attlen AS length, a.atttypmod AS lengthvar, a.attnotnull AS notnull, b.description AS comment
      FROM pg_class c, pg_attribute a
 LEFT JOIN pg_description b
        ON a.attrelid = b.objoid
       AND a.attnum = b.objsubid, pg_type t
     WHERE c.relname = '实际的表名'
       AND a.attnum > 0
       AND a.attrelid = c.oid
       AND a.atttypid = t.oid
  ORDER BY a.attnum;
```


#### 踩坑日记

##### date 字段类型

> 由于 date 字段类型不存储时分秒（Oracle模式下？），故需修改为 timestamp 类型，所有表及视图都需要重新创建。
