---
title: Python操作Office
date: 2022-02-27 15:35:17
permalink: /pages/f2a340/
---
## 读写Word

前提：

```python
# 导入包
from docx import Document
from docx.shared import Inches  #英寸
```

### 文本

- 文本操作（基础）

```python
# 在末尾添加段落
paragraph = document.add_paragraph('Lorem ipsum dolor sit amet.')
# 在标识之前添加段落
prior_paragraph = paragraph.insert_paragraph_before('Lorem ipsum')
# 添加标题（默认1级）
document.add_heading('The REAL meaning of the universe')
# 添加2级标题
document.add_heading('The role of dolphins', level=2)
# 添加分页符
document.add_page_break()

```

- 段落样式

```python
# 添加段落时设置样式
document.add_paragraph('Lorem ipsum dolor sit amet.', style='ListBullet')

# 添加段落后设置样式
paragraph = document.add_paragraph('Lorem ipsum dolor sit amet.')
paragraph.style = 'List Bullet'

# 通过run的两个属性来设置粗体和斜体
paragraph = document.add_paragraph('Lorem ipsum ')
run = paragraph.add_run('dolor')
run.bold = True # == paragraph.add_run('dolor').bold = True
paragraph.add_run(' sit amet.')

```

- 字体样式

```python
paragraph = document.add_paragraph('Normal text, ')
paragraph.add_run('text with emphasis.', 'Emphasis')

# 等价于

paragraph = document.add_paragraph('Normal text, ')
run = paragraph.add_run('text with emphasis.')
run.style = 'Emphasis'
```

### 表格

- 表格操作（基础）

```python
# 添加一个2行2列的表格
table = document.add_table(rows=2, cols=2)
# 获取单元格
cell = table.cell(0, 1)
# 单元格赋值
cell.text = 'parrot, possibly dead'
# 获取一行
row = table.rows[1]
# 添加一行
row = table.add_row()
# 添加样式
table.style = 'LightShading-Accent1'

```

示例：将数组的数据放入表格
```python
# get table data -------------
items = (
(7, '1024', 'Plush kittens'),
(3, '2042', 'Furbees'),
(1, '1288', 'French Poodle Collars, Deluxe'),

# add table ------------------
table = document.add_table(1, 3)
# populate header row --------
heading_cells = table.rows[0].cells
heading_cells[0].text = 'Qty'
heading_cells[1].text = 'SKU'
heading_cells[2].text = 'Description'
# add a data row for each item
for item in items:
cells = table.add_row().cells
cells[0].text = str(item.qty)
cells[1].text = item.sku
cells[2].text = item.desc
```

- 读取表格

```python
path = "text\\预算管理一体化地债系统数据库设计(代码集).docx"
document = Document(path)  # 读入文件
tables = document.tables   # 获取文件中的表格集
table = tables[1]  # 获取文件中的第一个表格

# 遍历表格内容
for i in range(0, len(table.rows)):  # 从表格第一行开始循环读取表格数据
    for j in range(0, len(table.columns)):
        print(table.cell(i,j).text, end = '\t')
    print('', end = '\n')
```

### 图片

- 图片操作（基础）

```python
# 添加图片
document.add_picture('image-filename.png')
# 添加图片时设置图片大小
document.add_picture('image-filename.png', width=Inches(1.0))

```

### 文档

- 文档操作（基础）

```python
# 新建文件
from docx import Document
document = Document()
document.save('test.docx')

# 流式读写？？？
f = open('foobar.docx', 'rb')
document = Document(f)
f.close()


with open('foobar.docx', 'rb') as f:
source_stream = StringIO(f.read())
document = Document(source_stream)
source_stream.close()
...
target_stream = StringIO()
document.save(target_stream)
```

- 文本对齐

```python
# 从父级元素继承
from docx.enum.text import WD_ALIGN_PARAGRAPH
document = Document()
paragraph = document.add_paragraph()
paragraph_format = paragraph.paragraph_format
paragraph_format.alignment
# None# indicating alignment is inherited from the style hierarc

# 从对象获取值
paragraph_format.alignment = WD_ALIGN_PARAGRAPH.CENTER
paragraph_format.alignment
# CENTER (1)
```

- 左右（首行）缩进

```python
# 左缩进
from docx.shared import Inches
paragraph = document.add_paragraph()
paragraph_format = paragraph.paragraph_format
paragraph_format.left_indent
# None # indicating indentation is inherited from the style hierarchy
paragraph_format.left_indent = Inches(0.5)
paragraph_format.left_indent
# 457200
paragraph_format.left_indent.inches
# 0.5

# 右缩进
from docx.shared import Pt
paragraph_format.right_indent
# None
paragraph_format.right_indent = Pt(24)
paragraph_format.right_indent
# 304800
paragraph_format.right_indent.pt
# 24.0


# 首行缩进
paragraph_format.first_line_indent
#None
paragraph_format.first_line_indent = Inches(-0.25)
paragraph_format.first_line_indent
# -228600
paragraph_format.first_line_indent.inches
# -0.25
```

- 制表符（见文档）
- 段间距（见文档）
- 行间距（见文档）
- 分页（见文档）
- 字体格式和颜色（见文档）

```python
from docx import Document
document = Document()
run = document.add_paragraph().add_run()
font = run.font

from docx.shared import Pt
font.name = 'Calibri'
font.size = Pt(12)
```
- sections（见文档）
- 页眉页脚（见文档）


### 按顺序读取doc文档

```python
import os
import docx

from docx.document import Document
from docx.oxml.table import CT_Tbl
from docx.oxml.text.paragraph import CT_P
from docx.table import _Cell, Table
from docx.text.paragraph import Paragraph


def iter_block_items(parent):
    """
    Yield each paragraph and table child within *parent*, in document order.
    Each returned value is an instance of either Table or Paragraph. *parent*
    would most commonly be a reference to a main Document object, but
    also works for a _Cell object, which itself can contain paragraphs and tables.
    """
    if isinstance(parent, Document):
        parent_elm = parent.element.body
    elif isinstance(parent, _Cell):
        parent_elm = parent._tc
    else:
        raise ValueError("something's not right")

    for child in parent_elm.iterchildren():
        if isinstance(child, CT_P):
            yield Paragraph(child, parent)
        elif isinstance(child, CT_Tbl):
            yield Table(child, parent)


def read_table(table):
    return [[cell.text for cell in row.cells] for row in table.rows]


def read_word(word_path):
    doc = docx.Document(word_path)
    for block in iter_block_items(doc):
        if isinstance(block, Paragraph):
            print("text", [block.text])
        elif isinstance(block, Table):
            print("table", read_table(block))


if __name__ == '__main__':
    ROOT_DIR_P = os.path.abspath(os.path.dirname(os.path.dirname(__file__)))  # 项目根目录
    word_path = os.path.join(ROOT_DIR_P, "data/test_to_word.docx")  # pdf文件路径及文件名
    # word_path = os.path.join(ROOT_DIR_P, "data/test_to_word2.docx")  # pdf文件路径及文件名
    read_word(word_path)

```
