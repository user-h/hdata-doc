
### å¸¸ç”¨å‘½ä»¤

#### å¯åŠ¨æœåŠ¡

```shell
# å•èŠ‚ç‚¹å¯åŠ¨
./bin/kafka-server-start.sh -daemon config/server.properties
```

CDH å®‰è£…kafkaéœ€ä¿®æ”¹é…ç½®ï¼š
- zookeeper.chrootï¼škafkaåœ¨zookeeperèŠ‚ç‚¹çš„å­˜å‚¨ä½ç½®
- kafka.properties çš„Kafka Brokeré«˜çº§é…ç½®ä»£ç ï¼ˆé…ç½®ç›‘å¬ï¼‰ï¼šlisteners=PLAINTEXT://:9092


#### ğŸ“Œ Topic ç®¡ç†

ä¸¤ç§åˆ›å»ºtopicæ–¹å¼ï¼Œä¸€ç§offsetå­˜å‚¨åˆ°zookeeperï¼Œå¦ä¸€ç§offsetå­˜å‚¨åˆ°kafkaçš„é»˜è®¤topic

**é€šè¿‡--zookeeperé€‰é¡¹æŒ‡å®šZookeeperçš„åœ°å€**

|åŠŸèƒ½| å‘½ä»¤                                                                                                |
|---|---------------------------------------------------------------------------------------------------|
|æŸ¥çœ‹æ‰€æœ‰ Topic| `kafka-topics --zookeeper banana:2181[/kafka] --list`                                             |
|æŸ¥çœ‹ Topic è¯¦æƒ…| `kafka-topics --zookeeper 10.221.70.124:2181 --describe --topic test`                             |
|åˆ›å»º Topic| `kafka-topics --zookeeper banana:2181 --create --topic test --partitions 1 --replication-factor 2` |
|åˆ é™¤ Topic| `kafka-topics --zookeeper banana:2181 --delete --topic test`                                      |


**é€šè¿‡--bootstrap-serveré€‰é¡¹æŒ‡å®šKafka brokerçš„åœ°å€**

--bootstrapå’Œ--zookeeperéƒ½å¯ä»¥ï¼Œä½†å®˜æ–¹æ¨èä½¿ç”¨Kafkaçš„bootstrap-serveræ¥åˆ›å»ºä¸»é¢˜ï¼Œå› ä¸ºè¿™æ˜¯Kafkaæœªæ¥å‘å±•çš„æ–¹å‘ï¼Œä¹Ÿæ˜¯æ›´ç¨³å®šã€æ›´é«˜æ•ˆçš„åšæ³•ã€‚

|åŠŸèƒ½| å‘½ä»¤                                                                                                |
|---|---------------------------------------------------------------------------------------------------|
|æŸ¥çœ‹æ‰€æœ‰ Topic| `kafka-topics --list --bootstrap-server banana:9092`                                              |
|æŸ¥çœ‹ Topic è¯¦æƒ…| `kafka-topics --describe --topic topic1 --bootstrap-server banana:9092`                           |
|åˆ›å»º Topic| `kafka-topics --create --topic test --partitions 3 --replication-factor 1 --bootstrap-server banana:9092` |
|åˆ é™¤ Topic| `kafka-topics --delete --topic test --bootstrap-server banana:9092`                               |

---

#### ğŸ“Œ ç”Ÿäº§è€… & æ¶ˆè´¹è€…ï¼ˆsaslè®¤è¯éœ€è¦åŠ --xxx.config /xx/xxx.propertiesï¼‰

| åŠŸèƒ½            | å‘½ä»¤                                                                                                                                            |
|---------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| å¯åŠ¨ç”Ÿäº§è€…ï¼ˆå†™æ¶ˆæ¯ï¼‰    | `kafka-console-producer --topic test --broker-list banana:9092 [--producer.config /etc/kafka/conf/producer.properties]`                       |
| å¯åŠ¨æ¶ˆè´¹è€…ï¼ˆè¯»æ¶ˆæ¯ï¼‰    | `kafka-console-consumer --topic test --from-beginning --bootstrap-server banana:9092 [--consumer.config /etc/kafka/conf/consumer.properties]` |
| æŒ‡å®šæ¶ˆè´¹è€…ç»„  | `kafka-console-consumer --topic test --consumer-property group.id=group1 --bootstrap-server banana:9092`                                      |
| æŒ‡å®šæ¶ˆè´¹è€…ç»„å¹¶é™åˆ¶æ¶ˆæ¯æ•°  | `kafka-console-consumer --topic test --group group1 --from-beginning --max-messages 100 --bootstrap-server banana:9092`                       |
| æ¶ˆè´¹è€…ä»æŒ‡å®šä½ç½®å¼€å§‹æ¶ˆè´¹  | `kafka-console-consumer --topic test --offset 10 --partition 0 --bootstrap-server banana:9092`                                                |
| æŸ¥çœ‹æ¶ˆè´¹è€…ç»„åˆ—è¡¨      | `kafka-consumer-groups --list --bootstrap-server banana:9092 [--command-config /etc/kafka/conf/consumer.properties]`                                                                              |
| æŸ¥çœ‹æ¶ˆè´¹è€…ç»„è¯¦æƒ…      | `kafka-consumer-groups --describe --group group1 --bootstrap-server banana:9092`                                                              |
| é‡ç½®æ¶ˆè´¹è€…ç»„ offset | `kafka-consumer-groups --bootstrap-server banana:9092 --group group1 --reset-offsets --to-earliestã€--to-latestã€‘ --execute --topic test`       |


---

#### ğŸ“Œ SASL ç”¨æˆ·ç®¡ç†ï¼ˆSCRAMï¼‰

> âš ï¸ å‰æï¼šKafka å¼€å¯ **SASL/SCRAM** è®¤è¯

entity-typeï¼š[List(topics, clients, users, brokers)]

| åŠŸèƒ½       | å‘½ä»¤                                                                                                                                                                                                                 |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| æ·»åŠ ç”¨æˆ·     | `kafka-configs --zookeeper banana:2181/kafka --alter --add-config 'SCRAM-SHA-256=[iterations=4096,password=admin-sec],SCRAM-SHA-512=[iterations=4096,password=admin-sec]' --entity-type users --entity-name admin` |
| æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨   | `kafka-configs --zookeeper banana:2181 --describe --entity-type users`                                                                                                                                             |
| æŸ¥çœ‹ç”¨æˆ·é…ç½®   | `kafka-configs --zookeeper banana:2181 --describe --entity-type users --entity-name admin`                                                                                                                         |
| åˆ é™¤ç”¨æˆ·     | `kafka-configs --zookeeper banana:2181 --alter --delete-config 'SCRAM-SHA-256' --entity-type users --entity-name testuser`                                                                                         |
| æŸ¥çœ‹topicsé…ç½®é¡¹    | `kafka-configs --zookeeper banana:2181 --entity-type topics --entity-name topicName --describe`                                                                                                                    |
| æŸ¥çœ‹brokersé…ç½®é¡¹    | `kafka-configs --bootstrap-server banana:9092 --entity-type brokers --entity-name $brokerId [--entity-default] --describe`                                                                                                         |
| å¢åŠ /ä¿®æ”¹é…ç½®é¡¹ | `kafka-configs --zookeeper banana:2181 --alter --entity-type topics --entity-name topicName --add-config 'retention.ms=3000, k2=v2, k3=v3' `                                                                       |
| åˆ é™¤é…ç½®é¡¹    | `kafka-configs --zookeeper banana:2181 --alter --entity-type topics --entity-name topicName --delete-config retention.ms`                                                                                          |

<br/>  

æœªæµ‹è¯•

| åŠŸèƒ½                  | å‘½ä»¤                                                                                                                                                               |
|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| æ·»åŠ ç”¨æˆ·ï¼ˆSCRAM-SHA-256ï¼‰ | `kafka-configs --bootstrap-server banana:9092 --alter --add-config 'SCRAM-SHA-256=[iterations=8192,password=123456]' --entity-type users --entity-name testuser` |
| æ·»åŠ ç”¨æˆ·ï¼ˆSCRAM-SHA-512ï¼‰ | `kafka-configs --bootstrap-server banana:9092 --alter --add-config 'SCRAM-SHA-512=[iterations=8192,password=123456]' --entity-type users --entity-name testuser` |
| æŸ¥çœ‹ç”¨æˆ·é…ç½®              | `kafka-configs --bootstrap-server banana:9092 --describe --entity-type users --entity-name testuser`                                                           |
| åˆ é™¤ç”¨æˆ·                | `kafka-configs --bootstrap-server banana:9092 --alter --delete-config 'SCRAM-SHA-256' --entity-type users --entity-name testuser`                                |

---

#### ğŸ“Œ ACL æƒé™æ§åˆ¶

|åŠŸèƒ½| å‘½ä»¤                                                                                                                                                                                                                                      |
|---|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|ç»™ç”¨æˆ·æˆæƒ Topic è¯»å†™| `kafka-acls --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=banana:2181 --add --allow-principal User:producer --operation Write [--operation Read/describe] --topic=* [--allow-host ip]` |
|ç»™ç”¨æˆ·æˆæƒæ¶ˆè´¹ç»„æƒé™| `kafka-acls --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=banana:2181 --add --allow-principal User:testuser --operation Read --group group1`                                           |
|æŸ¥çœ‹ ACL| `kafka-acls --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=banana:2181 --list`                                                                                                                                                                                      |
|åˆ é™¤ ACL| `kafka-acls --authorizer kafka.security.auth.SimpleAclAuthorizer --authorizer-properties zookeeper.connect=banana:2181 --remove --allow-principal User:testuser --operation Read --operation Write --topic test`                                                                                                    |

<br/>

æœªæµ‹è¯•

|åŠŸèƒ½| å‘½ä»¤                                                                                                                                                      |
|---|---------------------------------------------------------------------------------------------------------------------------------------------------------|
|ç»™ç”¨æˆ·æˆæƒ Topic è¯»å†™| `kafka-acls --bootstrap-server banana:9092 --add --allow-principal User:testuser --operation Read --operation Write --topic test`    |
|ç»™ç”¨æˆ·æˆæƒæ¶ˆè´¹ç»„æƒé™| `kafka-acls --bootstrap-server banana:9092 --add --allow-principal User:testuser --operation Read --group my-group`                  |
|æŸ¥çœ‹ ACL| `kafka-acls --bootstrap-server banana:9092 --list`                                                                                   |
|åˆ é™¤ ACL| `kafka-acls --bootstrap-server banana:9092 --remove --allow-principal User:testuser --operation Read --operation Write --topic test` |

---

#### ğŸ“Œ Leader é‡æ–°é€‰ä¸¾


|åŠŸèƒ½| å‘½ä»¤                                                                                                          |
|---|-------------------------------------------------------------------------------------------------------------|
|æ‰€æœ‰Topicæ‰€æœ‰åˆ†åŒºç”¨é‡æ–°PREFERREDï¼šä¼˜å…ˆå‰¯æœ¬ç­–ç•¥ è¿›è¡ŒLeaderé‡é€‰ä¸¾| `kafka-leader-election --bootstrap-server banana:9092 --election-type preferred  --all-topic-partitions`    |
|æŒ‡å®šTopicæŒ‡å®šåˆ†åŒºç”¨é‡æ–°PREFERREDï¼šä¼˜å…ˆå‰¯æœ¬ç­–ç•¥ è¿›è¡ŒLeaderé‡é€‰ä¸¾| `kafka-leader-election --bootstrap-server banana:9092 --topic test --election-type preferred --partition 1` |


---

#### ğŸ“Œ å…¶ä»–è„šæœ¬

- é‡æ–°åˆ†åŒºï¼šbin/kafka-reassign-partitions.sh
- è´Ÿè½½å‡è¡¡ï¼š
  ```commandline
    kafka-preferred-replica-election --zookeeper banana/kafka --path-to-json-file xxx.json
    
    {"partitions":
        [{"topic": "foo", "partition": 1}, {"topic": "foobar", "partition": 2}]
    }
    ```
- é…ç½®auto.leader.rebalance.enable=trueå®ç°topic Leaderçš„è‡ªåŠ¨è´Ÿè½½å‡è¡¡
- å¢åŠ å‰¯æœ¬å› å­
- kafka-replica-verification.sh
  ```commandline
  bin/kafka-replica-verification.sh --broker-list banana:9092 [--topic-white-list test]
  
  å‚æ•°--topic-white-listæŒ‡å®šè¦æ£€æŸ¥çš„ç›®æ ‡topic
  ```

---

#### ğŸ“Œ è¿ç»´ç›¸å…³

|åŠŸèƒ½| å‘½ä»¤                                                                                                                                                   |
|---|------------------------------------------------------------------------------------------------------------------------------------------------------|
|æŸ¥çœ‹ Broker é…ç½®| `kafka-configs --bootstrap-server banana:9092 --describe --entity-type brokers --entity-name 0`                                   |
|ä¿®æ”¹ Broker é…ç½®| `kafka-configs --bootstrap-server banana:9092 --alter --entity-type brokers --entity-name 0 --add-config log.retention.hours=168` |
|æŸ¥çœ‹ Kafka ç‰ˆæœ¬| `kafka-broker-api-versions --bootstrap-server banana:9092`                                                                        |
