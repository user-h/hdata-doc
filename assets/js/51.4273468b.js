(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{380:function(a,t,s){"use strict";s.r(t);var e=s(3),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"impala"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala"}},[a._v("#")]),a._v(" Impala")]),a._v(" "),t("h3",{attrs:{id:"impala-语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-语句"}},[a._v("#")]),a._v(" Impala 语句")]),a._v(" "),t("h4",{attrs:{id:"impala-基础语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-基础语句"}},[a._v("#")]),a._v(" Impala 基础语句")]),a._v(" "),t("p",[a._v("与 Hive 基本通用，包括建表语句、动态分区等")]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看建表语句")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SHOW")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CREATE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 分区信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" partitions table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看表详细信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("describe")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extended")]),a._v(" table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DESCRIBE")]),a._v(" FORMATTED table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 删除分区")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("alter")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),a._v(" table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("drop")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("partition")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ny"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'201901'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h4",{attrs:{id:"impala-统计信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-统计信息"}},[a._v("#")]),a._v(" Impala 统计信息")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://impala.apache.org/docs/build/html/topics/impala_compute_stats.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网链接：impala统计信息"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 查看表统计信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("table")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COLUMN")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" stats table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 收集统计信息（不能对同一个表执行两种统计信息收集，若要混用，需先删除统计信息，重新收集）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMPUTE")]),a._v(" STATS table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 全表统计信息计算（不带分区的表）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMPUTE")]),a._v(" INCREMENTAL STATS table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 全表统计信息计算（带分区的表，若表实际未分区则实际执行 COMPUTE STATS）")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMPUTE")]),a._v(" INCREMENTAL STATS table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("PARTITION")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("year")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2009")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("month")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 分区统计信息计算")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 删除表统计信息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DROP")]),a._v(" STATS table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h4",{attrs:{id:"impala-元数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-元数据"}},[a._v("#")]),a._v(" Impala 元数据")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://impala.apache.org/docs/build/html/topics/impala_config_options.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("加载元数据参数"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 直接把元数据重置回未加载状态，下次使用时重新加载")]),a._v("\nINVALIDATE METADATA table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 让 Impala 增量更新指定表的元数据")]),a._v("\nREFRESH table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 让 impala 感知到在 Hive 创建的函数")]),a._v("\nREFRESH FUNCTIONS db_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("-- 启动参数：控制 Impala 在何时进行 metadata 的 load（为 true 时在后台自动加载元数据：缺点是元数据常驻内存，比较占用内存，优点是不用在查询时加载元数据）")]),a._v("\nload_catalog_in_background "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("h4",{attrs:{id:"impala-shell-传入参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-shell-传入参数"}},[a._v("#")]),a._v(" Impala-Shell 传入参数")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# impala 执行 SQL 文件中语句，可传入参数")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ny")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y-%m-01"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(' -1 month"')]),a._v(" +%Y%m"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\nimpala-shell --var"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("NY"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${ny}")]),a._v(" -f impala_insert.sql\n")])])]),t("h3",{attrs:{id:"impala-执行计划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#impala-执行计划"}},[a._v("#")]),a._v(" Impala 执行计划")]),a._v(" "),t("h4",{attrs:{id:"explain-执行前"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#explain-执行前"}},[a._v("#")]),a._v(" explain（执行前）")]),a._v(" "),t("ol",[t("li",[a._v("使用 explain 语句生成的执行计划，实际并未执行 sql 语句（根据统计信息生成，统计信息准确与否会生成不同的执行计划，尤其影响带关联的 SQL 执行效率）")]),a._v(" "),t("li",[a._v("预计使用内存情况、是否缺少表统计信息（）、扫描分区数、扫描文件数、扫描文件大小、关联方式（广播小表、混洗哈希）、排序等信息")])]),a._v(" "),t("h4",{attrs:{id:"summary-执行后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#summary-执行后"}},[a._v("#")]),a._v(" Summary（执行后）")]),a._v(" "),t("ol",[t("li",[a._v("执行后生成")]),a._v(" "),t("li",[a._v("可以看到每个步骤资源使用情况，比如：\n"),t("ul",[t("li",[a._v("使用了几个节点")]),a._v(" "),t("li",[a._v("计划读取大小和实际读取文件大小")]),a._v(" "),t("li",[a._v("计划读取行数（为 -1 时缺乏表统计信息）和实际读取行数")]),a._v(" "),t("li",[a._v("平均时间和最大时间：若有一个节点耗时比较长，说明可能出现数据倾斜或节点资源不足等情况")])])])]),a._v(" "),t("h4",{attrs:{id:"profile-执行后-更详细"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#profile-执行后-更详细"}},[a._v("#")]),a._v(" Profile（执行后-更详细）")]),a._v(" "),t("ol",[t("li",[a._v("执行后生成，包含 Expalin、Summary 等信息且更详细")]),a._v(" "),t("li",[a._v("Query Compilation 为编译阶段耗时，Query Timeline 为查询阶段耗时")]),a._v(" "),t("li",[a._v("查看各个节点的详细信息：使用字符串“id=0”来搜索Profile文件，“0”是Summary部分“00:SCAN HDFS”中每一行开头的操作编号。")])])])}),[],!1,null,null,null);t.default=n.exports}}]);