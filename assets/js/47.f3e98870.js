(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{376:function(e,n,a){"use strict";a.r(n);var t=a(3),s=Object(t.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"_1-配置表支持事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置表支持事务"}},[e._v("#")]),e._v(" 1. 配置表支持事务")]),e._v(" "),n("ul",[n("li",[e._v("(1)改配置文件hive-site.xml 或者 临时设置参数 命令行")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("<property>\n    <name>hive.support.concurrency</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.exec.dynamic.partition.mode</name>\n    <value>nonstrict</value>\n</property>\n<property>\n    <name>hive.txn.manager</name>\n    <value>org.apache.hadoop.hive.ql.lockmgr.DbTxnManager</value>\n</property>\n<property>\n    <name>hive.compactor.initiator.on</name>\n    <value>true</value>\n</property>\n<property>\n    <name>hive.compactor.worker.threads</name>\n    <value>1</value>\n    \x3c!--这里的线程数必须大于0 :理想状态和分桶数一致--\x3e\n</property>\n<property>\n    <name>hive.enforce.bucketing</name>\n    <value>true</value>\n</property>\n")])])]),n("ul",[n("li",[e._v("(2)建表时 "),n("span",{staticStyle:{color:"red"}},[e._v("分区 分桶 stored as orc tblproperties('transactional'='true')")])])]),e._v(" "),n("h2",{attrs:{id:"_2-版本问题导jar包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-版本问题导jar包"}},[e._v("#")]),e._v(" 2. 版本问题导jar包")]),e._v(" "),n("p",[e._v("把"),n("code",[e._v("${HIVE_HOME}/hcatalog/share/hcatalog")]),e._v("下的所有包，拷贝入"),n("code",[e._v("${FLUME_HOME}/lib")])]),e._v(" "),n("h2",{attrs:{id:"_3-copyhive文件-这步好像不必要的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-copyhive文件-这步好像不必要的"}},[e._v("#")]),e._v(" 3. copyhive文件(这步好像不必要的??)")]),e._v(" "),n("p",[e._v("将hive.xml和hive-env.sh放到"),n("code",[e._v("${HIVE_HOME}/conf")]),e._v("下")]),e._v(" "),n("h2",{attrs:{id:"_4-修改hdfs目录权限-这步不知道是不是必要的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改hdfs目录权限-这步不知道是不是必要的"}},[e._v("#")]),e._v(" 4. 修改hdfs目录权限(这步不知道是不是必要的)")]),e._v(" "),n("p",[n("code",[e._v("hadoop fs -chmod 777/tmp/hive")]),e._v(" "),n("code",[e._v("chmod 777 /tmp/hive")])]),e._v(" "),n("h2",{attrs:{id:"_5-建表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-建表"}},[e._v("#")]),e._v(" 5.建表")]),e._v(" "),n("p",[e._v("正确的建表实例")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("create table flume_hive.flume_hive(nid int,name string,phone string)\npartitioned by(time string)\nclustered by(nid) into 3 buckets\nrow format delimited fields terminated by ','\nstored as orc tblproperties('transactional'='true');\n")])])]),n("h2",{attrs:{id:"_6-配置flume的配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置flume的配置文件"}},[e._v("#")]),e._v(" 6.配置flume的配置文件")]),e._v(" "),n("p",[n("strong",[e._v("配置文件flume_hive.cnof")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("#定义agent名， source、channel、sink的名称\nagent3.sources = source3\nagent3.channels = channel3\nagent3.sinks = sink3\n#具体定义source\nagent3.sources.source3.type = spooldir\nagent3.sources.source3.spoolDir = /soft/flume/logstohive\nagent3.sources.source3.fileHeader=false\n#定义拦截器，为消息添加时间戳\nagent3.sources.source3.interceptors = i1\nagent3.sources.source3.interceptors.i1.type=timestamp\n\n#设置channel类型为磁盘\nagent3.channels.channel3.type = file\n#file channle checkpoint文件的路径\nagent3.channels.channel3.checkpointDir=/soft/flume/tmp/point\n# file channel data文件的路径\nagent3.channels.channel3.dataDirs=/soft/flume/tmp\n\n#具体定义sink\nagent3.sinks.sink3.type = hive\nagent3.sinks.sink3.hive.metastore = thrift://hadoop1:9083\nagent3.sinks.sink3.hive.database = flume_hive\nagent3.sinks.sink3.hive.table = flume_hive\nagent3.sinks.sink3.hive.partition = %y-%m-%d-%H-%M\nagent3.sinks.sink3.useLocalTimeStamp = false\nagent3.sinks.sink3.round = true\nagent3.sinks.sink3.roundValue = 10\nagent3.sinks.sink3.roundUnit = minute\nagent3.sinks.sink3.serializer = DELIMITED\nagent3.sinks.sink3.serializer.delimiter = \",\"\nagent3.sinks.sink3.serializer.serdeSeparator = ','\nagent3.sinks.sink3.serializer.fieldnames = nid,name,phone\nagent3.sinks.sink3.batchSize = 90\n\n#组装source、channel、sink\nagent3.sources.source3.channels = channel3\nagent3.sinks.sink3.channel = channel3\n")])])]),n("h2",{attrs:{id:"_7-启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动"}},[e._v("#")]),e._v(" 7.启动")]),e._v(" "),n("ul",[n("li",[e._v("先启动hive "),n("code",[e._v("hive")]),e._v(" "),n("code",[e._v("hive --service metastore -p 9083")]),e._v("(这个端口号要配置到flume文件中,可用"),n("code",[e._v("netstat -tulpn | grep 9083")]),e._v("查看端口是否监听)")]),e._v(" "),n("li",[e._v("然后启动flume")]),e._v(" "),n("li",[e._v("拷贝文件")])]),e._v(" "),n("h2",{attrs:{id:"数据内容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据内容"}},[e._v("#")]),e._v(" 数据内容")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("[root@hadoop1 flume]# cat flume_hive.csv \n1001,aaa,12312453359,\n1002,bbb,12678723873,\n1003,ccc,12736732989,\n1004,ddd,12327836839,\n1005,eee,23728179728,\n1006,fff,12387623878,\n[root@hadoop1 flume]# cat flume_hive1.csv \n1007,aaa,12312453359,\n1008,bbb,12678723873,\n1009,ccc,12736732989,\n1010,ddd,12327836839,\n1011,eee,23728179728,\n1012,fff,12387623878,\n")])])])])}),[],!1,null,null,null);n.default=s.exports}}]);