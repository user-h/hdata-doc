(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{330:function(t,s,a){t.exports=a.p+"assets/img/dm_monitor.7f3c949c.png"},388:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"零、官方文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#零、官方文档"}},[t._v("#")]),t._v(" 零、官方文档")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://eco.dameng.com/document/dm/zh-cn/pm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("产品手册"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("达梦数据库需善用达梦提供的工具")])]),t._v(" "),s("ul",[s("li",[t._v("DM控制台工具：查看 dm.ini 配置（中文描述配置信息）、备份还原 "),s("a",{attrs:{href:"https://eco.dameng.com/document/dm/zh-cn/pm/physical-storage#2.1.1.1%20dm.ini",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网在线文档：DM数据库服务配置"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("DM审计分析工具")]),t._v(" "),s("li",[t._v("DM数据迁移工具：用于达梦与其他数据库间的数据迁移（包含视图、存储过程、函数、触发器等）")]),t._v(" "),s("li",[t._v("DM性能监视工具：性能监控（线程、会话、SQL、资源的监控）、调优向导（内存配置、线程配置、索引优化）")]),t._v(" "),s("li",[t._v("SQL交互式查询工具")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(330),alt:"DM性能监视工具"}})]),t._v(" "),s("h2",{attrs:{id:"一、数据库安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、数据库安装"}},[t._v("#")]),t._v(" 一、数据库安装")]),t._v(" "),s("h4",{attrs:{id:"前期准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[t._v("#")]),t._v(" 前期准备")]),t._v(" "),s("ol",[s("li",[t._v("创建dmdba用户,dinstall组"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost oracle"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# groupadd dinstall && useradd -g dinstall dmdba && echo root|passwd --stdin dmdba")]),t._v("\nChanging password "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" user dmdba.\npasswd: all authentication tokens updated successfully.\n")])])])]),t._v(" "),s("li",[t._v("关闭防火墙和selinux")]),t._v(" "),s("li",[t._v("创建软件安装目录 "),s("code",[t._v("/opt/dmdbms && chown dmdba:dinstall /opt/dmdbms")])]),t._v(" "),s("li",[t._v("创建数据目录"),s("code",[t._v("/opt/dmdata && chown dmdba:dinstall /opt/dmdata")])]),t._v(" "),s("li",[t._v("修改用户资源限制"),s("br"),t._v("\nvi /etc/security/limits.conf 增加相应配置"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("dmdba hard nofile "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("131072")]),t._v("\ndmdba soft nofile "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("131072")]),t._v("\ndmdba soft "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nice")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndmdba hard "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nice")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\ndmdba soft as unlimited\ndmdba hard as unlimited\ndmdba soft fsize unlimited\ndmdba hard fsize unlimited\ndmdba soft nproc "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("131072")]),t._v("\ndmdba hard nproc "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("131072")]),t._v("\ndmdba soft data unlimited\ndmdba hard data unlimited\ndmdba soft core unlimited\ndmdba hard core unlimited\ndmdba soft memlock unlimited\ndmdba hard memlock unlimited\n")])])])]),t._v(" "),s("li",[t._v("上传安装包，解压 "),s("code",[t._v("unzip dm8_20220525_x86_rh6_64.zip")])]),t._v(" "),s("li",[t._v("iso挂载到/mnt "),s("code",[t._v("mount -o loop dm8_20220525_x86_rh6_64.iso /mnt/")])]),t._v(" "),s("li",[t._v("取消挂载 "),s("code",[t._v("umount /mnt/")]),t._v(" （全部安装完成后执行）")])]),t._v(" "),s("h4",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("切换用户 dmdba 进行安装")])]),t._v(" "),s("li",[s("p",[t._v("执行安装脚本 "),s("code",[t._v("/mnt/DMInstall.bin -i")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dmdba@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ /mnt/DMInstall.bin -i\nPlease "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" the installer's language "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("E/e:English C/c:Chinese"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("E/e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":c\n解压安装程序"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". \n欢迎使用达梦数据库安装程序\n\n是否输入Key文件路径? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Y/y:是 N/n:否"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Y/y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":n\n\n是否设置时区? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Y/y:是 N/n:否"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Y/y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":y\n设置时区:\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-12"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("日界线西\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-11"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("萨摩亚群岛\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-10"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("夏威夷\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-09"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("阿拉斯加\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-08"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("太平洋时间（美国和加拿大）\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-07"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("亚利桑那\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-06"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("中部时间（美国和加拿大）\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-05"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("东部部时间（美国和加拿大）\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-04"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("大西洋时间（美国和加拿大）\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-03"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("巴西利亚\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-02"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("中大西洋\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM-01"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("亚速尔群岛\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("GTM")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("格林威治标准时间\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+01"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("萨拉热窝\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+02"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("开罗\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+03"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("莫斯科\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+04"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("阿布扎比\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+05"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("伊斯兰堡\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+06"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("达卡\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+07"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("曼谷，河内\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+08"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("中国标准时间\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+09"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("汉城\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+10"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("关岛\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+11"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("所罗门群岛\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+12"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("斐济\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("26")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+13"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("努库阿勒法\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": GTM+14"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("基里巴斯\n请选择设置时区 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":21\n\n安装类型:\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 典型安装\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" 服务器\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" 客户端\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" 自定义\n请选择安装类型的数字序号 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 典型安装"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":1\n所需空间: 1585M\n\n请选择安装目录 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/home/dmdba/dmdbms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":/opt/dmdbms\n目录"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/opt/dmdbms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("下不为空，请选择其他目录。\n请选择安装目录 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/home/dmdba/dmdbms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":/opt/dmdbms\n可用空间: 13G\n是否确认安装路径"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/opt/dmdbms"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Y/y:是 N/n:否"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Y/y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":y\n\n安装前小结\n安装位置: /opt/dmdbms\n所需空间: 1585M\n可用空间: 13G\n版本信息: \n有效日期: \n安装类型: 典型安装\n是否确认安装? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Y/y:是 N/n:否"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":y\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:36 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装达梦数据库"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:37 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 基础 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:40 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 服务器 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:40 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 客户端 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:42 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 驱动 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:43 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 手册 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:43 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装 服务 模块"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:44 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 移动日志文件。\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-18 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":00:44 \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 安装达梦数据库完成。\n\n请以root系统用户执行命令:\n/opt/dmdbms/script/root/root_installer.sh\n\n安装结束\n")])])])]),t._v(" "),s("li",[s("p",[t._v("root执行脚本 "),s("code",[t._v("/opt/dmdbms/script/root/root_installer.sh")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /opt/dmdbms/script/root/root_installer.sh")]),t._v("\n移动 /opt/dmdbms/bin/dm_svc.conf 到/etc目录\n修改服务器权限\n创建DmAPService服务\nCreated symlink from /etc/systemd/system/multi-user.target.wants/DmAPService.service to /usr/lib/systemd/system/DmAPService.service.\n创建服务"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DmAPService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("完成\n启动DmAPService服务\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost opt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n")])])])])]),t._v(" "),s("h4",{attrs:{id:"初始化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化"}},[t._v("#")]),t._v(" 初始化")]),t._v(" "),s("ol",[s("li",[t._v("执行初始化脚本 "),s("code",[t._v("./dminit path=/opt/dmdata db_name=aihb instance_name=aihb")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dmdba@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),t._v("\n/opt/dmdbms/bin\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dmdba@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ ./dminit "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/dmdata "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("db_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("aihb "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("instance_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("aihb\ninitdb V8\ndb version: 0x7000c\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" dm.key not found, use default license"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\nLicense will expire on "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2023")]),t._v("-05-25\nNormal of FAST\nNormal of DEFAULT\nNormal of RECYCLE\nNormal of KEEP\nNormal of ROLL\n\n log "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" path: /opt/dmdata/aihb/aihb01.log\n\n\n log "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" path: /opt/dmdata/aihb/aihb02.log\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" to "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("/opt/dmdata/aihb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".\ncreate dm database success. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2022")]),t._v("-07-19 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":05:20\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dmdba@localhost bin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ \n")])])])])]),t._v(" "),s("h4",{attrs:{id:"注册数据库服务-启动数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册数据库服务-启动数据库"}},[t._v("#")]),t._v(" 注册数据库服务，启动数据库")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("调用达梦提供的脚本生成数据库服务,自动启动数据库,脚本在安装目录的/script/root子目录下,调用注册脚本需"),s("strong",[t._v("使用root用户")]),t._v(" "),s("code",[t._v("./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini -p aihb")])]),t._v(" "),s("ul",[s("li",[t._v("调用dm_service_installer.sh脚本来生成服务")]),t._v(" "),s("li",[t._v("-t 指定需要创建的服务类型,这里是数据库服务所以是dmserver")]),t._v(" "),s("li",[t._v("-dm_ini 指定在上一步初始化后生成的dm.ini文件")]),t._v(" "),s("li",[t._v("-p 为生成服务的后缀名,可自定义，这里给的czw，所以创建的服务名为DmServiceczw")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/opt/dmdbms/script/root\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ntotal "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("48")]),t._v("\n-rwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" dmdba dinstall "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29111")]),t._v(" Jul "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":00 dm_service_installer.sh\n-rwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" dmdba dinstall  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9618")]),t._v(" Jul "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":00 dm_service_uninstaller.sh\n-rwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" dmdba dinstall   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("635")]),t._v(" Jul "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(":00 root_installer.sh\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini")]),t._v("\n请设置参数-p\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini -p aihb")]),t._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/DmServiceaihb.service to /usr/lib/systemd/system/DmServiceaihb.service.\n创建服务"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DmServiceaihb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("完成\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("启动数据库\n"),s("code",[t._v("systemctl start DmServiceaihb")])])])]),t._v(" "),s("h2",{attrs:{id:"二、创建oracle-to-达梦的dblink-oci方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、创建oracle-to-达梦的dblink-oci方式"}},[t._v("#")]),t._v(" 二、创建Oracle To 达梦的DBlink（OCI方式）")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/baidu_41727061/article/details/124823583",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考链接"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("键")]),t._v(" "),s("th",[t._v("值")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("操作系统")])]),t._v(" "),s("td",[t._v("Centos 7")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("Oracle数据库")])]),t._v(" "),s("td",[t._v("11.2.0.4.0")])]),t._v(" "),s("tr",[s("td",[t._v("达梦数据库")]),t._v(" "),s("td",[t._v("Centos 7 x86版本")])]),t._v(" "),s("tr",[s("td",[t._v("达梦安装目录")]),t._v(" "),s("td",[t._v("/opt/dmdbms")])]),t._v(" "),s("tr",[s("td",[t._v("Oracle OCI位置")]),t._v(" "),s("td",[t._v("/opt/oracle")])])])]),t._v(" "),s("h4",{attrs:{id:"工具准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工具准备"}},[t._v("#")]),t._v(" 工具准备")]),t._v(" "),s("p",[s("strong",[t._v("Oracle OCI：")]),t._v(" instantclient-basic-linux.x64-11.2.0.4.0.zip（与系统和Oracle版本对应）\n"),s("a",{attrs:{href:"https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载地址"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"oracle-oci安装配置-达梦数据库所在服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#oracle-oci安装配置-达梦数据库所在服务器"}},[t._v("#")]),t._v(" Oracle OCI安装配置（达梦数据库所在服务器）")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("进入包所在的路径并解压：")]),t._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/oracle/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" instantclient-basic-linux.x64-11.2.0.4.0.zip\n")])])])]),t._v(" "),s("li",[s("p",[t._v("（18.3 之前的版本需要这一步）进入解压后目录创建软连接：")]),t._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" instantclient_11_2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -sfv libclntsh.so.11.1 libclntsh.so\n")])])])]),t._v(" "),s("li",[s("p",[t._v("配置环境变量")]),t._v(" "),s("ul",[s("li",[t._v("将OCI添加到/etc/ld.so.conf.d目录下（"),s("strong",[t._v("系统用户")]),t._v("）"),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" /opt/oracle/instantclient_11_2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/ld.so.conf.d/oracle-instantclient.conf\n")])])])]),t._v(" "),s("li",[t._v("加载动态链接库（使上一步生效）："),s("code",[t._v("ldconfig")])]),t._v(" "),s("li",[t._v("配置LD_LIBRARY_PATH环境变量（"),s("strong",[t._v("dmdba用户")]),t._v("）"),s("br"),t._v("\n修改dmdba用户下的.bash_profile文件（"),s("code",[t._v("vim ~/.bash_profile")]),t._v("），添加以下内容"),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LD_LIBRARY_PATH")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LD_LIBRARY_PATH")]),t._v(':/opt/oracle/instantclient_11_2"')]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("加载环境变量（使上一步生效）："),s("code",[t._v("source ~/.bash_profile")])])])]),t._v(" "),s("li",[s("p",[t._v("启动（重启达梦数据库 "),s("strong",[t._v("系统用户")]),t._v("）")])])]),t._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("systemctl restart DmServiceXXX "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#（**实际服务名**）")]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("创建DBLink（注：用户名不要加引号）")])]),t._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("create "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("link")]),t._v(" LINKORA connect "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ORACLE'")]),t._v(" with username identified by "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password"')]),t._v(" using "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x.x.x.x:1521/orcl'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"数据库调优方面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库调优方面"}},[t._v("#")]),t._v(" 数据库调优方面")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://eco.dameng.com/document/dm/zh-cn/ops/performance-optimization.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("性能诊断与优化"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"数据库统计信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据库统计信息"}},[t._v("#")]),t._v(" 数据库统计信息")]),t._v(" "),s("h4",{attrs:{id:"自动收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动收集"}},[t._v("#")]),t._v(" 自动收集")]),t._v(" "),s("p",[t._v("DM 数据库支持统计信息的自动收集，当全表数据量变化超过设定阈值后可自动更新统计信息。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--打开表数据量监控开关，参数值为 1 时监控所有表，2 时仅监控配置表")]),t._v("\nSP_SET_PARA_VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'AUTO_STAT_OBJ'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 如果 AUTO_STAT_OBJ=2，需进一步使用 DBMS_STATS.SET_TABLE_PREFS 设置 STALE_PERCENT 属性")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--设置 SYSDBA.T 表数据变化率超过 15% 时触发自动更新统计信息")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SET_TABLE_PREFS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SYSDBA'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'T'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'STALE_PERCENT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--配置自动收集统计信息触发时机")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 停止时最后一个参数配置为0？   参数值需再斟酌！！！！")]),t._v("\nSP_CREATE_AUTO_STAT_TRIGGER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1:00'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2025/3/12'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n函数各参数介绍\nSP_CREATE_AUTO_STAT_TRIGGER(\n    TYPE                    INT,    --间隔类型，默认为天\n    FREQ_INTERVAL         INT,    --间隔频率，默认 1\n    FREQ_SUB_INTERVAL    INT,    --间隔频率，与 FREQ_INTERVAL 配合使用\n    FREQ_MINUTE_INTERVAL INT,    --间隔分钟，默认为 1440\n    STARTTIME              VARCHAR(128), --开始时间，默认为 22:00\n    DURING_START_DATE    VARCHAR(128), --重复执行的起始时间，默认 1900/1/1\n    MAX_RUN_DURATION    INT,    --允许的最长执行时间(秒)，默认不限制\n    ENABLE                  INT     --0 关闭，1 启用  --默认为 1\n);\n*/")]),t._v("\n")])])]),s("p",[s("strong",[t._v("测试")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("A "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("level")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("connect")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("level")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- SELECT * FROM SYSSTATTABLEIDU order by LAST_STAT_DT desc;")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" sysstats\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" object_id\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" dba_objects\n               "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" object_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OWNER'")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" object_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'T'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("监控统计信息收集过程")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 创建一个用户表 AUTO_STAT_INFO，用以保存自动收集过程的相关信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 最好是系统用户吧？？？SYSDBA？？？")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" AUTO_STAT_INFO\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n   task_id               "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   total_stat            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   table_id              "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   sch_name              "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   table_name            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   curr_gath_tab_id      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   curr_gath_sch_name    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   curr_gath_tab_name    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   success_stat          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   fail_stat             "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   task_start_time       "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   task_end_time         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   gather_tbl_start_time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   gather_tbl_end_time   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 创建过程 SYSDBA.GET_AUTO_STAT_INFO_FUNC，接收服务器在自动收集统计信息时的过程信息。并在模块体编写用户代码，将过程收集的统计信息写入 AUTO_STAT_INFO 中。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("OR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("REPLACE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PROCEDURE")]),t._v("  SYSDBA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET_AUTO_STAT_INFO_FUNC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("total_stat "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("table_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sch_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("curr_gath_tab_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" curr_gath_sch_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" curr_gath_tab_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("success_stat "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fail_stat "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("task_start_time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" task_end_time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gather_tbl_start_time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gather_tbl_end_time "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATETIME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BEGIN")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//下面是用户自定义的代码，将SYSDBA.GET_AUTO_STAT_INFO_FUNC过程的信息插入到用户表AUTO_STAT_INFO 中")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" AUTO_STAT_INFO "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VALUES")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("total_stat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("table_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sch_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("table_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("curr_gath_tab_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" curr_gath_sch_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" curr_gath_tab_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("success_stat "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fail_stat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("task_start_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("task_end_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gather_tbl_start_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gather_tbl_end_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("commit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEXCEPTION\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHEN")]),t._v(" OTHERS "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("THEN")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("END")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 最后，解读表 AUTO_STAT_INFO，介绍一次自动收集统计信息任务的相关过程信息。如果 SP_CREATE_AUTO_STAT_TRIGGER 触发一次自动收集统计信息，在任务开始时，会先记录当前任务的开始时间，当前任务的待收集表的总个数，以及接下来待收集的表的 id。之后每收集完成一个表的统计信息，就会记录该表 table 的 id 及收集该表的开始和结束时间，和截至目前收集成功失败的表个数情况，以及接下来待收集的表的 id。其中“接下来待收集的表的 id”即 current_gather_tab_id，为当前服务器正在收集的表 id。")]),t._v("\n")])])]),s("h4",{attrs:{id:"手动收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动收集"}},[t._v("#")]),t._v(" 手动收集")]),t._v(" "),s("p",[s("strong",[t._v("查看是否已有统计信息")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 检查表上是否有统计信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sysstats\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" object_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_objects "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v("\n  object_type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" object_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 用于经过 GATHER_TABLE_STATS、GATHER_INDEX_STATS 或 GATHER_SCHEMA_STATS 收集之后展示。")]),t._v("\ndbms_stats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("table_stats_show"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("收集统计信息")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("、收集全库统计信息\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GATHER_SCHEMA_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HNSIMIS'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("FALSE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FOR ALL COLUMNS SIZE AUTO'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--HNSIMIS是模式名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这种收集方式，并不是100%收集，所以有一定的弊端。")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("、收集表的统计信息\ndbms_stats"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GATHER_TABLE_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TEST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--收集表的统计信息，包括列和索引等 第一个参数是模式，第二个参数是表 Null是缺省，100是采样率100%，默认不是。")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GATHER_TABLE_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OWNER'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE_NAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("TRUE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FOR ALL COLUMNS SIZE AUTO'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("、收集列统计信息\nstat "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" fw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("CREATE_USERID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--收集某一列的统计信息 fw是表名 CREATE_USERID是列名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这个在做sql调优的时候比较常用，因为比较准。")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("、收集索引统计信息\nsp_index_stat_init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DREAMWEB_PUDONG'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'IX_FW_ROWSTATE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--收集索引的统计信息 DREAMWEB_PUDONG是模式名称 IX_FW_ROWSTATE是索引名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 这个也比较常用，建议创建完索引，立刻收集下统计信息。")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 报错 磁盘空间不足 -523[-523]: anonymous block line 2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- SYSTEM表空间 不足")]),t._v("\n")])])]),s("p",[s("strong",[t._v("删除统计信息")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--表")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DELETE_TABLE_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'分区名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--模式")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DELETE_SCHMA_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--索引")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DELETE_INDEX_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'索引名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'分区表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--字段")]),t._v("\nDBMS_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DELETE_COLUMN_STATS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'列名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'分区表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"et-工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#et-工具"}},[t._v("#")]),t._v(" ET 工具")]),t._v(" "),s("p",[t._v("ET 工具是 DM 数据库自带的 SQL 性能分析工具，能够统计 SQL 语句执行过程中每个操作符的实际开销，为 SQL 优化提供依据以及指导。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--查看ET是否开启")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$parameter t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MONITOR_SQL_EXEC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$parameter t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ENABLE_MONITOR'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--ENABLE_MONITOR，动态参数(系统级)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--MONITOR_SQL_EXEC，动态参数(会话级)")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--开启ET")]),t._v("\nSP_SET_PARA_VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ENABLE_MONITOR'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSP_SET_PARA_VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MONITOR_SQL_EXEC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--关闭ET")]),t._v("\nSP_SET_PARA_VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ENABLE_MONITOR'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSP_SET_PARA_VALUE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MONITOR_SQL_EXEC'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"dbms-sqltune-工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dbms-sqltune-工具"}},[t._v("#")]),t._v(" dbms_sqltune 工具")]),t._v(" "),s("p",[t._v("DBMS_SQLTUNE 包提供一系列实时 SQL 监控的方法。当 SQL 监控功能开启后，DBMS_SQLTUNE 包可以实时监控 SQL 执行过程中的信息，包括：执行时间、执行代价、执行用户、统计信息等情况。"),s("br"),t._v("\ndbms_sqltune 系统包相比 ET 功能更强大，能够获取 IO 操作量，查看真实执行计划，每个操作符消耗占比和相应的花费时间，还能看出每个操作符执行的次数，非常便于了解执行计划中瓶颈位置。"),s("br"),t._v("\ndbms_sqltune 功能远不止定位执行计划瓶颈，还拥有调优助手功能（建议性提示建某索引和收集某统计信息），具体使用 "),s("a",{attrs:{href:"https://eco.dameng.com/document/dm/zh-cn/pm/dbms_sqltume-package.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("DM8 系统包使用手册"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 1. 使用前提：建议会话级开启参数 MONITOR_SQL_EXEC=1，而 MONITOR_SQL_EXEC 在达梦数据库中一般默认是 1，无需调整。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SESSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MONITOR_SQL_EXEC'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 2. <执行待优化SQL>")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 3. 查看执行计划")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" DBMS_SQLTUNE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("REPORT_SQL_MONITOR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SQL_EXEC_ID"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1213701")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dual"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"hints"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hints"}},[t._v("#")]),t._v(" Hints")]),t._v(" "),s("p",[t._v("DM 查询优化器采用基于代价的方法。在估计代价时，主要以统计信息或者普遍的数据分布为依据。在大多数情况下，估计的代价都是准确的。但在一些比较特殊的场合，例如缺少统计信息，或统计信息陈旧，或抽样数据不能很好地反映数据分布时，优化器选择的执行计划不是“最优”的，甚至可能是很差的执行计划。"),s("br"),t._v("\n如果 HINT 的语法没有写对或指定的值不正确，DM 并不会报错，而是直接忽略 HINT 继续执行。")]),t._v(" "),s("h4",{attrs:{id:"ini-参数提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ini-参数提示"}},[t._v("#")]),t._v(" INI 参数提示")]),t._v(" "),s("p",[t._v("支持使用 HINT 的 INI 参数可通过 V$HINT_INI_INFO 动态视图查询。支持 HINT 的 INI 参数分为两类：一是 HINT_TYPE 为“OPT”，表示分析阶段使用的参数；二是 HINT_TYPE 为“EXEC”，表示运行阶段使用的参数，运行阶段使用的参数对于视图无效。")]),t._v(" "),s("ul",[s("li",[t._v("例："),s("code",[t._v("SELECT /*+ENABLE_HASH_JOIN(1)*/ * FROM T1,T2 WHERE C1=D1;")])])]),t._v(" "),s("h4",{attrs:{id:"索引提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引提示"}},[t._v("#")]),t._v(" 索引提示")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 使用索引(如果查询中给出了表的别名那么必须使用别名)：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ INDEX (表名[,] 索引名) {INDEX (表名[,] 索引名)} */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 不使用索引：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_INDEX (表名[,] 索引名) { NO_INDEX (表名[,] 索引名)} */")]),t._v("\n\n\n")])])]),s("h4",{attrs:{id:"连接方法提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接方法提示"}},[t._v("#")]),t._v(" 连接方法提示")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间使用指定顺序的哈希连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ USE_HASH(T1, T2) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间不能使用指定顺序的哈希连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_USE_HASH(T1, T2) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间使用嵌套循环连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ USE_NL(A, B) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间不能使用嵌套循环连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_USE_NL(A, B) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 当连接情况为左表 + 右表索引时，强制两个表间使用索引连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ USE_NL_WITH_INDEX(T1, IDX_T2_ID) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 当连接情况为左表 + 右表索引时，强制两个表间不能使用索引连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_USE_NL_WITH_INDEX(T1, IDX_T2_ID) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间使用归并连接。归并连接所用的两个列都必须是索引列。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ USE_MERGE(T1,T2) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制两个表间不能使用归并连接")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_USE_MERGE(T1,T2) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 优先采用半连接转换为等价的内连接，仅 OPTIMIZER_MODE=1 有效。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ SEMI_GEN_CROSS  OPTIMIZER_MODE(1) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 不采用半连接转换为等价的内连接，仅 OPTIMIZER_MODE=1 有效。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_SEMI_GEN_CROSS  OPTIMIZER_MODE(1) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 优先采用变量改写方式实现连接，适合驱动表数据量少而另一侧计划较复杂的场景，目前支持变量改写的连接方式有 NEST LOOP INNER JOIN2、NEST LOOP LEFT JOIN2、NEST LOOP SEMI JOIN2，仅 OPTIMIZER_MODE=1 有效。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ USE_CVT_VAR OPTIMIZER_MODE(1) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 不考虑变量改写方式实现连接，仅 OPTIMIZER_MODE=1 有效。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ NO_USE_CVT_VAR OPTIMIZER_MODE(1) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 一般情况下，归并连接需要左右孩子的数据按照连接列有序，使用此优化器提示时，优化器将考虑通过插入排序操作符的方式实现归并连接，仅 OPTIMIZER_MODE=1 有效。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ENHANCED_MERGE_JOIN OPTIMIZER_MODE(1) stat(T1 1M) stat(T2 1M) */")]),t._v("\n\n")])])]),s("h4",{attrs:{id:"连接顺序提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接顺序提示"}},[t._v("#")]),t._v(" 连接顺序提示")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 多表连接时优化器会考虑各种可能的排列组合顺序。使用 ORDER HINT 指定连接顺序提示可以缩小优化器试探的排列空间，进而得到接近 DBA 所期望的查询计划。如果连接顺序和连接方法提示同时指定且二者间存在自相矛盾，优化器会以连接顺序提示为准。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ ORDER (T1, T2 , T3, … tn ) */")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n如果期望表的连接顺序是 T1, T2, T3，那么可以加入这样的提示：\nSELECT /*+ ORDER(T1, T2, T3 )*/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" T1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T4 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" …\n在指定上述连接顺序后，T4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T3 或 T1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T3 会被考虑；T3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T2 或 T1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("T2 不被考虑。\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 更特定的执行计划")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- EXPLAIN SELECT /*+ OPTIMIZER_MODE(1), ORDER(T1,T2,T3,T4) ,USE_HASH(T1,T2), USE_HASH(T2,T3), USE_HASH(T3,T4)*/* FROM T1,T2,T3,T4 WHERE T1.c1=T2.d1 AND T2.d2 = T3.e2 AND T3.e1 = T4.f1;")]),t._v("\n")])])]),s("h4",{attrs:{id:"统计信息提示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统计信息提示"}},[t._v("#")]),t._v(" 统计信息提示")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 统计信息提示只能针对基表设置，视图和派生表等对象设置无效。如果表对象存在别名则必须使用别名。行数只能使用整数，或者整数 +K（千），整数 +M（百万），整数 +G（十亿）。行数提示设置后，统计信息的其它内容也会做相应的调整。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" STAT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("表名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 行数"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n")])])]),s("h4",{attrs:{id:"其他-hint"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他-hint"}},[t._v("#")]),t._v(" 其他 Hint")]),t._v(" "),s("p",[s("strong",[t._v("MPP 本地对象提示")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- MPP 环境下，提供一种将用户表或动态视图作为本地对象处理的方法，通过指示符 LOCAL_OBJECT(对象名/别名) 进行处理。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 对于系统表当做本地对象的处理，本方法不适用，系统表只能在主站点才能做本地对象处理。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+ LOCAL_OBJECT(对象名/别名) */")]),t._v("\n")])])]),s("p",[s("strong",[t._v("忽略重复键值提示")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 当执行 INSERT 操作时，如果存在 UNIQUE 索引，那么发生了重复键值冲突。使用 HINT IGNORE_ROW_ON_DUPKEY_INDEX 则可以忽略该冲突，冲突数据既不进行插入也不会报错，其他非冲突插入正常进行。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+IGNORE_ROW_ON_DUPKEY_INDEX(<表名> [(<列名>{,<列名>})])*/")]),t._v("\n")])])]),s("p",[s("strong",[t._v("禁用计划缓存提示")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 使用 HINT PLAN_NO_CACHE 禁用计划缓存，当前语句的执行计划将不会被缓存。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+PLAN_NO_CACHE*/")]),t._v("\n")])])]),s("p",[s("strong",[t._v("DMDPC 数据分发方式提示")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[t._v("DMDPC 环境下提供了一种专门针对指定的连接、分组、排序、去重和分析函数操作符数据分发方式进行人工干预的优化器提示。该提示被采纳的前提是指定的分发路径有效，因为代价原因没有被优化器选中。\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*+DPC(分发方式探测序号 分发方式字符串)*/")]),t._v("\n")])])]),s("h2",{attrs:{id:"dts-迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dts-迁移"}},[t._v("#")]),t._v(" DTS 迁移")]),t._v(" "),s("h4",{attrs:{id:"注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("一定要用新版本DTS工具，旧版本一堆坑")])]),t._v(" "),s("li",[t._v("如果允许的话，迁移表勾选已存在的先删除表再创建（绕过奇奇怪怪的报错）")]),t._v(" "),s("li",[t._v("数据库区分大小写时，是否有字段名转大写的选项（去掉 保持对象名大小写 的勾选）")]),t._v(" "),s("li",[t._v("表已存在且不能删表时：一定要先禁用触发器、索引等（Oracle不能禁用唯一索引，DM不知道能行不）")]),t._v(" "),s("li",[t._v("报错：数据迁移 A 模式时报 B 模式主键冲突；原因可能是有 A 模式同步到 B 模式的触发器")])]),t._v(" "),s("h2",{attrs:{id:"常用sql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用sql"}},[t._v("#")]),t._v(" 常用SQL")]),t._v(" "),s("h4",{attrs:{id:"博客"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#博客"}},[t._v("#")]),t._v(" 博客")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/kQ93CD6oRivs6haQecchqg",target:"_blank",rel:"noopener noreferrer"}},[t._v("达梦8数据库运维常用基础sql"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"新建用户及表空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建用户及表空间"}},[t._v("#")]),t._v(" 新建用户及表空间")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 表空间文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("tablespace")]),t._v(" user_name datafile "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/data/dmdata/DAMENG/user_name.DBF'")]),t._v(" size "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("61952")]),t._v(" autoextend "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("next")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),t._v(" maxsize "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("67108863")]),t._v(" CACHE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" NORMAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 最大64TB")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 创建用户模式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" user_name IDENTIFIED "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PASSWD"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLESPACE")]),t._v(" user_name\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TEMPORARY")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLESPACE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TEMP")]),t._v("\n  QUOTA UNLIMITED "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" user_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 授权")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" DBA "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" user_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" 用户名 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CASCADE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 强制删除用户及其所有对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" TABLESPACE_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SEGMENT_TYPE "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" DBA_SEGMENTS "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" TABLESPACE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表空间名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLESPACE")]),t._v(" 表空间名 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"元数据获取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#元数据获取"}},[t._v("#")]),t._v(" 元数据获取")]),t._v(" "),s("h4",{attrs:{id:"常用系统视图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用系统视图"}},[t._v("#")]),t._v(" 常用系统视图")]),t._v(" "),s("p",[s("code",[t._v("v$dynamic_tables")]),t._v(" 可以获取所有动态视图")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[t._v("user_tables  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- dba_tables")]),t._v("\nuser_tab_columns\nuser_indexes\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查看系统中的作业信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("job"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("schema_user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("last_sec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next_date"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("next_sec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"INTERVAL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("broken"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("failures"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("what "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_jobs t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询数据库实例启动状态")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询license信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" V$LICENSE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询系统函数及其参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$ifun a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v$ifun_arg b "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("like")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SF_ARCHIVELOG_%'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--系统函数名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询函数/存储过程/包源码信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" DBA_SOURCE t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'P_TEST'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--查询对象名")]),t._v("\n")])])]),s("p",[s("strong",[t._v("触发器")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" DBA_TRIGGERS "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 禁用启用触发器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TRIGGER")]),t._v(" 触发器名称 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DISABLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TRIGGER")]),t._v(" 触发器名称 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENABLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"建表语句获取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建表语句获取"}},[t._v("#")]),t._v(" 建表语句获取")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" DBMS_METADATA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET_DDL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'表名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'模式名'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" DUAL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 未使用，理论上没问题，不知道是否有错误的地方")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" OWNER\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" DBA_TABLES\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" OWNER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OWNER'")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE_NAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" SUB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       LISTAGG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SQL_PART"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CHR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITHIN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ORDER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" SUB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FLAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" FULL_DDL\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 表定义")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" FLAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                DBMS_METADATA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET_DDL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" CHR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" SQL_PART\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" T\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 表注释")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" FLAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'COMMENT ON TABLE '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' IS '''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" TC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COMMENTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''';'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" SQL_PART\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" T\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" ALL_TAB_COMMENTS TC\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" TC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME\n           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" TC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" TC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COMMENTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 字段注释")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" FLAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'COMMENT ON COLUMN '")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" CC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLUMN_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' IS '''")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" CC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COMMENTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''';'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" SQL_PART\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" T\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" ALL_COL_COMMENTS CC\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" CC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME\n           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" CC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" CC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COMMENTS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 索引定义")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" FLAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                DBMS_METADATA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GET_DDL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'INDEX'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INDEX_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" SQL_PART\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" T\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" ALL_INDEXES I\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TABLE_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME\n           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TABLE_OWNER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OWNER\n         "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INDEX_TYPE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NORMAL'")]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" I"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UNIQUENESS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NONUNIQUE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" SUB\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GROUP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" SUB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("T_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查询表空间占用率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询表空间占用率"}},[t._v("#")]),t._v(" 查询表空间占用率")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" size_m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nvl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v("  used_m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("round")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nvl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  usedrate\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_free_space a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dba_data_files b\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("file_id\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tablespace_name\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查看单表-索引-占用空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看单表-索引-占用空间"}},[t._v("#")]),t._v(" 查看单表（索引）占用空间")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- user_segments ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- dba_segments")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("  t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("segment_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("segment_type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tablespace_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" byte_kb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" byte_mb\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_segments t\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DMHR'")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 用户/模式名 ")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SEGMENT_TYPE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 'INDEX'")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("order")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bytes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查看达梦数据库是否是集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看达梦数据库是否是集群"}},[t._v("#")]),t._v(" 查看达梦数据库是否是集群")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$instance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- MODE$为STANDBY/PRIMARY是 数据守护集群，否则普通单机或DSC集群")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$dsc_ep_info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 返回空  则不是dsc集群")]),t._v("\n")])])]),s("h4",{attrs:{id:"查看模式和用户对应关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看模式和用户对应关系"}},[t._v("#")]),t._v(" 查看模式和用户对应关系")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NAME schname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID schid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id userid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NAME username\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sysobjects a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sysobjects b\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TYPE$"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SCH'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"问题排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题排查"}},[t._v("#")]),t._v(" 问题排查")]),t._v(" "),s("h4",{attrs:{id:"查询锁表-杀会话"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询锁表-杀会话"}},[t._v("#")]),t._v(" 查询锁表 & 杀会话")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询锁表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" obs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OBJECT_NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OBJECT_ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SESSION_ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("USERNAME\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" V$LOCKED_OBJECT ob\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" DBA_OBJECTS obs\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" ob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OBJECT_ID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" obs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OBJECT_ID\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" obs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OBJECT_TYPE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 终止会话")]),t._v("\nSP_CLOSE_SESSION"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SESS_ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 替换为实际会话ID")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询正在执行的SQL")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" v$sessions "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ACTIVE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询阻塞")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" DS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SESS_ID     "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"被阻塞的会话ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       DS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SQL_TEXT    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"被阻塞的SQL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       DS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRX_ID      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"被阻塞的事务ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       DS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CREATE_TIME "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"开始阻塞时间"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       SS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SESS_ID     "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"占用锁的会话ID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       SS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SQL_TEXT    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"占用锁的SQL"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       SS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CLNT_IP     "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"占用锁的IP"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       L"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_id  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"占用锁的事务ID"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" v$trxwait L\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" V$SESSIONS DS\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" DS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRX_ID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" L"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LEFT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("JOIN")]),t._v(" V$SESSIONS SS\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" SS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRX_ID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" L"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查询实例中已执行未提交的-sql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询实例中已执行未提交的-sql"}},[t._v("#")]),t._v(" 查询实例中已执行未提交的 SQL")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sess_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sql_text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trx_id\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" v$sessions t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v$trx t2\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("trx_id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'IDLE'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" t2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ACTIVE'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"查询表上的锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询表上的锁"}},[t._v("#")]),t._v(" 查询表上的锁")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("无锁（LOCK_MODE=0）")]),s("br"),t._v("\n表示当前未对资源加锁，仅作为锁状态标识存在。")]),t._v(" "),s("li",[s("strong",[t._v("共享锁（S锁，LOCK_MODE=1）")]),t._v(" "),s("ul",[s("li",[t._v("允许其他事务读取被锁资源，但禁止修改。")]),t._v(" "),s("li",[t._v("适用于读多写少的场景，如 "),s("code",[t._v("SELECT ... LOCK IN SHARE MODE")]),t._v("。")])])]),t._v(" "),s("li",[s("strong",[t._v("排他锁（X锁，LOCK_MODE=2）")]),t._v(" "),s("ul",[s("li",[t._v("禁止其他事务读写被锁资源，仅当前事务可修改。")]),t._v(" "),s("li",[t._v("常用于数据更新操作（如 "),s("code",[t._v("UPDATE")]),t._v("、"),s("code",[t._v("DELETE")]),t._v("）。")])])]),t._v(" "),s("li",[s("strong",[t._v("意向共享锁（IS锁，LOCK_MODE=3）")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("表级锁")]),t._v("，表示事务计划在表中某些行上添加共享锁（S锁）。")]),t._v(" "),s("li",[t._v("作用：通过提前声明意向，避免其他事务对表结构进行不兼容操作（如加X锁）。")])])]),t._v(" "),s("li",[s("strong",[t._v("意向排他锁（IX锁，LOCK_MODE=4）")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("表级锁")]),t._v("，表示事务计划在表中某些行上添加排他锁（X锁）。")]),t._v(" "),s("li",[t._v("作用：与IS锁类似，但用于更高粒度的排他操作声明，例如批量更新前的预检测。")])])])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" V$"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LOCK")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" TABLE_ID "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" OBJECT_ID\n                   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" DBA_OBJECTS\n                   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" OWNER "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OWNER'")]),t._v("\n                     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" OBJECT_NAME "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OBJECT_NAME'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"批量禁用某个用户-模式下所有外键约束"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#批量禁用某个用户-模式下所有外键约束"}},[t._v("#")]),t._v(" 批量禁用某个用户/模式下所有外键约束")]),t._v(" "),s("p",[t._v("其他索引应该能以同样方式拼接禁用语句")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alter table '")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("table_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("' disable constraint '")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constraint_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("';'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_constraints t\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("owner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DMHR'")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 用户/模式名")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("constraint_type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'R'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"用户锁定-解锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户锁定-解锁"}},[t._v("#")]),t._v(" 用户锁定/解锁")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询系统中锁定的用户及对应的锁定时间：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("account_status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n       t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lock_date\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" dba_users t\n "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("account_status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'LOCKED'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 对于被锁定的用户，可以使用SYSDBA或者具有alter user权限的用户解锁。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v(" hruser ACCOUNT "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNLOCK")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--解锁用户")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v(" hruser ACCOUNT "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LOCK")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--锁定某用户")]),t._v("\n")])])]),s("h2",{attrs:{id:"faq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[t._v("#")]),t._v(" FAQ")]),t._v(" "),s("h4",{attrs:{id:"大数据量表加字段慢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#大数据量表加字段慢"}},[t._v("#")]),t._v(" 大数据量表加字段慢")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" SF_GET_SESSION_PARA_VALUE "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ALTER_TABLE_OPT'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询会话参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SESSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ALTER_TABLE_OPT'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PURGE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 修改会话参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SESSION")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ALTER_TABLE_OPT'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PURGE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 恢复会话参数（将0替换为第1步所查询参数）")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);