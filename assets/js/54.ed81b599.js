(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{385:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"oracle-常用性能排查语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oracle-常用性能排查语句"}},[s._v("#")]),s._v(" Oracle 常用性能排查语句")]),s._v(" "),t("h4",{attrs:{id:"查看表空间大小"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看表空间大小"}},[s._v("#")]),s._v(" 查看表空间大小")]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--oracle表空间大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       total "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间大小"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       free "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间剩余大小"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" free"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间使用大小"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间大小(G)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("free "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间剩余大小(G)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" free"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表空间使用大小(G)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" free"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"使用率 %"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" tablespace_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" free\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" dba_free_space\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" tablespace_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" tablespace_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" total\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" dba_data_files\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" tablespace_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" b\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name\n")])])]),t("p",[t("strong",[s._v("查看单表占用磁盘空间")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLESPACE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OWNER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_TYPE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BYTES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" MB\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DBA_SEGMENTS T\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_TYPE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TABLE'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TABLE_NAME'")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLESPACE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OWNER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SEGMENT_TYPE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" T\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MB "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查看锁表及解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看锁表及解决"}},[s._v("#")]),s._v(" 查看锁表及解决")]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("下面的语句用来查询哪些对象被锁：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" object_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,l.ORACLE_USERNAME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dba_objects o "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("　o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("下面的语句用来杀死一个进程：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'24,111'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("其中"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("分别是上面查询出的sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#);")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("批量删除\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter system kill session '''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# || '''' || ';'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dba_objects o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id　 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 　o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" object_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_TEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,s.status,lockwait,machine,program")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dba_objects o "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" a\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("　o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HASH_VALUE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_HASH_VALUE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nUsername：死锁语句所用的数据库用户；\nLockwait：死锁的状态，如果有内容表示被死锁。\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Status")]),s._v("： 状态，active表示被死锁\nMachine： 死锁语句所在的机器。\nProgram： 产生死锁的语句主要来自哪个应用程序。\n\n\n\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_id　　文件ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name　　表空间"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_name　　　　　物理文件名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes　　　　　　　总字节数"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("　　　已使用"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("　　　　　　　　剩余"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n　　      "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("　剩余百分比\n　　 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dba_free_space a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dba_data_files b\n　　"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_id\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tablespace_name\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--最新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" object_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_TEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,s.status,lockwait,machine,program,l.ORACLE_USERNAME")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$locked_object l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dba_objects o "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" a\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id　"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("　o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("object_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("session_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HASH_VALUE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_HASH_VALUE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1902,24317'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" ysgl_guanli\n")])])]),t("h4",{attrs:{id:"查询行锁并解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询行锁并解决"}},[s._v("#")]),s._v(" 查询行锁并解决")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------------- 方案1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--行锁查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SERIAL")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,s.MACHINE,s.TYPE,l.TYPE,l.CTIME,l.BLOCK,l.REQUEST,l.LMODE,")]),s._v("\n       decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lmode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'None'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Null'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Row-S (SS)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Row-X (SX)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Share'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'S/Row-X (SSX)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Exclusive'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" substr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lmode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Locked Mode"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       DECODE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("L"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MR'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'File_ID:'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" L"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ID1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TM'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TX'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'USN:'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TRUNC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("L"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ID1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'RWO:'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'None'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" L"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ID1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" LOCK_ID1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter system kill session '''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SERIAL")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# || '''immediate;' as \"Kill\"")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" gv$process p\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("inner")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PADDR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ADDR\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("inner")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v(" l\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SID\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj$ t\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ID1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("obj$ r\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ROW_WAIT_OBJ"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# = r.obj#")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MR'")]),s._v(" \n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TM'")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" l"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lmode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看原因?")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" sessions "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+materialize*/")]),s._v("\n         sid\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sql_id\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("blocking_session\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("row_wait_obj"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" LPAD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEVEL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" sid sid\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sql_id\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("event\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("owner"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("owner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("object_name object_name\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("substr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql_text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" sql_text\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sessions s\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" dba_objects "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" row_wait_obj"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USING")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sql_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" blocking_session "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" sessions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" blocking_session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONNECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" PRIOR sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" blocking_session\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" blocking_session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------------- 方案2")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter system kill session '''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# || ',@' ||")]),s._v("\n       ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''' immediate;'")]),s._v(" db_kill_session\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" ss\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("final_blocking_session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("final_blocking_instance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("final_blocking_session "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"刷新表统计信息-做表分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#刷新表统计信息-做表分析"}},[s._v("#")]),s._v(" 刷新表统计信息（做表分析）")]),s._v(" "),t("p",[s._v("  统计信息主要是描述数据库中表，索引的大小，规模，数据分布状况等的一类信息。例如，表的行数，块数，平均每行的大小，索引的leaf blocks，索引字段的行数，不同值的大小等，都属于统计信息。CBO正是根据这些统计信息数据，计算出不同访问路径下，不同join 方式下，各种计划的成本，最后选择出成本最小的计划。")]),s._v(" "),t("p",[s._v("  统计信息是存放在数据字典表中的，如tab$，一般可通过察看某些视图来获取统计信息状况，如DBA_TABLES，DBA_INDEXES，DBA_TAB_COL_STATISTICS， DBA_TAB_HISTOGRAMS等。在这些视图中包含表示统计信息的一些字段，这些字段只有搜集过统计信息之后才有值，否则是空的。例如：last_analyzed 字段表示上次统计信息搜集的时间，可以根据这个字段，快速的了解最近一次统计信息搜集的时间。")]),s._v(" "),t("p",[t("strong",[s._v("博客：")]),s._v(" "),t("a",{attrs:{href:"https://www.cnblogs.com/youngerger/p/9050679.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("有关Oracle统计信息的知识点"),t("OutboundLink")],1),t("br"),s._v(" "),t("strong",[s._v("博客：")]),s._v(" "),t("a",{attrs:{href:"https://www.xp.cn/b.php/7376.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Oracle 11g新特性之统计信息收集"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--当表没有做分析的时候，Oracle 会使用动态采样来收集统计信息。获取准确的段对象（表，表分区，索引等）的分析数据，是CBO存在的基石，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--CBO的机制就是收集尽可能多的对象信息和系统信息，通过对这些信息进行计算，分析，评估，最终得出一个成本最低的执行计划。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--所以对于CBO，数据段的分析就非常重要。")]),s._v("\n\n解锁单个用户"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("schema")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v(" dbms_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unlock_schema_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n单个表统计数据的统计数据更新\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXEC")]),s._v(" dbms_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gather_table_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'【username】'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'【tablename】'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" estimate_percent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dbms_stats"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auto_sample_size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cascade")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- EXEC dbms_stats.gather_table_stats('【username】','【tablename】',cascade=>true);")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- analyze table tablename compute statistics 等同于 analyze table tablename compute statistics for table for all indexes for all columns")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 更新整个用户所有表的统计数据更新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- EXEC dbms_stats.gather_schema_stats('【username】',estimate_percent=>100,cascade=> TRUE);")]),s._v("\n\n\n参数说明: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https:"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//www.cnblogs.com/tingxin/p/12663682.html)")]),s._v("\nownname:要分析表的拥有者\ntabname:要分析的表名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\npartname:分区的名字"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("只对分区表或分区索引有用"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nestimate_percent:采样行的百分比"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("取值范围"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000001")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v("为全部分析"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不采样"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 常量:DBMS_STATS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AUTO_SAMPLE_SIZE是默认值"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("由oracle决定最佳取采样值"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nblock_sapmple:是否用块采样代替行采样"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nmethod_opt:决定histograms信息是怎样被统计的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method_opt的取值如下"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认值为"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COLUMNS")]),s._v(" SIZE AUTO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("columns")]),s._v(":统计所有列的histograms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" indexed "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("columns")]),s._v(":统计所有indexed列的histograms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" hidden "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("columns")]),s._v(":统计你看不到列的histograms\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("columns")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("list"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SIZE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" AUTO "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SKEWONLY:统计指定列的histograms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("N的取值范围"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("254")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),s._v("上次统计过的histograms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("AUTO由oracle决定N的大小"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("SKEWONLY multiple "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("points "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" the same "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),s._v(" which "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" what we define "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(' "there '),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" skew "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" thedata\ndegree:决定并行度"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("默认值为"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\ngranularity:Granularity "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("statistics")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" collect "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("only pertinent "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" partitioned"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cascade")]),s._v(":是收集索引的信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("默认为"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nstattab:指定要存储统计信息的表"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("statid如果多个表的统计信息存储在同一个stattab中用于进行区分"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("statown存储统计信息表的拥有者"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("以上三个参数若不指定"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("统计信息会直接更新到数据字典"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nno_invalidate: Does "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" invalidate the dependent cursors "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" The "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),s._v(" invalidates the dependent cursors immediately "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(":即使表锁住了也收集统计信息"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n\n这是对命令与工具包的一些总结\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("、对于分区表，建议使用DBMS_STATS，而不是使用"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Analyze")]),s._v("语句。\na"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以并行进行，对多个用户，多个"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v("\nb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以得到整个分区表的数据和单个分区的数据。\nc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以在不同级别上"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Compute")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Statistics")]),s._v("：单个分区，子分区，全表，所有分区\nd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以倒出统计信息\ne"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以用户自动收集统计信息\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("、DBMS_STATS的缺点\na"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 不能Validate Structure\nb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 不能收集CHAINED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROWS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 不能收集CLUSTER "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v("的信息，这两个仍旧需要使用"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Analyze")]),s._v("语句。\nc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DBMS_STATS 默认不对索引进行"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Analyze")]),s._v("，因为默认"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Cascade")]),s._v("是"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("，需要手工指定为"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("、对于oracle "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("里面的External "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v("，"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Analyze")]),s._v("不能使用，只能使用DBMS_STATS来收集信息。\n\n")])])]),t("h4",{attrs:{id:"查询正在执行的sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询正在执行的sql"}},[s._v("#")]),s._v(" 查询正在执行的SQL")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid oracleID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username 登录Oracle用户名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,")]),s._v("\n       spid 操作系统ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       paddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       sql_text 正在执行的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       sql_fulltext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("machine 计算机名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EVENT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter system kill session '''")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#||''';'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" gv$process a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" gv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" c\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("paddr\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql_hash_value "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash_value\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("inst_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ACTIVE'")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查询sql平均耗时"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询sql平均耗时"}},[s._v("#")]),s._v(" 查询SQL平均耗时")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--根据平均耗时大小排序")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_TEXT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_ID"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"总执行次数"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"总耗时(秒)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n       nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"平均耗时（秒）"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PARSE_CALLS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"硬解析次数"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DISK_READS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"物理读次数"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BUFFER_GETS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"读缓存区次数"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FIRST_LOAD_TIME "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sql开始执行时间"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),s._v(" a\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first_load_time "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2022-07-13%'")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n          nvl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"慢查询耗时"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#慢查询耗时"}},[s._v("#")]),s._v(" 慢查询耗时")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 慢查询耗时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SQL_TEXT "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行 SQL"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"执行次数"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"总执行时间"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"平均执行时间"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("COMMAND_TYPE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PARSING_USER_ID "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户ID"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HASH_VALUE\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$sqlarea sa\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("join")]),s._v(" all_users u\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PARSING_USER_ID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user_id\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ELAPSED_TIME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" sa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("EXECUTIONS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" rownum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"找到正在运行的存储过程并杀死"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#找到正在运行的存储过程并杀死"}},[s._v("#")]),s._v(" 找到正在运行的存储过程并杀死")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ddl锁 dba_ddl_locks")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("查询正在运行的存储过程（包、函数等）\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$db_object_cache "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PROCEDURE'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PACKAGE BODY'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PACKAGE'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" locks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" pins "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 获取ddl锁的信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dba_ddl_locks "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" owner "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'XXX'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'XXX'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("找到对应存储过程的sid\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+rule */")]),s._v(" sid "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$access o "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" OWNER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'过程的所属用户'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" o"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OBJECT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'存储过程'")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--（参数是存储过程名称）")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("根据sid找到对应的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# from v$session a WHERE A.SID='sid'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("终止运行存储过程\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sid,serial#'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("例如："),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("kill")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sid,serial#'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h4",{attrs:{id:"其他"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--查询当前用户使用了多少还原表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("writes\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transaction")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$rollstat b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$rollname c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" d\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("taddr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("addr\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xidusn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usn\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usn\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看临时表空间的使用情况")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("phyrds "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"reads"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("phywrts "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"writes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("phyblkrd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("phyblkwrt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("readtim "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rtime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("writetim "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wtime"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tablespace")]),s._v(" ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$tempfile tf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$tempstat ts\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" ts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ts"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#=tf.ts#")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" tf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#=ts.file#;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看数据文件的i/o分布情况")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("phyrds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("phywrts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("readtim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("writetim\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$filestat a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("v$datafile b\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#=b.file#")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" readtim "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看连接oracle的所有机器的连接数和状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" machine"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\nSGA(System Global Area)：由所有服务进程和后台进程共享；\nPGA(Program Global Area)：由每个服务进程、后台进程专有；每个进程都有一个PGA。\n*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- oracle的PGA、SGA和process count")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SGA'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ROUND")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'M'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SIZE(M)"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$sga\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PGA'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ROUND")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'M'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SIZE(M)"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$pgastat "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total PGA allocated'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TOTAL'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ROUND")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$sga"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ROUND")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$pgastat "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'total PGA allocated'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'M'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SIZE(M)"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DUAL\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNION")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("TO_CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" V$PGASTAT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'process count'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"scn"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scn"}},[s._v("#")]),s._v(" SCN")]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("SCN（System Change Number），也就是通常所说的系统改变号，是数据库中非常重要的一个数据结构。\nSCN用以标识数据库在某个确切时刻提交的版本。在事务提交时，它被赋予一个唯一的标识事务的SCN。SCN同时被作为Oracle数据库的内部时钟机制，可被看做逻辑时钟，每个数据库都有一个全局的SCN生成器。\n作为数据库内部的逻辑时钟，数据库事务依SCN而排序，Oracle也依据SCN来实现一致性读（"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Read")]),s._v(" Consistency）等重要数据库功能。另外对于分布式事务（"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Distributed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Transactions")]),s._v("），SCN也极为重要，这里不做更多介绍。\nSCN在数据库中是唯一的，并随时间而增加，但是可能并不连贯。除非重建数据库，SCN的值永远不会被重置为"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.")]),s._v("\n一直以来，对于SCN有很多争议，很多人认为SCN是指System "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Commit")]),s._v(" Number，而通常SCN在提交时才变化，所以很多时候，这两个名词经常在文档中反复出现。即使在Oracle的官方文档中，SCN也常以System Change"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Commit")]),s._v(" Number两种形式出现。\n到底是哪个词其实不是很重要，重要的是需要知道SCN是Oracle内部的时钟机制，Oracle通过SCN来维护数据库的一致性，并通过SCN实施Oracle至关重要的恢复机制。\nSCN在数据库中是无处不在，常见的事务表、控制文件、数据文件头、日志文件、数据块头等都记录有SCN值。\n冠以不同前缀，SCN也有了不同的名称，如检查点SCN（Checkpint SCN）、Resetlogs SCN等。\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 当前scn号和时间的对应关系：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" dbms_flashback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_system_change_number"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("SCN_TO_TIMESTAMP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dbms_flashback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_system_change_number"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询当前scn：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" CURRENT_SCN "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" dbms_flashback"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_system_change_number "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- SCN与时间的相互转换")]),s._v("\n将SCN转换成时间戳: SCN_TO_TIMESTAMP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scn_number"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n将时间戳转换成SCN: TIMESTAMP_TO_SCN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("timestamp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 数据行伪列保存数据最后更新时间  select ora_rowscn from table_name;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 系统表保存scn与时间戳对应关系（保留5天）   SELECT * FROM sys.smon_scn_time")]),s._v("\n\n了解更多请核查看博客：https:"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//blog.csdn.net/fuwencaho/article/details/21256973")]),s._v("\n\n")])])]),t("h3",{attrs:{id:"oracle-表闪回"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oracle-表闪回"}},[s._v("#")]),s._v(" Oracle 表闪回")]),s._v(" "),t("p",[s._v("查看是否开启闪回功能："),t("code",[s._v("SELECT flashback_on FROM V$DATABASE;")])]),s._v(" "),t("h4",{attrs:{id:"查询历史版本数据-闪回查询"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询历史版本数据-闪回查询"}},[s._v("#")]),s._v(" 查询历史版本数据（闪回查询）")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询出类似拉链表的数据（包含历史版本）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" \n       字段名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       TO_CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VERSIONS_STARTTIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yyyy-MM-dd hh24:mi:ss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" VERSIONS_STARTTIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       TO_CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VERSIONS_ENDTIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yyyy-MM-dd hh24:mi:ss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" VERSIONS_ENDTIME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       VERSIONS_OPERATION\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" 表名 VERSIONS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("BETWEEN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),s._v(" MINVALUE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" MAXVALUE\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" VERSIONS_STARTTIME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" VERSIONS_STARTTIME "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"恢复已删除的表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恢复已删除的表"}},[s._v("#")]),s._v(" 恢复已删除的表")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 恢复已删除的表")]),s._v("\nflashback "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" before "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 若删除后已经创建了同名的表（ORA-38312）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 如果表名重复，则闪回时遵循后入先出的原则。")]),s._v("\nflashback "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" test "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" before "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rename")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" test1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("扩展：")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 闪回时可指明被恢复的回收站对象")]),s._v("\nflashback "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BIN$AyId7ZbBjWngUKjADQIIuA==$0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" before "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 闪回删表的工作原理是：当“drop table”命令执行时，表及其索引并没有被真正删除，其所占空间只是分配给了另一个数据库对象：回收站对象，本质上相当于重命名。注意：表空间在自动增长的压力下会按照先入先出的规则将回收站对象的空间分配给需要空间的段，在将回收站对象耗尽之前数据文件是不会自动增长的。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Oracle启用回收站功能后，使用drop table ...语句删除一张表时，并不会将表给删除，而是以一定的格式重新对表重命名，然后将该表放到数据字典表中，在遇到表空间不足的情况下自动清理这些表，释放被占用的空间，让其它对象能够使用这些空间。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 可禁用回收站功能")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" recyclebin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OFF'")]),s._v(" scope"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("spfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 清理指定用户的表空间中的回收站对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PURGE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" USERS "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" user_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除当前用户回收站的所有对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("purge")]),s._v(" recyclebin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- dbms_flashback包")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 利用dbms_flashback包的enable_at_time或enable_at_scn存储过程锁定一个会话级别的闪回时间目标，即进入闪回模式，随后的查询命令可以省略“as of”，直到调用dbms_flashback_disable存储过程将其关闭为止。")]),s._v("\n")])])]),t("h4",{attrs:{id:"恢复表到某个时间点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#恢复表到某个时间点"}},[s._v("#")]),s._v(" 恢复表到某个时间点")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 确定要恢复的表的时间点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OF")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_timestamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2024-08-29 19:00:00'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yyyy-MM-dd hh24:mi:ss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 将表恢复到指定时间点")]),s._v("\nFLASHBACK "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_timestamp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2024-08-29 19:00:00'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yyyy-MM-dd hh24:mi:ss'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 1. "FLASHBACK TABLE"命令的执行者必须有"FLASHBACK ANY TABLE"系统权限或者在被闪回的表上具有"FLASHBACK"对象权限。')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 2. 需启用行移动  alter table DEBT_T_FILE_INFO_FABZ_BAK enable row movement;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('-- 3. "FLASHBACK TABLE"属于DDL命令，隐式提交。')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 4. SYS用户的任何表无法使用此功能。")]),s._v("\n")])])]),t("h2",{attrs:{id:"logminer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logminer"}},[s._v("#")]),s._v(" LogMiner")]),s._v(" "),t("hr"),s._v(" "),t("p",[s._v("众所周知，所有对用户数据和数据字典的改变都记录在Oracle的Redo Log中，因此，Redo Log包含了所有进行恢复操作所需要的信息。但是，原始的Redo Log文件无法看懂，所以，Oracle从8i以后提供了一个非常有用的分析工具，称为LogMiner。使用该工具可以轻松获得Redo Log文件（包含归档日志文件）中的具体内容。特别是该工具可以分析出所有对于数据库的DML操作（INSERT、UPDATE、DELETE等）语句。Oracle 9i后可以分析DDL语句，另外还可分析得到一些必要的回滚SQL语句。LogMiner一个最重要的用途就是不用全部恢复数据库就可以恢复数据库的某个变化。该工具特别适用于调试、审计或者回退某个特定的事务。\nLogMiner工具既可以用来分析在线日志，也可以用来分析离线日志文件，既可以分析本身自己数据库的重作日志文件，也可以用来分析其它数据库的重作日志文件。当分析其它数据库的重作日志文件时，需要注意的是，LogMiner必须使用被分析数据库实例产生的字典文件，而不是安装LogMiner的数据库产生的字典文件，另外，必须保证安装LogMiner数据库的字符集和被分析数据库的字符集相同。源数据库（Source Database）平台必须和分析数据库（Mining Database）平台一样。\nOracle通过LogMiner工具对Redo Log进行挖掘，显示出一系列可读的信息，该过程称为日志挖掘。LogMiner通过V$LOGMNR_CONTENTS视图显示Redo Log中的信息。")]),s._v(" "),t("p",[s._v("总的说来，LogMiner工具的主要用途有：")]),s._v(" "),t("ol",[t("li",[s._v("跟踪数据库的变化：可以离线地跟踪数据库的变化，而不会影响在线系统的性能")]),s._v(" "),t("li",[s._v("回退数据库的变化：回退特定的变化数据，减少Point-In-Time Recovery的执行")]),s._v(" "),t("li",[s._v("优化和扩容计划：可通过分析日志文件中的数据以分析数据的增长模式")]),s._v(" "),t("li",[s._v("确定数据库的逻辑损坏时间：准确定位操作执行的时间和SCN")]),s._v(" "),t("li",[s._v("确定事务级要执行的精细逻辑恢复操作，可以取得相应的UNDO操作")]),s._v(" "),t("li",[s._v("执行后续审计")])]),s._v(" "),t("p",[s._v("了解更多请查看博客： https://blog.csdn.net/yes_is_ok/article/details/79296614")]),s._v(" "),t("h2",{attrs:{id:"动态性能视图-x-v-gv-v-gv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#动态性能视图-x-v-gv-v-gv"}},[s._v("#")]),s._v(" 动态性能视图(x$,v$,gv$,v_$,gv_$)")]),s._v(" "),t("hr"),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/database/oracle/oracle-database/12.2/refrn/V-ACCESS.html#GUID-760F107D-7D5F-4170-AB9C-DF80D03DC1B7",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档12.2"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" 数据库信息\nv$datafile 数据文件信息\nv$controlfile 控制文件信息\nv$logfile 重做日志信息\nv$instance 数据库实例信息\nv$log 日志组信息\nv$loghist 日志历史信息\nv$sga 数据库SGA信息\nv$parameter 初始化参数信息\nv$process 数据库服务器进程信息\nv$bgprocess 数据库后台进程信息\nv$controlfile_record_section 控制文件记载的各部分信息\nv$thread 线程信息\nv$datafile_header 数据文件头所记载的信息\nv$archived_log归档日志信息\nv$archive_dest 归档日志的设置信息\nv$logmnr_contents 归档日志分析的DML DDL结果信息\nv$logmnr_dictionary 日志分析的字典文件信息\nv$logmnr_logs 日志分析的日志列表信息\nv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tablespace")]),s._v(" 表空间信息\nv$tempfile 临时文件信息\nv$filestat 数据文件的I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("O统计信息\nv$undostat Undo数据信息\nv$rollname 在线回滚段信息\nv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" 会话信息\nv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("transaction")]),s._v(" 事务信息\nv$rollstat 回滚段统计信息\nv$pwfile_users 特权用户信息\nv$sqlarea 当前查询过的"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("语句访问过的资源及相关的信息\nv$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v(" 与v$sqlarea基本相同的相关信息\nv$sysstat 数据库系统状态信息\n")])])]),t("h2",{attrs:{id:"常用系统表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用系统表"}},[s._v("#")]),s._v(" 常用系统表")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq814965130/article/details/79305220?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&utm_relevant_index=10",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("dba_开头")])]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\ndba_users 数据库用户信息\ndba_segments 表段信息\ndba_extents 数据区信息\ndba_objects 数据库对象信息\ndba_tablespaces 数据库表空间信息\ndba_data_files 数据文件设置信息\ndba_temp_files 临时数据文件信息\ndba_rollback_segs 回滚段信息\ndba_ts_quotas 用户表空间配额信息\ndba_free_space 数据库空闲空间信息\ndba_profiles 数据库用户资源限制信息\ndba_sys_privs 用户的系统权限信息\ndba_tab_privs 用户具有的对象权限信息\ndba_col_privs 用户具有的列对象权限信息\ndba_role_privs 用户具有的角色信息\ndba_audit_trail 审计跟踪记录信息\ndba_stmt_audit_opts 审计设置信息\ndba_audit_object 对象审计结果信息\ndba_audit_session 会话审计结果信息\ndba_indexes 用户模式的索引信息\n")])])]),t("p",[t("strong",[s._v("user_开头")])]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("user_objects 用户对象信息\nuser_source 数据库用户的所有资源对象信息\nuser_segments 用户的表段信息\nuser_tables 用户的表对象信息\nuser_tab_columns 用户的表列信息\nuser_col_comments 用户的表列注释信息\nuser_constraints 用户的对象约束信息\nuser_sys_privs 当前用户的系统权限信息\nuser_tab_privs 当前用户的对象权限信息\nuser_col_privs 当前用户的表列权限信息\nuser_role_privs 当前用户的角色权限信息\nuser_indexes 用户的索引信息\nuser_ind_columns 用户的索引对应的表列信息\nuser_cons_columns 用户的约束对应的表列信息\nuser_clusters 用户的所有簇信息\nuser_clu_columns 用户的簇所包含的内容信息\nuser_cluster_hash_expressions 散列簇的信息\n\n")])])]),t("p",[t("strong",[s._v("all_开头")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("all_users 数据库所有用户的信息\nall_objects 数据库所有的对象的信息\nall_def_audit_opts 所有默认的审计设置信息\nall_tables 所有的表对象信息\nall_indexes 所有的数据库对象索引的信息\n\nsession_开头\nsession_roles 会话的角色信息\nsession_privs 会话的权限信息\n\nindex_开头\nindex_stats 索引的设置和存储信息\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("伪表"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\ndual 系统伪列表信息\n")])])]),t("h3",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),t("h4",{attrs:{id:"查看视图中用到的表和视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看视图中用到的表和视图"}},[s._v("#")]),s._v(" 查看视图中用到的表和视图")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" REFERENCED_TYPE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLACE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TO_CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("WM_CONCAT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" REFERENCED_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" SYS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ALL_DEPENDENCIES\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VIEW'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UPPER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'视图名'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" REFERENCED_TYPE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TABLE'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VIEW'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" REFERENCED_TYPE\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" REFERENCED_TYPE\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"用到-某个表-的视图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用到-某个表-的视图"}},[s._v("#")]),s._v(" 用到 某个表 的视图")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" REFERENCED_TYPE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLACE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TO_CHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("WM_CONCAT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" REFERENCED_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" SYS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ALL_DEPENDENCIES\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VIEW'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" REFERENCED_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'表名'")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" REFERENCED_TYPE\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" REFERENCED_TYPE\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查看视图或表创建语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看视图或表创建语句"}},[s._v("#")]),s._v(" 查看视图或表创建语句")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" all_views "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" VIEW_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UPPER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'视图名'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查询建表语句-不含注释"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询建表语句-不含注释"}},[s._v("#")]),s._v(" 查询建表语句（不含注释）")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" dbms_metadata"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_ddl"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TABLE'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("upper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tablename'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查看函数、存储过程、触发器、包等创建语句"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看函数、存储过程、触发器、包等创建语句"}},[s._v("#")]),s._v(" 查看函数、存储过程、触发器、包等创建语句")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" OWNER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" listagg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TEXT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITHIN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" line"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TEXT")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ALL_SOURCE\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OBJECT_NAME'")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" owner "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'USER_NAME'")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" OWNER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v("\n")])])]),t("h4",{attrs:{id:"迁移数据-大批量操作数据-前禁用索引"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#迁移数据-大批量操作数据-前禁用索引"}},[s._v("#")]),s._v(" 迁移数据（大批量操作数据）前禁用索引！！！")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALTER INDEX '")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' UNUSABLE;'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALTER INDEX '")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("' REBUILD;'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" user_indexes idx\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" USER_IND_COLUMNS IDXC\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" IDX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IDXC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_NAME\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" IDX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INDEX_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IDXC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INDEX_NAME\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" IDX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UNIQUENESS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'UNIQUE'")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" IDX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" UPPER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DATA_TARGET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DEBT_T_EXC_CONFIG_PARAM\n                           "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" EXC_TYPE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'QY_IN'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*指定表清单*/")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXISTS")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" ucc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ucc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("COLUMN_NAME\n                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" USER_CONS_COLUMNS ucc\n                  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" USER_CONSTRAINTS uc\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" ucc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CONSTRAINT_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" uc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CONSTRAINT_NAME\n                 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" uc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CONSTRAINT_TYPE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'P'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" t\n         "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" idx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name\n           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" IDXC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("COLUMN_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("COLUMN_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*过滤掉主键列上的索引*/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"查询数据表自上次统计信息收集以来数据变化量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询数据表自上次统计信息收集以来数据变化量"}},[s._v("#")]),s._v(" 查询数据表自上次统计信息收集以来数据变化量")]),s._v(" "),t("p",[s._v("DBA_TAB_MODIFICATIONS记录自上次统计信息收集以来表上的DML操作（INSERT、UPDATE、DELETE）及TRUNCATE操作的历史数据；该视图依赖于后台作业"),t("code",[s._v("MMON")]),s._v("（15min执行一次），手动执行 "),t("code",[s._v("exec DBMS_STATS.FLUSH_DATABASE_MONITORING_INFO;")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 需要启用表监控（激活表修改跟踪）（10g之后，10g之前需手动开启表监控alter table MODIFI_TEST nomonitoring/MONITORING）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 1. 设置设置统计级别")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" parameter statistics_level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看参数值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--alter system set statistics_level=TYPICAL;   -- 参数设为TYPICAL或ALL")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--alter session set statistics_level=TYPICAL; ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_OWNER"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INSERTS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UPDATES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DELETES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       TABS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LAST_ANALYZED  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 最后分析时间")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DBA_TAB_MODIFICATIONS MODIF\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" DBA_TABLES TABS\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TABS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OWNER\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TABS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_NAME\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TABLE_OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'QY_CZB_RZPT_OUT'")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" SYSDATE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTERVAL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'30'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DAY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询最近 1 天内变动的表")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" MODIF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"与mysql区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#与mysql区别"}},[s._v("#")]),s._v(" 与MySQL区别")]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1、oracle是大型数据库，mysql是小型数据库；\n2、mysql是主键是支持自动增长类型的（在创建表的时候指定表的主键为auto_increment）,在插入记录时，不需要再指定该记录的主键值，mysql将自动增长；\n3、oracle没有自动增长类型主键一般使用序列，在插入记录时，将序列号的下一个值付给该字段即可；\n4、mysql可以用双引号包起字符串，而oracle只能用单引号包起。\n5、处理分页逻辑不一样，mysql使用limit处理分页；而oracle使用rownum字段标明位置，并且只能用rowNum&lt;100,不能用rowNum>80;\n6、mysql定义的空字段里面可以有空的内容，但是oracle种非空字段不能有空的内；\n7、两者都能使用like “%字符串%”,但是oracle中使用模糊查询后不能使用索引，速度不快；\n8、两者给字段添加注释的方式不一样，\n\n————————————————\n原文链接：https://blog.csdn.net/z19950712/article/details/115478505\n")])])]),t("h2",{attrs:{id:"shell跑oracle脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shell跑oracle脚本"}},[s._v("#")]),s._v(" Shell跑oracle脚本")]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filepath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/home/ap/user"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#输入Oracle数据库的用户名密码等信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBINFO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username/password@ip:port/orcl"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${logpath}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" log\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Y%m%d %H:%M:%S'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('] Info: Begin to execute init sql!"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${logpath}")]),s._v('/init_table_data_info.log"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#“${logfile} 2>&1”这里的意思就是把标准输出信息和错误输出信息都记录在init_table_data_info.log文件中")]),s._v("\nsqlplus -s "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DBINFO}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${logfile}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v("\nwhenever oserror "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nwhenever sqlerror "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${filepath}")]),s._v("/initTable.sql\n@"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${filepath}")]),s._v("/initTable2.sql\nquit\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(" -ne "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Y%m%d %H:%M:%S'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('] Error: Initialize initTable failed!"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${logpath}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Y%m%d %H:%M:%S'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('] Initialize initTable  successed."')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${logpath}")]),s._v("\n")])])]),t("h2",{attrs:{id:"oracle关联方式-执行计划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oracle关联方式-执行计划"}},[s._v("#")]),s._v(" Oracle关联方式（执行计划）")]),s._v(" "),t("p",[s._v("为啥有说只有三种的"),t("span",{staticStyle:{color:"red"}},[s._v("（待完善！！！）")])]),s._v(" "),t("blockquote",[t("p",[s._v("不同数据库支持情况不同：PGSQL支持 nested-loop join 、hash join 、merge join；MySQL只支持 nested-loop join")])]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Oracle的SQL优化器（Optimizer）在执行多表连接查询时，通常采用的连接算法有以下几种方式：\n1、嵌套循环连接（NESTED LOOPS JOIN）\n2、哈希连接（HASH JOIN）\n3、排序合并连接（SORT MERGE JOIN）\n4、笛卡尔连接（CARTESIAN JOIN）\n5、群集连接（CLUSTER JOIN）\n6、索引连接（INDEX JOIN）\n")])])]),t("p",[s._v("多表之间的连接有三种方式：Nested Loops，Hash Join 和 Sort Merge Join. 下面来介绍三种不同连接的不同：")]),s._v(" "),t("p",[t("strong",[s._v("NESTED LOOP")])]),s._v(" "),t("blockquote",[t("p",[s._v("对于被连接的数据子集较小的情况，嵌套循环连接是个较好的选择。在嵌套循环中，内表被外表驱动，外表返回的每一行都要在内表中检索找到与它匹配的行，因此整个查询返回的结果集不能太大（大于1 万不适合），要把返回子集较小表的作为外表（CBO 默认外表是驱动表），而且在内表的连接字段上一定要有索引。当然也可以用ORDERED 提示来改变CBO默认的驱动表，使用USE_NL(table_name1 table_name2)可是强制CBO 执行嵌套循环连接。")])]),s._v(" "),t("blockquote",[t("p",[s._v("Nested loop一般用在连接的表中有索引，并且索引选择性较好的时候.")])]),s._v(" "),t("blockquote",[t("p",[s._v("步骤：确定一个驱动表(outer table)，另一个表为inner table，驱动表中的每一行与inner表中的相应记录JOIN。类似一个嵌套的循环。适用于驱动表的记录集比较小（<10000）而且inner表需要有有效的访问方法（Index）。需要注意的是：JOIN的顺序很重要，驱动表的记录集一定要小，返回结果集的响应时间是最快的。")])]),s._v(" "),t("p",[t("strong",[s._v("HASH JOIN")])]),s._v(" "),t("blockquote",[t("p",[s._v("散列连接是CBO 做大数据集连接时的常用方式，优化器使用两个表中较小的表（或数据源）利用连接键在内存中建立散列表，然后扫描较大的表并探测散列表，找出与散列表匹配的行。\n这种方式适用于较小的表完全可以放于内存中的情况，这样总成本就是访问两个表的成本之和。但是在表很大的情况下并不能完全放入内存，这时优化器会将它分割成若干不同的分区，不能放入内存的部分就把该分区写入磁盘的临时段，此时要有较大的临时段从而尽量提高I/O 的性能。\n也可以用USE_HASH(table_name1 table_name2)提示来强制使用散列连接。如果使用散列连接HASH_AREA_SIZE 初始化参数必须足够的大，如果是9i，Oracle建议使用SQL工作区自动管理，设置WORKAREA_SIZE_POLICY 为AUTO，然后调整PGA_AGGREGATE_TARGET 即可。")])]),s._v(" "),t("blockquote",[t("p",[s._v("Hash join在两个表的数据量差别很大的时候.")])]),s._v(" "),t("blockquote",[t("p",[s._v("步骤：将两个表中较小的一个在内存中构造一个HASH表（对JOIN KEY），扫描另一个表，同样对JOIN KEY进行HASH后探测是否可以JOIN。适用于记录集比较大的情况。需要注意的是：如果HASH表太大，无法一次构造在内存中，则分成若干个partition，写入磁盘的temporary segment，则会多一个写的代价，会降低效率。")])]),s._v(" "),t("p",[t("strong",[s._v("SORT MERGE JOIN")])]),s._v(" "),t("blockquote",[t("p",[s._v("通常情况下散列连接的效果都比排序合并连接要好，然而如果行源已经被排过序，在执行排序合并连接时不需要再排序了，这时排序合并连接的性能会优于散列连接。可以使用USE_MERGE(table_name1 table_name2)来强制使用排序合并连接.\nSort Merge join 用在没有索引，并且数据已经排序的情况.\ncost = (outer access cost * # of hash partitions) + inner access cost")])]),s._v(" "),t("blockquote",[t("p",[s._v("步骤：将两个表排序，然后将两个表合并。通常情况下，只有在以下情况发生时，才会使用此种JOIN方式：")]),s._v(" "),t("blockquote",[t("p",[s._v("1.RBO模式"),t("br"),s._v("\n2.不等价关联(>,<,>=,<=,<>)"),t("br"),s._v("\n3.HASH_JOIN_ENABLED=false"),t("br"),s._v("\n4.数据源已排序")])])]),s._v(" "),t("p",[t("strong",[s._v("三种连接工作方式比较")])]),s._v(" "),t("blockquote",[t("p",[s._v("Hash join的工作方式是将一个表（通常是小一点的那个表）做hash运算，将列数据存储到hash列表中，从另一个表中抽取记录，做hash运算，到hash 列表中找到相应的值，做匹配。")])]),s._v(" "),t("blockquote",[t("p",[s._v("Nested loops 工作方式是从一张表中读取数据，访问另一张表（通常是索引）来做匹配，nested loops适用的场合是当一个关联表比较小的时候，效率会更高。")])]),s._v(" "),t("blockquote",[t("p",[s._v("Merge Join 是先将关联表的关联列各自做排序，然后从各自的排序表中抽取数据，到另一个排序表中做匹配，因为merge join需要做更多的排序，所以消耗的资源更多。 通常来讲，能够使用merge join的地方，hash join都可以发挥更好的性能。")])]),s._v(" "),t("p",[t("strong",[s._v("强制使用关联方式")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+use_hash(t,t1) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dept t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+use_nl(t,t1) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dept t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+use_merge(t,t1) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dept t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp t1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptno"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/tianlesoftware/article/details/5826546",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"点状知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#点状知识"}},[s._v("#")]),s._v(" 点状知识")]),s._v(" "),t("h3",{attrs:{id:"匹配中文"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#匹配中文"}},[s._v("#")]),s._v(" 匹配中文")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("使用正则匹配不太好使\n\n替换方案：chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 可以匹配双字节字符（同样不够准确）\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" regexp_replace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'['")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" chr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("']'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dual"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"创建dblink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建dblink"}},[s._v("#")]),s._v(" 创建DBLink")]),s._v(" "),t("blockquote",[t("p",[s._v("注：由于 dblink 跨库查询是把一个数据库数据通过网络发送到另一数据库关联查询，\n可以通过指定 hint "),t("code",[s._v("/*+ driving_site(t)*/")]),s._v(" 指定驱动表（t 一般是大表），从而减少网络传输。\n当然，最终效率还是要综合磁盘IO、网络IO和计算能力等综合考虑")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- Create database link ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" link "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dblink名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("connect")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("用户名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  IDENTIFIED "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"密码"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(DESCRIPTION =(ADDRESS_LIST =(ADDRESS =(PROTOCOL=TCP)(HOST=<ip>)(PORT=<端口>)))(CONNECT_DATA=(SERVICE_NAME=orcl)))'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"sql并行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql并行"}},[s._v("#")]),s._v(" SQL并行")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sqlrf/Comments.html#GUID-D316D545-89E2-4D54-977F-FC97815CD62E",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"http://blog.itpub.net/25542870/viewspace-2120924/",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文地址"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[s._v("1.查询开启并行（Parallel query）")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+parallel(a, 16)*/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dual a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第一种方式（Hist方式）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tab1 parallel n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("                          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第二种方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" parallel query parallel n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第三种方式")]),s._v("\n")])])]),t("ul",[t("li",[s._v("2.修改数据开启并行（Parallel DML (INSERT, UPDATE, DELETE, and MERGE) ）")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第一种方式（Hist方式）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+ PARALLEL(tab1,4) */")]),s._v(" tbl_2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" c1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("c1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+ PARALLEL(tbl_ins,2) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" tbl_ins\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+ PARALLEL(tbl_sel,4) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tbl_sel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*+ PARALLEL (t1, 2) */")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t1\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第二种方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("force")]),s._v(" parallel DML parallel n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第三种方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tab1 parallel n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[s._v("3.Parallel DDL")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第一种方式（Hist方式）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SESSION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FORCE")]),s._v(" PARALLEL DDL parallel n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 第二种方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" …"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parallel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" REBUILD parallel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" MOVE "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" parallel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SPLIT "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" parallel "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[s._v("附：存储过程中开启并行")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("execute")]),s._v(" immediate "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter session force parallel dml parallel  8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--更新操作")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--必须先commit,否则会报 ora-12841")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("execute")]),s._v(" immediate "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter session disable parallel dml '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nexception\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("when")]),s._v(" others "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rollback")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("execute")]),s._v(" immediate "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alter session disable parallel dml '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("注：使用临时表with as时不能使用并行（比如：在存储过程中开启session并行），否则会导致结果不一致")]),s._v(" "),t("h3",{attrs:{id:"中文排序方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#中文排序方式"}},[s._v("#")]),s._v(" 中文排序方式")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("Oracle9i之前，中文是按照二进制编码进行排序的。\n在oracle9i中新增了按照拼音、部首、笔画排序功能。设置NLS_SORT值\n\nSCHINESE_RADICAL_M 按照部首"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("第一顺序"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、笔划"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("第二顺序"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("排序\nSCHINESE_STROKE_M 按照笔划"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("第一顺序"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("、部首"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("第二顺序"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("排序\nSCHINESE_PINYIN_M 按照拼音排序\n\n修改ORACLE字段的默认排序方式：\n按拼音"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" nls_sort "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SCHINESE_PINYIN_M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n按笔画：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" nls_sort "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SCHINESE_STROKE_M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n按偏旁：\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" nls_sort "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" NLS_SORT"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SCHINESE_RADICAL_M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nNLSSORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，用来进行语言排序\n\n示例:\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" TEAM "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" NLSSORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("排序字段名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NLS_SORT =SCHINESE_PINYIN_M'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"数据中包含特殊符号需要转义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据中包含特殊符号需要转义"}},[s._v("#")]),s._v(" 数据中包含特殊符号需要转义")]),s._v(" "),t("ol",[t("li",[s._v("执行语句前先执行 "),t("code",[s._v("set define off;")]),s._v(" （去掉oracle自定义的字符含义，还原它本来的意思）")]),s._v(" "),t("li",[s._v("使用ASCII编码对 & 进行转义 chr(38)  "),t("code",[s._v("select 'xxx?xxx=11' || chr(38) || 'xxx=33' from dual")])]),s._v(" "),t("li",[s._v("不转义，直接字符串的形式写进去 "),t("code",[s._v("select 'xxx?xxx=11' || '&' || 'xxx=33' from dual")])])]),s._v(" "),t("h3",{attrs:{id:"数据泵导入导出-待完善"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据泵导入导出-待完善"}},[s._v("#")]),s._v(" 数据泵导入导出（待完善）")]),s._v(" "),t("p",[t("strong",[s._v("导入：首先我们需要知道导出用户和表空间的名字")])]),s._v(" "),t("p",[s._v("注意：1. 如果表空间不是只有一个，需要使用remap_tablespace指定到我们创建的表空间 2. 单个表空间文件最大32G")]),s._v(" "),t("blockquote",[t("p",[s._v("所以拿到导出log文件是非常有必要的")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建表空间  UNLIMITED指定不限制最大表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" BANANA datafile "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'E:\\OracleData\\tablespace\\DATAS.dbf'")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("m autoextend "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("next")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("m MAXSIZE UNLIMITED extent management "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("local")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" BANANA including contents "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" datafiles "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cascade")]),s._v(" constraints"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dba_tablespaces"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 管理员登录，创建新用户，分配已创建好的表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" banana identified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" banana "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" BANANA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 删除用户带级联")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" banana "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cascade")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 授权")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" dba "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" banana "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" admin "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询dup存放目录目录    注意：后面的E盘下面的dpdump 必须把你要导入的xxx.dmp文件放进该文件夹  DATA_PUMP_DIR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" dba_directories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 数据泵导入数据 (CMD命令行   DATA_PUMP_DIR为上面查出的目录名  如果有其他表空间的，需要使用remap_tablespace指定到我们创建的表空间)")]),s._v("\nimpdp banana remap_tablespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MOF:BANANA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("TEST:BANANA directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("XXX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DMP logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- FULL=YES parallel=16")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 增加指定表空间文件（单个表空间文件最大32G，需要扩充）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" BANANA "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" DATAFILE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'E:\\OracleData\\tablespace\\DATAS01.dbf'")]),s._v(" SIZE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("M AUTOEXTEND "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("NEXT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("M  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("strong",[s._v("导入导出实操过程命令保存")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 导出命令")]),s._v("\nexpdp username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("passwd"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@ip")]),s._v(":port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lgfv directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 导出后对数据包进行压缩（WinRAR工具分卷压缩）！！！减少网络传输")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 表空间创建（确定表空间足够，一个文件最大32G）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- create TABLESPACE RZPT datafile 'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\RZPT01.dbf' size 100m autoextend on next 100m MAXSIZE UNLIMITED extent management local; ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ALTER TABLESPACE RZPT ADD DATAFILE 'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\RZPT02.dbf' SIZE 100M AUTOEXTEND ON NEXT 100M  ;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建用户并授权")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" username2 identified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" passwd2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLESPACE")]),s._v(" RZPT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Grant")]),s._v(" dba "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" username2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" admin "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("option")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询原库用到的表空间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" TABLESPACE_NAME\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" DBA_SEGMENTS\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" OWNER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 导入命令")]),s._v("\nimpdp username2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("passwd2"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@localhost")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("orcl DIRECTORY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DUMPFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DMP remap_schema"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username:username2 remap_tablespace"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DSY:RZPT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CS_CZB_RZPT:RZPT LOGFILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log parallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 附：删除用户报有连接  查询会话并杀死")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sid"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("serial")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#, s.username, s.status, p.spid")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" v$"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("session")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v$process p\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("paddr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" p"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("addr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ALTER SYSTEM KILL SESSION '143,46649' ;")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 附：若导入卡在 处理对象类型 SCHEMA_EXPORT/TABLE/INDEX/INDEX 不动；")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" parameter "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dump")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 命令行执行，查看日志位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看 alert_orcl.log 若日志有相关提示")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,sequence#,bytes,members,status from v$log;   ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" logfile "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\REDO04.LOG'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" logfile "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\REDO05.LOG'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system switch logfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ALTER DATABASE DROP LOGFILE GROUP 4;   -- 删除旧组")]),s._v("\n")])])]),t("p",[t("strong",[s._v("报错处理")])]),s._v(" "),t("ol",[t("li",[s._v("ORA-39083: ORA-14460: 只能指定一个 COMPRESS 或 NOCOMPRESS 子句，导入命令加参数 "),t("code",[s._v("transform=segment_attributes:n")]),s._v(" （未实测）")])]),s._v(" "),t("p",[t("strong",[s._v("命令保存")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" directory my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/home/oracle/tmp'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("grant")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("write")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" directory my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 环境变量(若没配置好，需先执行)   若不搞好容易表注释乱码！！！")]),s._v("\nexport ORACLE_HOME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("product"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.2")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dbhome_1\nexport ORACLE_SID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("orcl\nexport PATH"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$ORACLE_HOME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin:$PATH\nexport NLS_LANG"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("AMERICAN_AMERICA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ZHS16GBK\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- exp/imp 导入导出指定表")]),s._v("\nexp 导出用户名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@orcl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tablename1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tablename2\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\nimp 导入用户名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@orcl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tablename1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tablename2\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" log"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("statistics")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- expdp/impdp 导入导出 ")]),s._v("\nexpdp $USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$PASSWD "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DUMPFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("据说可以为任意后缀名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" DIRECTORY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Oracle内变量"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FULL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y LOGFILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\nimpdp $USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$PASSWD directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("full")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\nexpdp $USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$PASSWD "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DUMPFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp DIRECTORY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR LOGFILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tablename1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tablename2\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\nimpdp $USERNAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$PASSWD directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DATA_PUMP_DIR "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tablename1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tablename2\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 参数")]),s._v("\nparallel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 并行导出")]),s._v("\ncontent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("metadata_only "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 元数据(包含表定义、存储过程、函数等等)")]),s._v("\ninclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("procedure")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("view")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexclude"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 排除")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------------------ 导出 ------------------------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导出一张表，例：")]),s._v("\nexpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导出多张表，例：")]),s._v("\nexpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dept\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导出一个用户(导出这个用户的所有对象)，例：")]),s._v("\nexpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导出多个用户，例：")]),s._v("\nexpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("hr\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导出整个数据库（sys、ordsys、mdsys的用户数据不会被导出）例：")]),s._v("\nexpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("full")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------------------ 导入 ------------------------------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导入dmp文件中的所有数据，例：")]),s._v("\nimpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("full")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导入一张表，例：")]),s._v("\nimpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导入多张表，例：")]),s._v("\nimpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("emp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dept\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导入一个用户，例：")]),s._v("\nimpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("scott\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##导入多个用户，例：")]),s._v("\nimpdp system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("oracle directory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("my_dir "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dumpfile")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("expdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dmp logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("impdp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log schemas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scott"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("hr\\"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"oracle-高版本导出-低版本导入-修改版本号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oracle-高版本导出-低版本导入-修改版本号"}},[s._v("#")]),s._v(" Oracle 高版本导出，低版本导入，修改版本号")]),s._v(" "),t("ol",[t("li",[s._v("使用 AlexTools 工具")]),s._v(" "),t("li",[s._v("导出时指定版本，增加参数（例：version=11.2）")])]),s._v(" "),t("h3",{attrs:{id:"redolog-导库、大批量、长事务是不是需要调整"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redolog-导库、大批量、长事务是不是需要调整"}},[s._v("#")]),s._v(" REDOLOG（导库、大批量、长事务是不是需要调整？）")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" parameter "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("dump")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 命令行执行，查看日志位置")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#,sequence#,bytes,members,status from v$log;   --查询日志组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#, MEMBER FROM V$LOGFILE;  -- 查看成员文件路径。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 增加日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" logfile "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\REDO04.LOG'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("M"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add")]),s._v(" logfile "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("group")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'D:\\APP\\ADMINISTRATOR\\ORADATA\\ORCL\\REDO05.LOG'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ALTER DATABASE ADD LOGFILE GROUP 4 ('/u01/oradata/redo04a.log', '/u02/oradata/redo04b.log') SIZE 200M;")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 切换日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" system switch logfile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ALTER DATABASE DROP LOGFILE GROUP 4;   -- 删除旧组 删除后需手动清理物理文件")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查询REDOLOG切换次数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" trunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Date"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Dy'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Day"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("COUNT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Total"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'00'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'01'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'02'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'03'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'04'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h4"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'05'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'06'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h6"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'07'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h7"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'08'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'09'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h9"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h10"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'11'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h11"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h12"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'13'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h13"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'14'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h14"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'15'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h15"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'16'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h16"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'17'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h17"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'18'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h18"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'19'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h19"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h20"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'21'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h21"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'22'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h22"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("decode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hh24'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'23'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h23"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" V$log_history\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" FIRST_TIME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" TRUNC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SYSDATE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MM'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" trunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" to_char"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("first_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Dy'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"解决本地oracle服务内存占用过高"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#解决本地oracle服务内存占用过高"}},[s._v("#")]),s._v(" 解决本地Oracle服务内存占用过高")]),s._v(" "),t("p",[t("strong",[s._v("Oracle安装时，为均衡电脑性能和数据库性能，默认内存大小为物理内存的1/8")])]),s._v(" "),t("ol",[t("li",[s._v("用dba身份进入oracle")]),s._v(" "),t("li",[s._v("show parameter sga; --显示内存分配情况")]),s._v(" "),t("li",[s._v("alter system set sga_target=1024m scope=spfile;-修改target大小 //这个值必须小于等于sga_max_size ，否则库会起不来；")]),s._v(" "),t("li",[s._v("alter system set sga_max_size=1024m scope=spfile; --修改最大占用内存的大小")]),s._v(" "),t("li",[s._v("修改后重启Oracle服务")]),s._v(" "),t("li",[s._v("附：Oracle服务介绍 "),t("a",{attrs:{href:"https://blog.csdn.net/Ren_gw/article/details/84592715",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),t("OutboundLink")],1),s._v(" "),t("ul",[t("li",[s._v("Oracle ORCL VSS Writer Service：Oracle卷映射拷贝写入服务，VSS（Volume Shadow Copy Service）能够让存储基础设备（比如磁盘，阵列等）创建高保真的时间点映像，即映射拷贝（shadow copy）。它可以在多卷或者单个卷上创建映射拷贝，同时不会影响到系统的系统能。"),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动）")])]),s._v(" "),t("li",[s._v("OracleDBConsoleorcl：Oracle数据库控制台服务，orcl是Oracle的实例标识，默认的实例为orcl。在运行Enterprise Manager（企业管理器OEM）的时候，需要启动这个服务。"),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动）")])]),s._v(" "),t("li",[s._v("OracleJobSchedulerORCL：Oracle作业调度（定时器）服务，ORCL是Oracle实例标识。"),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动）")])]),s._v(" "),t("li",[s._v("OracleMTSRecoveryService：服务端控制。该服务允许数据库充当一个微软事务服务器MTS、COM/COM+对象和分布式环境下的事务的资源管理器。"),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动）")])]),s._v(" "),t("li",[s._v("OracleOraDb11g_home1ClrAgent：Oracle数据库  .NET扩展服务的一部分。 "),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动）")])]),s._v(" "),t("li",[s._v("OracleOraDb11g_home1TNSListener：监听器服务，服务只有在数据库需要远程访问的时候才需要。"),t("span",{staticStyle:{color:"red"}},[s._v("（非必须启动但很常用）")])]),s._v(" "),t("li",[s._v("OracleServiceORCL：数据库服务(数据库实例)，是Oracle核心服务，该服务是数据库启动的基础， 只有该服务启动，Oracle数据库才能正常启动。"),t("span",{staticStyle:{color:"red"}},[s._v("(必须启动)")])])])])]),s._v(" "),t("h3",{attrs:{id:"数据插入慢的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据插入慢的问题"}},[s._v("#")]),s._v(" 数据插入慢的问题")]),s._v(" "),t("p",[t("strong",[s._v("新增：晚上跑存储过程稍快（好几个表两千多万条数据4688s），为什么？因为磁盘读写速度慢T.T")])]),s._v(" "),t("ol",[t("li",[s._v("有个九百多万数据的表需要重新抽数（抽数速度极其慢，后发现是索引导致的，不清楚是索引有问题还是正常现象（索引增加查询速率但影响insert、update、delete效率），"),t("span",{staticStyle:{color:"red","font-weight":"bold"}},[s._v("应该先删除索引再抽数")]),s._v("）\n"),t("blockquote",[t("p",[s._v("没删除索引前的效率： 【345430 条数据花费 1406s】【345430 条数据花费1301s】"),t("br"),s._v("\n删除后的效率：【345508条数据花费 64s】【345482 条数据花费 7.248s】【345508 条数据34.466s】【datax：1641410条数据465s】")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);