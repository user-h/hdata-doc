<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>达梦数据库 | 唐宋元明清</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/hdata-doc/img/favicon.ico">
    <meta name="description" content="">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/hdata-doc/assets/css/0.styles.ce16c74b.css" as="style"><link rel="preload" href="/hdata-doc/assets/js/app.37e4fbb6.js" as="script"><link rel="preload" href="/hdata-doc/assets/js/2.82afd9cb.js" as="script"><link rel="preload" href="/hdata-doc/assets/js/9.c7938acd.js" as="script"><link rel="prefetch" href="/hdata-doc/assets/js/10.7b061388.js"><link rel="prefetch" href="/hdata-doc/assets/js/11.3d84b622.js"><link rel="prefetch" href="/hdata-doc/assets/js/12.f524e450.js"><link rel="prefetch" href="/hdata-doc/assets/js/13.b3ff7d26.js"><link rel="prefetch" href="/hdata-doc/assets/js/14.3675e190.js"><link rel="prefetch" href="/hdata-doc/assets/js/15.676eac9f.js"><link rel="prefetch" href="/hdata-doc/assets/js/16.c546644f.js"><link rel="prefetch" href="/hdata-doc/assets/js/17.d80c3241.js"><link rel="prefetch" href="/hdata-doc/assets/js/18.bfa024db.js"><link rel="prefetch" href="/hdata-doc/assets/js/19.c4ebe893.js"><link rel="prefetch" href="/hdata-doc/assets/js/20.0c06c705.js"><link rel="prefetch" href="/hdata-doc/assets/js/21.e586d4fc.js"><link rel="prefetch" href="/hdata-doc/assets/js/22.d4747bce.js"><link rel="prefetch" href="/hdata-doc/assets/js/23.cfa91ca4.js"><link rel="prefetch" href="/hdata-doc/assets/js/24.77c960d1.js"><link rel="prefetch" href="/hdata-doc/assets/js/25.cc923a02.js"><link rel="prefetch" href="/hdata-doc/assets/js/26.432e9cf4.js"><link rel="prefetch" href="/hdata-doc/assets/js/27.3248ab2a.js"><link rel="prefetch" href="/hdata-doc/assets/js/28.67efb541.js"><link rel="prefetch" href="/hdata-doc/assets/js/29.e500a45f.js"><link rel="prefetch" href="/hdata-doc/assets/js/3.5c0f818a.js"><link rel="prefetch" href="/hdata-doc/assets/js/30.27916467.js"><link rel="prefetch" href="/hdata-doc/assets/js/31.db03022b.js"><link rel="prefetch" href="/hdata-doc/assets/js/32.40451343.js"><link rel="prefetch" href="/hdata-doc/assets/js/33.57a8afa5.js"><link rel="prefetch" href="/hdata-doc/assets/js/34.e8da6dc5.js"><link rel="prefetch" href="/hdata-doc/assets/js/35.25dea1e4.js"><link rel="prefetch" href="/hdata-doc/assets/js/36.ecc28683.js"><link rel="prefetch" href="/hdata-doc/assets/js/37.976e826a.js"><link rel="prefetch" href="/hdata-doc/assets/js/38.f1f7e891.js"><link rel="prefetch" href="/hdata-doc/assets/js/39.6daaca2d.js"><link rel="prefetch" href="/hdata-doc/assets/js/4.528973e8.js"><link rel="prefetch" href="/hdata-doc/assets/js/40.3766a207.js"><link rel="prefetch" href="/hdata-doc/assets/js/41.515be286.js"><link rel="prefetch" href="/hdata-doc/assets/js/42.87e45d55.js"><link rel="prefetch" href="/hdata-doc/assets/js/43.0eea2c15.js"><link rel="prefetch" href="/hdata-doc/assets/js/44.f5a1989e.js"><link rel="prefetch" href="/hdata-doc/assets/js/45.96eaa743.js"><link rel="prefetch" href="/hdata-doc/assets/js/46.6db88dae.js"><link rel="prefetch" href="/hdata-doc/assets/js/47.f3e98870.js"><link rel="prefetch" href="/hdata-doc/assets/js/48.138b9428.js"><link rel="prefetch" href="/hdata-doc/assets/js/49.b4e2bdb7.js"><link rel="prefetch" href="/hdata-doc/assets/js/5.53dd3ef1.js"><link rel="prefetch" href="/hdata-doc/assets/js/50.6624a71f.js"><link rel="prefetch" href="/hdata-doc/assets/js/51.4273468b.js"><link rel="prefetch" href="/hdata-doc/assets/js/52.d69c448e.js"><link rel="prefetch" href="/hdata-doc/assets/js/53.3e61789b.js"><link rel="prefetch" href="/hdata-doc/assets/js/54.ed81b599.js"><link rel="prefetch" href="/hdata-doc/assets/js/55.a2edf6d0.js"><link rel="prefetch" href="/hdata-doc/assets/js/56.324986ae.js"><link rel="prefetch" href="/hdata-doc/assets/js/57.640caf90.js"><link rel="prefetch" href="/hdata-doc/assets/js/58.344d4730.js"><link rel="prefetch" href="/hdata-doc/assets/js/59.d9078674.js"><link rel="prefetch" href="/hdata-doc/assets/js/6.22885e2c.js"><link rel="prefetch" href="/hdata-doc/assets/js/60.2afcb1b9.js"><link rel="prefetch" href="/hdata-doc/assets/js/61.996c28ca.js"><link rel="prefetch" href="/hdata-doc/assets/js/62.cb5e8bee.js"><link rel="prefetch" href="/hdata-doc/assets/js/63.146ed62c.js"><link rel="prefetch" href="/hdata-doc/assets/js/64.8bb9c50a.js"><link rel="prefetch" href="/hdata-doc/assets/js/65.460effd7.js"><link rel="prefetch" href="/hdata-doc/assets/js/66.f5294e94.js"><link rel="prefetch" href="/hdata-doc/assets/js/67.0da1dddd.js"><link rel="prefetch" href="/hdata-doc/assets/js/68.64117a5a.js"><link rel="prefetch" href="/hdata-doc/assets/js/69.ed33359f.js"><link rel="prefetch" href="/hdata-doc/assets/js/7.814d9e01.js"><link rel="prefetch" href="/hdata-doc/assets/js/70.1250ab19.js"><link rel="prefetch" href="/hdata-doc/assets/js/71.f6a79a2a.js"><link rel="prefetch" href="/hdata-doc/assets/js/72.683057b4.js"><link rel="prefetch" href="/hdata-doc/assets/js/73.94e5450b.js"><link rel="prefetch" href="/hdata-doc/assets/js/74.fa587d94.js"><link rel="prefetch" href="/hdata-doc/assets/js/75.48871ae9.js"><link rel="prefetch" href="/hdata-doc/assets/js/76.447894b5.js"><link rel="prefetch" href="/hdata-doc/assets/js/77.da5dadf2.js"><link rel="prefetch" href="/hdata-doc/assets/js/78.a8553a08.js"><link rel="prefetch" href="/hdata-doc/assets/js/79.bd712952.js"><link rel="prefetch" href="/hdata-doc/assets/js/8.a242d330.js">
    <link rel="stylesheet" href="/hdata-doc/assets/css/0.styles.ce16c74b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hdata-doc/" class="home-link router-link-active"><img src="https://i.postimg.cc/2yr3430s/panda.jpg" alt="唐宋元明清" class="logo"> <span class="site-name can-hide">唐宋元明清</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hdata-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/hdata-doc/pages/de9b5e/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/768c32/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/1d1863/" class="nav-link">hutool</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/1d1864/" class="nav-link">commons</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/1e9420/" class="nav-link">Spring Boot相关</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/bdceb5/" class="nav-link">设计模式入门</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Hadoop</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/5d76a5/" class="nav-link">Hadoop分布式搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f9f70f/" class="nav-link">Hadoop高可用搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/3e77b2/" class="nav-link">集群端口</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/03a2bd/" class="nav-link">代码demo</a></li></ul></li><li class="dropdown-item"><h4>Zookeeper</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e2226d/" class="nav-link">Zookeeper集群搭建</a></li></ul></li><li class="dropdown-item"><h4>Hive</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/edf4cb/" class="nav-link">Hive集群搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/dd806a/" class="nav-link">Hive相关</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/dd807a/" class="nav-link">HSQL</a></li></ul></li><li class="dropdown-item"><h4>Kafka</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/bfa383/" class="nav-link">Kafka集群搭建</a></li></ul></li><li class="dropdown-item"><h4>HBase</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/b22228/" class="nav-link">HBase集群搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/e15afa/" class="nav-link">HBase基础学习</a></li></ul></li><li class="dropdown-item"><h4>Spark</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/7d157d/" class="nav-link">Spark环境搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/b3ba00/" class="nav-link">Spark相关知识</a></li></ul></li><li class="dropdown-item"><h4>Flink</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/415096/" class="nav-link">Flink环境搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/415097/" class="nav-link">Flink学习</a></li></ul></li><li class="dropdown-item"><h4>Flume</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e4166e/" class="nav-link">Flume安装配置</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/0376ec/" class="nav-link">Flume高可用集群安装</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/3408a8/" class="nav-link">Flume相关学习</a></li></ul></li><li class="dropdown-item"><h4>Sqoop</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/60b3d7/" class="nav-link">Sqoop安装配置</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/40f7a3/" class="nav-link">Sqoop使用</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/d89b45/" class="nav-link">docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/hdata-doc/pages/e0cc49/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/7e6951/" class="nav-link">Oracle相关知识杂记</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/b5c27a/" class="nav-link">系统函数篇</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/c2df29/" class="nav-link">与MySQL语法区别</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/36476d/" class="nav-link">MySQL知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a330/" class="nav-link">Python简单语法</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a340/" class="nav-link">Python操作Office</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a341/" class="nav-link">Python类库学习</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f799c7/" class="nav-link">Python爬虫</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/5704cc/" class="nav-link">Shell基础</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/5765cc/" class="nav-link">Shell命令行</a></li></ul></li><li class="dropdown-item"><h4>Scala</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/c917bd/" class="nav-link">语法学习</a></li></ul></li><li class="dropdown-item"><h4>正则表达式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e4e158/" class="nav-link">正则基础</a></li></ul></li><li class="dropdown-item"><h4>调度</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/a04438/" class="nav-link">调度工具</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/gxfmrs/" class="nav-link">前端相关</a></li></ul></li><li class="dropdown-item"><h4>杂记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/414e9c/" class="nav-link">常用工具或网站</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/c0e729/" class="nav-link">琐碎知识</a></li></ul></li><li class="dropdown-item"><h4>摘录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/AXI4oJ/" class="nav-link">摘录</a></li></ul></li></ul></div></div> <a href="https://github.com/user-h/hdata-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/hdata-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/hdata-doc/pages/de9b5e/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/768c32/" class="nav-link">Java基础</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/1d1863/" class="nav-link">hutool</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/1d1864/" class="nav-link">commons</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/1e9420/" class="nav-link">Spring Boot相关</a></li></ul></li><li class="dropdown-item"><h4>设计模式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/bdceb5/" class="nav-link">设计模式入门</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><!----> <span class="title" style="display:;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Hadoop</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/5d76a5/" class="nav-link">Hadoop分布式搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f9f70f/" class="nav-link">Hadoop高可用搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/3e77b2/" class="nav-link">集群端口</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/03a2bd/" class="nav-link">代码demo</a></li></ul></li><li class="dropdown-item"><h4>Zookeeper</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e2226d/" class="nav-link">Zookeeper集群搭建</a></li></ul></li><li class="dropdown-item"><h4>Hive</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/edf4cb/" class="nav-link">Hive集群搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/dd806a/" class="nav-link">Hive相关</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/dd807a/" class="nav-link">HSQL</a></li></ul></li><li class="dropdown-item"><h4>Kafka</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/bfa383/" class="nav-link">Kafka集群搭建</a></li></ul></li><li class="dropdown-item"><h4>HBase</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/b22228/" class="nav-link">HBase集群搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/e15afa/" class="nav-link">HBase基础学习</a></li></ul></li><li class="dropdown-item"><h4>Spark</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/7d157d/" class="nav-link">Spark环境搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/b3ba00/" class="nav-link">Spark相关知识</a></li></ul></li><li class="dropdown-item"><h4>Flink</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/415096/" class="nav-link">Flink环境搭建</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/415097/" class="nav-link">Flink学习</a></li></ul></li><li class="dropdown-item"><h4>Flume</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e4166e/" class="nav-link">Flume安装配置</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/0376ec/" class="nav-link">Flume高可用集群安装</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/3408a8/" class="nav-link">Flume相关学习</a></li></ul></li><li class="dropdown-item"><h4>Sqoop</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/60b3d7/" class="nav-link">Sqoop安装配置</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/40f7a3/" class="nav-link">Sqoop使用</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/d89b45/" class="nav-link">docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/hdata-doc/pages/e0cc49/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Oracle</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/7e6951/" class="nav-link">Oracle相关知识杂记</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/b5c27a/" class="nav-link">系统函数篇</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/c2df29/" class="nav-link">与MySQL语法区别</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/36476d/" class="nav-link">MySQL知识点</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a330/" class="nav-link">Python简单语法</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a340/" class="nav-link">Python操作Office</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f2a341/" class="nav-link">Python类库学习</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/f799c7/" class="nav-link">Python爬虫</a></li></ul></li><li class="dropdown-item"><h4>Shell</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/5704cc/" class="nav-link">Shell基础</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/5765cc/" class="nav-link">Shell命令行</a></li></ul></li><li class="dropdown-item"><h4>Scala</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/c917bd/" class="nav-link">语法学习</a></li></ul></li><li class="dropdown-item"><h4>正则表达式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/e4e158/" class="nav-link">正则基础</a></li></ul></li><li class="dropdown-item"><h4>调度</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/a04438/" class="nav-link">调度工具</a></li></ul></li><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/gxfmrs/" class="nav-link">前端相关</a></li></ul></li><li class="dropdown-item"><h4>杂记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/414e9c/" class="nav-link">常用工具或网站</a></li><li class="dropdown-subitem"><a href="/hdata-doc/pages/c0e729/" class="nav-link">琐碎知识</a></li></ul></li><li class="dropdown-item"><h4>摘录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/hdata-doc/pages/AXI4oJ/" class="nav-link">摘录</a></li></ul></li></ul></div></div> <a href="https://github.com/user-h/hdata-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Oracle</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hdata-doc/pages/7e6951/" class="sidebar-link">Oracle相关知识杂记</a></li><li><a href="/hdata-doc/pages/b5c27a/" class="sidebar-link">系统函数篇</a></li><li><a href="/hdata-doc/pages/c2df29/" class="sidebar-link">与MySQL语法区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hdata-doc/pages/36476d/" class="sidebar-link">MySQL琐碎知识点</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>国产数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hdata-doc/pages/086761/" aria-current="page" class="active sidebar-link">达梦数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#零、官方文档" class="sidebar-link">零、官方文档</a></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#一、数据库安装" class="sidebar-link">一、数据库安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#前期准备" class="sidebar-link">前期准备</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#注册数据库服务-启动数据库" class="sidebar-link">注册数据库服务，启动数据库</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#二、创建oracle-to-达梦的dblink-oci方式" class="sidebar-link">二、创建Oracle To 达梦的DBlink（OCI方式）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#环境准备" class="sidebar-link">环境准备</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#工具准备" class="sidebar-link">工具准备</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#oracle-oci安装配置-达梦数据库所在服务器" class="sidebar-link">Oracle OCI安装配置（达梦数据库所在服务器）</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#数据库调优方面" class="sidebar-link">数据库调优方面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#数据库统计信息" class="sidebar-link">数据库统计信息</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#自动收集" class="sidebar-link">自动收集</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#手动收集" class="sidebar-link">手动收集</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#et-工具" class="sidebar-link">ET 工具</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#dbms-sqltune-工具" class="sidebar-link">dbms_sqltune 工具</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#hints" class="sidebar-link">Hints</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#ini-参数提示" class="sidebar-link">INI 参数提示</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#索引提示" class="sidebar-link">索引提示</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#连接方法提示" class="sidebar-link">连接方法提示</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#连接顺序提示" class="sidebar-link">连接顺序提示</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#统计信息提示" class="sidebar-link">统计信息提示</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#其他-hint" class="sidebar-link">其他 Hint</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#dts-迁移" class="sidebar-link">DTS 迁移</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#注意事项" class="sidebar-link">注意事项</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#常用sql" class="sidebar-link">常用SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#博客" class="sidebar-link">博客</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#新建用户及表空间" class="sidebar-link">新建用户及表空间</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#元数据获取" class="sidebar-link">元数据获取</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#常用系统视图" class="sidebar-link">常用系统视图</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#建表语句获取" class="sidebar-link">建表语句获取</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查询表空间占用率" class="sidebar-link">查询表空间占用率</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查看单表-索引-占用空间" class="sidebar-link">查看单表（索引）占用空间</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查看达梦数据库是否是集群" class="sidebar-link">查看达梦数据库是否是集群</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查看模式和用户对应关系" class="sidebar-link">查看模式和用户对应关系</a></li><li class="sidebar-sub-header level3"><a href="/hdata-doc/pages/086761/#问题排查" class="sidebar-link">问题排查</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查询锁表-杀会话" class="sidebar-link">查询锁表 &amp; 杀会话</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查询实例中已执行未提交的-sql" class="sidebar-link">查询实例中已执行未提交的 SQL</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#查询表上的锁" class="sidebar-link">查询表上的锁</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#批量禁用某个用户-模式下所有外键约束" class="sidebar-link">批量禁用某个用户/模式下所有外键约束</a></li><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#用户锁定-解锁" class="sidebar-link">用户锁定/解锁</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/hdata-doc/pages/086761/#faq" class="sidebar-link">FAQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level4"><a href="/hdata-doc/pages/086761/#大数据量表加字段慢" class="sidebar-link">大数据量表加字段慢</a></li></ul></li></ul></li><li><a href="/hdata-doc/pages/e461e3/" class="sidebar-link">华为高斯数据库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hdata-doc/pages/ca5c12/" class="sidebar-link">Redis命令学习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Excel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hdata-doc/pages/265b1a/" class="sidebar-link">Excel技巧</a></li></ul></section></li><li><a href="/hdata-doc/pages/e0cc49/" class="sidebar-link">数据库</a></li><li><a href="/hdata-doc/pages/e02b49/" class="sidebar-link">SQL非常规用法</a></li><li><a href="/hdata-doc/pages/d5b8e9/" class="sidebar-link">SQL练习题</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/hdata-doc/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>数据库</span></li><li data-v-06225672><span data-v-06225672>国产数据库</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/user-h" target="_blank" title="作者" class="beLink" data-v-06225672>Ai</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-07-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">达梦数据库<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="零、官方文档"><a href="#零、官方文档" class="header-anchor">#</a> 零、官方文档</h2> <p><a href="https://eco.dameng.com/document/dm/zh-cn/pm/" target="_blank" rel="noopener noreferrer">产品手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>达梦数据库需善用达梦提供的工具</strong></p> <ul><li>DM控制台工具：查看 dm.ini 配置（中文描述配置信息）、备份还原 <a href="https://eco.dameng.com/document/dm/zh-cn/pm/physical-storage#2.1.1.1%20dm.ini" target="_blank" rel="noopener noreferrer">官网在线文档：DM数据库服务配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>DM审计分析工具</li> <li>DM数据迁移工具：用于达梦与其他数据库间的数据迁移（包含视图、存储过程、函数、触发器等）</li> <li>DM性能监视工具：性能监控（线程、会话、SQL、资源的监控）、调优向导（内存配置、线程配置、索引优化）</li> <li>SQL交互式查询工具</li></ul> <p><img src="/hdata-doc/assets/img/dm_monitor.7f3c949c.png" alt="DM性能监视工具"></p> <h2 id="一、数据库安装"><a href="#一、数据库安装" class="header-anchor">#</a> 一、数据库安装</h2> <h4 id="前期准备"><a href="#前期准备" class="header-anchor">#</a> 前期准备</h4> <ol><li>创建dmdba用户,dinstall组<div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost oracle<span class="token punctuation">]</span><span class="token comment"># groupadd dinstall &amp;&amp; useradd -g dinstall dmdba &amp;&amp; echo root|passwd --stdin dmdba</span>
Changing password <span class="token keyword">for</span> user dmdba.
passwd: all authentication tokens updated successfully.
</code></pre></div></li> <li>关闭防火墙和selinux</li> <li>创建软件安装目录 <code>/opt/dmdbms &amp;&amp; chown dmdba:dinstall /opt/dmdbms</code></li> <li>创建数据目录<code>/opt/dmdata &amp;&amp; chown dmdba:dinstall /opt/dmdata</code></li> <li>修改用户资源限制<br>
vi /etc/security/limits.conf 增加相应配置<div class="language-shell extra-class"><pre class="language-shell"><code>dmdba hard nofile <span class="token number">131072</span>
dmdba soft nofile <span class="token number">131072</span>
dmdba soft <span class="token function">nice</span> <span class="token number">0</span>
dmdba hard <span class="token function">nice</span> <span class="token number">0</span>
dmdba soft as unlimited
dmdba hard as unlimited
dmdba soft fsize unlimited
dmdba hard fsize unlimited
dmdba soft nproc <span class="token number">131072</span>
dmdba hard nproc <span class="token number">131072</span>
dmdba soft data unlimited
dmdba hard data unlimited
dmdba soft core unlimited
dmdba hard core unlimited
dmdba soft memlock unlimited
dmdba hard memlock unlimited
</code></pre></div></li> <li>上传安装包，解压 <code>unzip dm8_20220525_x86_rh6_64.zip</code></li> <li>iso挂载到/mnt <code>mount -o loop dm8_20220525_x86_rh6_64.iso /mnt/</code></li> <li>取消挂载 <code>umount /mnt/</code> （全部安装完成后执行）</li></ol> <h4 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h4> <ol><li><p>切换用户 dmdba 进行安装</p></li> <li><p>执行安装脚本 <code>/mnt/DMInstall.bin -i</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>dmdba@localhost ~<span class="token punctuation">]</span>$ /mnt/DMInstall.bin -i
Please <span class="token keyword">select</span> the installer's language <span class="token punctuation">(</span>E/e:English C/c:Chinese<span class="token punctuation">)</span> <span class="token punctuation">[</span>E/e<span class="token punctuation">]</span>:c
解压安装程序<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>. 
欢迎使用达梦数据库安装程序

是否输入Key文件路径? <span class="token punctuation">(</span>Y/y:是 N/n:否<span class="token punctuation">)</span> <span class="token punctuation">[</span>Y/y<span class="token punctuation">]</span>:n

是否设置时区? <span class="token punctuation">(</span>Y/y:是 N/n:否<span class="token punctuation">)</span> <span class="token punctuation">[</span>Y/y<span class="token punctuation">]</span>:y
设置时区:
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span>: GTM-12<span class="token operator">=</span>日界线西
<span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span>: GTM-11<span class="token operator">=</span>萨摩亚群岛
<span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span>: GTM-10<span class="token operator">=</span>夏威夷
<span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span>: GTM-09<span class="token operator">=</span>阿拉斯加
<span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span>: GTM-08<span class="token operator">=</span>太平洋时间（美国和加拿大）
<span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span>: GTM-07<span class="token operator">=</span>亚利桑那
<span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span>: GTM-06<span class="token operator">=</span>中部时间（美国和加拿大）
<span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span>: GTM-05<span class="token operator">=</span>东部部时间（美国和加拿大）
<span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span>: GTM-04<span class="token operator">=</span>大西洋时间（美国和加拿大）
<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>: GTM-03<span class="token operator">=</span>巴西利亚
<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span>: GTM-02<span class="token operator">=</span>中大西洋
<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>: GTM-01<span class="token operator">=</span>亚速尔群岛
<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span>: <span class="token assign-left variable">GTM</span><span class="token operator">=</span>格林威治标准时间
<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span>: GTM+01<span class="token operator">=</span>萨拉热窝
<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span>: GTM+02<span class="token operator">=</span>开罗
<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span>: GTM+03<span class="token operator">=</span>莫斯科
<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span>: GTM+04<span class="token operator">=</span>阿布扎比
<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span>: GTM+05<span class="token operator">=</span>伊斯兰堡
<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span>: GTM+06<span class="token operator">=</span>达卡
<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span>: GTM+07<span class="token operator">=</span>曼谷，河内
<span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span>: GTM+08<span class="token operator">=</span>中国标准时间
<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span>: GTM+09<span class="token operator">=</span>汉城
<span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span>: GTM+10<span class="token operator">=</span>关岛
<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span>: GTM+11<span class="token operator">=</span>所罗门群岛
<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span>: GTM+12<span class="token operator">=</span>斐济
<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span>: GTM+13<span class="token operator">=</span>努库阿勒法
<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span>: GTM+14<span class="token operator">=</span>基里巴斯
请选择设置时区 <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>:21

安装类型:
<span class="token number">1</span> 典型安装
<span class="token number">2</span> 服务器
<span class="token number">3</span> 客户端
<span class="token number">4</span> 自定义
请选择安装类型的数字序号 <span class="token punctuation">[</span><span class="token number">1</span> 典型安装<span class="token punctuation">]</span>:1
所需空间: 1585M

请选择安装目录 <span class="token punctuation">[</span>/home/dmdba/dmdbms<span class="token punctuation">]</span>:/opt/dmdbms
目录<span class="token punctuation">(</span>/opt/dmdbms<span class="token punctuation">)</span>下不为空，请选择其他目录。
请选择安装目录 <span class="token punctuation">[</span>/home/dmdba/dmdbms<span class="token punctuation">]</span>:/opt/dmdbms
可用空间: 13G
是否确认安装路径<span class="token punctuation">(</span>/opt/dmdbms<span class="token punctuation">)</span>? <span class="token punctuation">(</span>Y/y:是 N/n:否<span class="token punctuation">)</span>  <span class="token punctuation">[</span>Y/y<span class="token punctuation">]</span>:y

安装前小结
安装位置: /opt/dmdbms
所需空间: 1585M
可用空间: 13G
版本信息: 
有效日期: 
安装类型: 典型安装
是否确认安装? <span class="token punctuation">(</span>Y/y:是 N/n:否<span class="token punctuation">)</span>:y
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:36 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装达梦数据库<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:37 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 基础 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:40 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 服务器 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:40 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 客户端 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:42 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 驱动 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:43 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 手册 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:43 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装 服务 模块<span class="token punctuation">..</span>.
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:44 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 移动日志文件。
<span class="token number">2022</span>-07-18 <span class="token number">19</span>:00:44 
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> 安装达梦数据库完成。

请以root系统用户执行命令:
/opt/dmdbms/script/root/root_installer.sh

安装结束
</code></pre></div></li> <li><p>root执行脚本 <code>/opt/dmdbms/script/root/root_installer.sh</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost opt<span class="token punctuation">]</span><span class="token comment"># /opt/dmdbms/script/root/root_installer.sh</span>
移动 /opt/dmdbms/bin/dm_svc.conf 到/etc目录
修改服务器权限
创建DmAPService服务
Created symlink from /etc/systemd/system/multi-user.target.wants/DmAPService.service to /usr/lib/systemd/system/DmAPService.service.
创建服务<span class="token punctuation">(</span>DmAPService<span class="token punctuation">)</span>完成
启动DmAPService服务
<span class="token punctuation">[</span>root@localhost opt<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div></li></ol> <h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <ol><li>执行初始化脚本 <code>./dminit path=/opt/dmdata db_name=aihb instance_name=aihb</code><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>dmdba@localhost bin<span class="token punctuation">]</span>$ <span class="token builtin class-name">pwd</span>
/opt/dmdbms/bin
<span class="token punctuation">[</span>dmdba@localhost bin<span class="token punctuation">]</span>$ ./dminit <span class="token assign-left variable">path</span><span class="token operator">=</span>/opt/dmdata <span class="token assign-left variable">db_name</span><span class="token operator">=</span>aihb <span class="token assign-left variable">instance_name</span><span class="token operator">=</span>aihb
initdb V8
db version: 0x7000c
<span class="token function">file</span> dm.key not found, use default license<span class="token operator">!</span>
License will expire on <span class="token number">2023</span>-05-25
Normal of FAST
Normal of DEFAULT
Normal of RECYCLE
Normal of KEEP
Normal of ROLL

 log <span class="token function">file</span> path: /opt/dmdata/aihb/aihb01.log


 log <span class="token function">file</span> path: /opt/dmdata/aihb/aihb02.log

<span class="token function">write</span> to <span class="token function">dir</span> <span class="token punctuation">[</span>/opt/dmdata/aihb<span class="token punctuation">]</span>.
create dm database success. <span class="token number">2022</span>-07-19 <span class="token number">10</span>:05:20
<span class="token punctuation">[</span>dmdba@localhost bin<span class="token punctuation">]</span>$ 
</code></pre></div></li></ol> <h4 id="注册数据库服务-启动数据库"><a href="#注册数据库服务-启动数据库" class="header-anchor">#</a> 注册数据库服务，启动数据库</h4> <ol><li><p>调用达梦提供的脚本生成数据库服务,自动启动数据库,脚本在安装目录的/script/root子目录下,调用注册脚本需<strong>使用root用户</strong> <code>./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini -p aihb</code></p> <ul><li>调用dm_service_installer.sh脚本来生成服务</li> <li>-t 指定需要创建的服务类型,这里是数据库服务所以是dmserver</li> <li>-dm_ini 指定在上一步初始化后生成的dm.ini文件</li> <li>-p 为生成服务的后缀名,可自定义，这里给的czw，所以创建的服务名为DmServiceczw</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost root<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/opt/dmdbms/script/root
<span class="token punctuation">[</span>root@localhost root<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">48</span>
-rwxr-xr-x. <span class="token number">1</span> dmdba dinstall <span class="token number">29111</span> Jul <span class="token number">19</span> <span class="token number">10</span>:00 dm_service_installer.sh
-rwxr-xr-x. <span class="token number">1</span> dmdba dinstall  <span class="token number">9618</span> Jul <span class="token number">19</span> <span class="token number">10</span>:00 dm_service_uninstaller.sh
-rwxr-xr-x. <span class="token number">1</span> dmdba dinstall   <span class="token number">635</span> Jul <span class="token number">19</span> <span class="token number">10</span>:00 root_installer.sh
<span class="token punctuation">[</span>root@localhost root<span class="token punctuation">]</span><span class="token comment"># ./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini</span>
请设置参数-p
<span class="token punctuation">[</span>root@localhost root<span class="token punctuation">]</span><span class="token comment"># ./dm_service_installer.sh -t dmserver -dm_ini /opt/dmdata/aihb/dm.ini -p aihb</span>
Created symlink from /etc/systemd/system/multi-user.target.wants/DmServiceaihb.service to /usr/lib/systemd/system/DmServiceaihb.service.
创建服务<span class="token punctuation">(</span>DmServiceaihb<span class="token punctuation">)</span>完成
<span class="token punctuation">[</span>root@localhost root<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div></li> <li><p>启动数据库
<code>systemctl start DmServiceaihb</code></p></li></ol> <h2 id="二、创建oracle-to-达梦的dblink-oci方式"><a href="#二、创建oracle-to-达梦的dblink-oci方式" class="header-anchor">#</a> 二、创建Oracle To 达梦的DBlink（OCI方式）</h2> <p><a href="https://blog.csdn.net/baidu_41727061/article/details/124823583" target="_blank" rel="noopener noreferrer">参考链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="环境准备"><a href="#环境准备" class="header-anchor">#</a> 环境准备</h4> <table><thead><tr><th>键</th> <th>值</th></tr></thead> <tbody><tr><td><strong>操作系统</strong></td> <td>Centos 7</td></tr> <tr><td><strong>Oracle数据库</strong></td> <td>11.2.0.4.0</td></tr> <tr><td>达梦数据库</td> <td>Centos 7 x86版本</td></tr> <tr><td>达梦安装目录</td> <td>/opt/dmdbms</td></tr> <tr><td>Oracle OCI位置</td> <td>/opt/oracle</td></tr></tbody></table> <h4 id="工具准备"><a href="#工具准备" class="header-anchor">#</a> 工具准备</h4> <p><strong>Oracle OCI：</strong> instantclient-basic-linux.x64-11.2.0.4.0.zip（与系统和Oracle版本对应）
<a href="https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="oracle-oci安装配置-达梦数据库所在服务器"><a href="#oracle-oci安装配置-达梦数据库所在服务器" class="header-anchor">#</a> Oracle OCI安装配置（达梦数据库所在服务器）</h4> <ol><li><p>进入包所在的路径并解压：</p> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /opt/oracle/ <span class="token operator">&amp;&amp;</span> <span class="token function">unzip</span> instantclient-basic-linux.x64-11.2.0.4.0.zip
</code></pre></div></li> <li><p>（18.3 之前的版本需要这一步）进入解压后目录创建软连接：</p> <div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> instantclient_11_2 <span class="token operator">&amp;&amp;</span> <span class="token function">ln</span> -sfv libclntsh.so.11.1 libclntsh.so
</code></pre></div></li> <li><p>配置环境变量</p> <ul><li>将OCI添加到/etc/ld.so.conf.d目录下（<strong>系统用户</strong>）<div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> /opt/oracle/instantclient_11_2 <span class="token operator">&gt;</span> /etc/ld.so.conf.d/oracle-instantclient.conf
</code></pre></div></li> <li>加载动态链接库（使上一步生效）：<code>ldconfig</code></li> <li>配置LD_LIBRARY_PATH环境变量（<strong>dmdba用户</strong>）<br>
修改dmdba用户下的.bash_profile文件（<code>vim ~/.bash_profile</code>），添加以下内容<div class="language-shell script extra-class"><pre class="language-shell"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$LD_LIBRARY_PATH</span>:/opt/oracle/instantclient_11_2&quot;</span>
</code></pre></div></li> <li>加载环境变量（使上一步生效）：<code>source ~/.bash_profile</code></li></ul></li> <li><p>启动（重启达梦数据库 <strong>系统用户</strong>）</p></li></ol> <div class="language-shell script extra-class"><pre class="language-shell"><code>systemctl restart DmServiceXXX <span class="token comment">#（**实际服务名**）</span>
</code></pre></div><ol start="5"><li>创建DBLink（注：用户名不要加引号）</li></ol> <div class="language-shell script extra-class"><pre class="language-shell"><code>create <span class="token function">link</span> LINKORA connect <span class="token string">'ORACLE'</span> with username identified by <span class="token string">&quot;password&quot;</span> using <span class="token string">'x.x.x.x:1521/orcl'</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="数据库调优方面"><a href="#数据库调优方面" class="header-anchor">#</a> 数据库调优方面</h2> <p><a href="https://eco.dameng.com/document/dm/zh-cn/ops/performance-optimization.html" target="_blank" rel="noopener noreferrer">性能诊断与优化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="数据库统计信息"><a href="#数据库统计信息" class="header-anchor">#</a> 数据库统计信息</h3> <h4 id="自动收集"><a href="#自动收集" class="header-anchor">#</a> 自动收集</h4> <p>DM 数据库支持统计信息的自动收集，当全表数据量变化超过设定阈值后可自动更新统计信息。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--打开表数据量监控开关，参数值为 1 时监控所有表，2 时仅监控配置表</span>
SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'AUTO_STAT_OBJ'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 如果 AUTO_STAT_OBJ=2，需进一步使用 DBMS_STATS.SET_TABLE_PREFS 设置 STALE_PERCENT 属性</span>
<span class="token comment">--设置 SYSDBA.T 表数据变化率超过 15% 时触发自动更新统计信息</span>
DBMS_STATS<span class="token punctuation">.</span>SET_TABLE_PREFS<span class="token punctuation">(</span><span class="token string">'SYSDBA'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'STALE_PERCENT'</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--配置自动收集统计信息触发时机</span>
<span class="token comment">-- 停止时最后一个参数配置为0？   参数值需再斟酌！！！！</span>
SP_CREATE_AUTO_STAT_TRIGGER<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'1:00'</span><span class="token punctuation">,</span> <span class="token string">'2025/3/12'</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
函数各参数介绍
SP_CREATE_AUTO_STAT_TRIGGER(
    TYPE                    INT,    --间隔类型，默认为天
    FREQ_INTERVAL         INT,    --间隔频率，默认 1
    FREQ_SUB_INTERVAL    INT,    --间隔频率，与 FREQ_INTERVAL 配合使用
    FREQ_MINUTE_INTERVAL INT,    --间隔分钟，默认为 1440
    STARTTIME              VARCHAR(128), --开始时间，默认为 22:00
    DURING_START_DATE    VARCHAR(128), --重复执行的起始时间，默认 1900/1/1
    MAX_RUN_DURATION    INT,    --允许的最长执行时间(秒)，默认不限制
    ENABLE                  INT     --0 关闭，1 启用  --默认为 1
);
*/</span>
</code></pre></div><p><strong>测试</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> T<span class="token punctuation">(</span>A <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">select</span> <span class="token keyword">level</span> <span class="token keyword">connect</span> <span class="token keyword">by</span> <span class="token keyword">level</span><span class="token operator">&lt;=</span><span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token comment">-- SELECT * FROM SYSSTATTABLEIDU order by LAST_STAT_DT desc;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
  <span class="token keyword">FROM</span> sysstats
 <span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> object_id
                <span class="token keyword">FROM</span> dba_objects
               <span class="token keyword">WHERE</span> object_type <span class="token operator">=</span> <span class="token string">'TABLE'</span>
                 <span class="token operator">AND</span> owner <span class="token operator">=</span> <span class="token string">'OWNER'</span>
                 <span class="token operator">AND</span> object_name <span class="token operator">=</span> <span class="token string">'T'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>监控统计信息收集过程</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 创建一个用户表 AUTO_STAT_INFO，用以保存自动收集过程的相关信息</span>
<span class="token comment">-- 最好是系统用户吧？？？SYSDBA？？？</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> AUTO_STAT_INFO
<span class="token punctuation">(</span>
   task_id               <span class="token keyword">INT</span><span class="token punctuation">,</span>
   total_stat            <span class="token keyword">INT</span><span class="token punctuation">,</span>
   table_id              <span class="token keyword">INT</span><span class="token punctuation">,</span>
   sch_name              <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   table_name            <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   curr_gath_tab_id      <span class="token keyword">INT</span><span class="token punctuation">,</span>
   curr_gath_sch_name    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   curr_gath_tab_name    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   success_stat          <span class="token keyword">INT</span><span class="token punctuation">,</span>
   fail_stat             <span class="token keyword">INT</span><span class="token punctuation">,</span>
   task_start_time       <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
   task_end_time         <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
   gather_tbl_start_time <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
   gather_tbl_end_time   <span class="token keyword">DATETIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">-- 创建过程 SYSDBA.GET_AUTO_STAT_INFO_FUNC，接收服务器在自动收集统计信息时的过程信息。并在模块体编写用户代码，将过程收集的统计信息写入 AUTO_STAT_INFO 中。</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span>  SYSDBA<span class="token punctuation">.</span>GET_AUTO_STAT_INFO_FUNC<span class="token punctuation">(</span>task_id <span class="token keyword">INT</span><span class="token punctuation">,</span>total_stat <span class="token keyword">INT</span><span class="token punctuation">,</span>table_id <span class="token keyword">INT</span><span class="token punctuation">,</span> sch_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> table_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>curr_gath_tab_id <span class="token keyword">INT</span><span class="token punctuation">,</span> curr_gath_sch_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> curr_gath_tab_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>success_stat <span class="token keyword">INT</span><span class="token punctuation">,</span>fail_stat <span class="token keyword">INT</span><span class="token punctuation">,</span>task_start_time <span class="token keyword">DATETIME</span><span class="token punctuation">,</span> task_end_time <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>gather_tbl_start_time <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>gather_tbl_end_time <span class="token keyword">DATETIME</span><span class="token punctuation">)</span> <span class="token keyword">as</span>
<span class="token keyword">BEGIN</span>
<span class="token comment">//下面是用户自定义的代码，将SYSDBA.GET_AUTO_STAT_INFO_FUNC过程的信息插入到用户表AUTO_STAT_INFO 中</span>
    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> AUTO_STAT_INFO <span class="token keyword">VALUES</span><span class="token punctuation">(</span>task_id<span class="token punctuation">,</span>total_stat<span class="token punctuation">,</span>table_id<span class="token punctuation">,</span> sch_name<span class="token punctuation">,</span>table_name<span class="token punctuation">,</span>curr_gath_tab_id<span class="token punctuation">,</span> curr_gath_sch_name<span class="token punctuation">,</span> curr_gath_tab_name<span class="token punctuation">,</span>success_stat <span class="token punctuation">,</span>fail_stat<span class="token punctuation">,</span>task_start_time<span class="token punctuation">,</span>task_end_time<span class="token punctuation">,</span>gather_tbl_start_time<span class="token punctuation">,</span>gather_tbl_end_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
EXCEPTION
    <span class="token keyword">WHEN</span> OTHERS <span class="token keyword">THEN</span>
        <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token comment">-- 最后，解读表 AUTO_STAT_INFO，介绍一次自动收集统计信息任务的相关过程信息。如果 SP_CREATE_AUTO_STAT_TRIGGER 触发一次自动收集统计信息，在任务开始时，会先记录当前任务的开始时间，当前任务的待收集表的总个数，以及接下来待收集的表的 id。之后每收集完成一个表的统计信息，就会记录该表 table 的 id 及收集该表的开始和结束时间，和截至目前收集成功失败的表个数情况，以及接下来待收集的表的 id。其中“接下来待收集的表的 id”即 current_gather_tab_id，为当前服务器正在收集的表 id。</span>
</code></pre></div><h4 id="手动收集"><a href="#手动收集" class="header-anchor">#</a> 手动收集</h4> <p><strong>查看是否已有统计信息</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 检查表上是否有统计信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysstats
<span class="token keyword">where</span> id <span class="token operator">IN</span>
<span class="token punctuation">(</span>
  <span class="token keyword">select</span> object_id <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span>
  object_type<span class="token operator">=</span><span class="token string">'TABLE'</span>
  <span class="token operator">and</span> owner <span class="token operator">=</span> <span class="token string">'模式名'</span>
  <span class="token operator">and</span> object_name<span class="token operator">=</span><span class="token string">'表名'</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>


<span class="token comment">-- 用于经过 GATHER_TABLE_STATS、GATHER_INDEX_STATS 或 GATHER_SCHEMA_STATS 收集之后展示。</span>
dbms_stats<span class="token punctuation">.</span>table_stats_show<span class="token punctuation">(</span><span class="token string">'模式名'</span><span class="token punctuation">,</span><span class="token string">'表名'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>收集统计信息</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">1</span>、收集全库统计信息
DBMS_STATS<span class="token punctuation">.</span>GATHER_SCHEMA_STATS<span class="token punctuation">(</span><span class="token string">'HNSIMIS'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span><span class="token string">'FOR ALL COLUMNS SIZE AUTO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--HNSIMIS是模式名</span>
<span class="token comment">-- 这种收集方式，并不是100%收集，所以有一定的弊端。</span>

<span class="token number">2</span>、收集表的统计信息
dbms_stats<span class="token punctuation">.</span>GATHER_TABLE_STATS<span class="token punctuation">(</span><span class="token string">'TEST'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">--收集表的统计信息，包括列和索引等 第一个参数是模式，第二个参数是表 Null是缺省，100是采样率100%，默认不是。</span>
DBMS_STATS<span class="token punctuation">.</span>GATHER_TABLE_STATS<span class="token punctuation">(</span><span class="token string">'OWNER'</span><span class="token punctuation">,</span><span class="token string">'TABLE_NAME'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span><span class="token string">'FOR ALL COLUMNS SIZE AUTO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token number">3</span>、收集列统计信息
stat <span class="token number">100</span> <span class="token keyword">on</span> fw<span class="token punctuation">(</span>CREATE_USERID<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--收集某一列的统计信息 fw是表名 CREATE_USERID是列名称</span>
<span class="token comment">-- 这个在做sql调优的时候比较常用，因为比较准。</span>

<span class="token number">4</span>、收集索引统计信息
sp_index_stat_init<span class="token punctuation">(</span><span class="token string">'DREAMWEB_PUDONG'</span><span class="token punctuation">,</span><span class="token string">'IX_FW_ROWSTATE'</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">--收集索引的统计信息 DREAMWEB_PUDONG是模式名称 IX_FW_ROWSTATE是索引名称</span>
<span class="token comment">-- 这个也比较常用，建议创建完索引，立刻收集下统计信息。</span>

<span class="token comment">-- 报错 磁盘空间不足 -523[-523]: anonymous block line 2</span>
<span class="token comment">-- SYSTEM表空间 不足</span>
</code></pre></div><p><strong>删除统计信息</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--表</span>
DBMS_STATS<span class="token punctuation">.</span>DELETE_TABLE_STATS<span class="token punctuation">(</span><span class="token string">'模式名'</span><span class="token punctuation">,</span><span class="token string">'表名'</span><span class="token punctuation">,</span><span class="token string">'分区名'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--模式</span>
DBMS_STATS<span class="token punctuation">.</span>DELETE_SCHMA_STATS<span class="token punctuation">(</span><span class="token string">'模式名'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--索引</span>
DBMS_STATS<span class="token punctuation">.</span>DELETE_INDEX_STATS<span class="token punctuation">(</span><span class="token string">'模式名'</span><span class="token punctuation">,</span><span class="token string">'索引名'</span><span class="token punctuation">,</span><span class="token string">'分区表名'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--字段</span>
DBMS_STATS<span class="token punctuation">.</span>DELETE_COLUMN_STATS<span class="token punctuation">(</span><span class="token string">'模式名'</span><span class="token punctuation">,</span><span class="token string">'表名'</span><span class="token punctuation">,</span><span class="token string">'列名'</span><span class="token punctuation">,</span><span class="token string">'分区表名'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="et-工具"><a href="#et-工具" class="header-anchor">#</a> ET 工具</h3> <p>ET 工具是 DM 数据库自带的 SQL 性能分析工具，能够统计 SQL 语句执行过程中每个操作符的实际开销，为 SQL 优化提供依据以及指导。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--查看ET是否开启</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$parameter t <span class="token keyword">where</span> NAME <span class="token operator">=</span> <span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$parameter t <span class="token keyword">where</span> NAME <span class="token operator">=</span> <span class="token string">'ENABLE_MONITOR'</span><span class="token punctuation">;</span>
<span class="token comment">--ENABLE_MONITOR，动态参数(系统级)</span>
<span class="token comment">--MONITOR_SQL_EXEC，动态参数(会话级)</span>

<span class="token comment">--开启ET</span>
SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'ENABLE_MONITOR'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--关闭ET</span>
SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'ENABLE_MONITOR'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="dbms-sqltune-工具"><a href="#dbms-sqltune-工具" class="header-anchor">#</a> dbms_sqltune 工具</h3> <p>DBMS_SQLTUNE 包提供一系列实时 SQL 监控的方法。当 SQL 监控功能开启后，DBMS_SQLTUNE 包可以实时监控 SQL 执行过程中的信息，包括：执行时间、执行代价、执行用户、统计信息等情况。<br>
dbms_sqltune 系统包相比 ET 功能更强大，能够获取 IO 操作量，查看真实执行计划，每个操作符消耗占比和相应的花费时间，还能看出每个操作符执行的次数，非常便于了解执行计划中瓶颈位置。<br>
dbms_sqltune 功能远不止定位执行计划瓶颈，还拥有调优助手功能（建议性提示建某索引和收集某统计信息），具体使用 <a href="https://eco.dameng.com/document/dm/zh-cn/pm/dbms_sqltume-package.html" target="_blank" rel="noopener noreferrer">DM8 系统包使用手册<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 1. 使用前提：建议会话级开启参数 MONITOR_SQL_EXEC=1，而 MONITOR_SQL_EXEC 在达梦数据库中一般默认是 1，无需调整。</span>
<span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> <span class="token string">'MONITOR_SQL_EXEC'</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">-- 2. &lt;执行待优化SQL&gt;</span>
<span class="token comment">-- 3. 查看执行计划</span>
<span class="token keyword">select</span> DBMS_SQLTUNE<span class="token punctuation">.</span>REPORT_SQL_MONITOR<span class="token punctuation">(</span>SQL_EXEC_ID<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token number">1213701</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
</code></pre></div><h3 id="hints"><a href="#hints" class="header-anchor">#</a> Hints</h3> <p>DM 查询优化器采用基于代价的方法。在估计代价时，主要以统计信息或者普遍的数据分布为依据。在大多数情况下，估计的代价都是准确的。但在一些比较特殊的场合，例如缺少统计信息，或统计信息陈旧，或抽样数据不能很好地反映数据分布时，优化器选择的执行计划不是“最优”的，甚至可能是很差的执行计划。<br>
如果 HINT 的语法没有写对或指定的值不正确，DM 并不会报错，而是直接忽略 HINT 继续执行。</p> <h4 id="ini-参数提示"><a href="#ini-参数提示" class="header-anchor">#</a> INI 参数提示</h4> <p>支持使用 HINT 的 INI 参数可通过 V$HINT_INI_INFO 动态视图查询。支持 HINT 的 INI 参数分为两类：一是 HINT_TYPE 为“OPT”，表示分析阶段使用的参数；二是 HINT_TYPE 为“EXEC”，表示运行阶段使用的参数，运行阶段使用的参数对于视图无效。</p> <ul><li>例：<code>SELECT /*+ENABLE_HASH_JOIN(1)*/ * FROM T1,T2 WHERE C1=D1;</code></li></ul> <h4 id="索引提示"><a href="#索引提示" class="header-anchor">#</a> 索引提示</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 使用索引(如果查询中给出了表的别名那么必须使用别名)：</span>
<span class="token comment">/*+ INDEX (表名[,] 索引名) {INDEX (表名[,] 索引名)} */</span>

<span class="token comment">-- 不使用索引：</span>
<span class="token comment">/*+ NO_INDEX (表名[,] 索引名) { NO_INDEX (表名[,] 索引名)} */</span>


</code></pre></div><h4 id="连接方法提示"><a href="#连接方法提示" class="header-anchor">#</a> 连接方法提示</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 强制两个表间使用指定顺序的哈希连接</span>
<span class="token comment">/*+ USE_HASH(T1, T2) */</span>

<span class="token comment">-- 强制两个表间不能使用指定顺序的哈希连接</span>
<span class="token comment">/*+ NO_USE_HASH(T1, T2) */</span>

<span class="token comment">-- 强制两个表间使用嵌套循环连接</span>
<span class="token comment">/*+ USE_NL(A, B) */</span>

<span class="token comment">-- 强制两个表间不能使用嵌套循环连接</span>
<span class="token comment">/*+ NO_USE_NL(A, B) */</span>

<span class="token comment">-- 当连接情况为左表 + 右表索引时，强制两个表间使用索引连接</span>
<span class="token comment">/*+ USE_NL_WITH_INDEX(T1, IDX_T2_ID) */</span>

<span class="token comment">-- 当连接情况为左表 + 右表索引时，强制两个表间不能使用索引连接</span>
<span class="token comment">/*+ NO_USE_NL_WITH_INDEX(T1, IDX_T2_ID) */</span>

<span class="token comment">-- 强制两个表间使用归并连接。归并连接所用的两个列都必须是索引列。</span>
<span class="token comment">/*+ USE_MERGE(T1,T2) */</span>

<span class="token comment">-- 强制两个表间不能使用归并连接</span>
<span class="token comment">/*+ NO_USE_MERGE(T1,T2) */</span>

<span class="token comment">-- 优先采用半连接转换为等价的内连接，仅 OPTIMIZER_MODE=1 有效。</span>
<span class="token comment">/*+ SEMI_GEN_CROSS  OPTIMIZER_MODE(1) */</span>

<span class="token comment">-- 不采用半连接转换为等价的内连接，仅 OPTIMIZER_MODE=1 有效。</span>
<span class="token comment">/*+ NO_SEMI_GEN_CROSS  OPTIMIZER_MODE(1) */</span>

<span class="token comment">-- 优先采用变量改写方式实现连接，适合驱动表数据量少而另一侧计划较复杂的场景，目前支持变量改写的连接方式有 NEST LOOP INNER JOIN2、NEST LOOP LEFT JOIN2、NEST LOOP SEMI JOIN2，仅 OPTIMIZER_MODE=1 有效。</span>
<span class="token comment">/*+ USE_CVT_VAR OPTIMIZER_MODE(1) */</span>

<span class="token comment">-- 不考虑变量改写方式实现连接，仅 OPTIMIZER_MODE=1 有效。</span>
<span class="token comment">/*+ NO_USE_CVT_VAR OPTIMIZER_MODE(1) */</span>

<span class="token comment">-- 一般情况下，归并连接需要左右孩子的数据按照连接列有序，使用此优化器提示时，优化器将考虑通过插入排序操作符的方式实现归并连接，仅 OPTIMIZER_MODE=1 有效。</span>
<span class="token comment">/*+ENHANCED_MERGE_JOIN OPTIMIZER_MODE(1) stat(T1 1M) stat(T2 1M) */</span>

</code></pre></div><h4 id="连接顺序提示"><a href="#连接顺序提示" class="header-anchor">#</a> 连接顺序提示</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 多表连接时优化器会考虑各种可能的排列组合顺序。使用 ORDER HINT 指定连接顺序提示可以缩小优化器试探的排列空间，进而得到接近 DBA 所期望的查询计划。如果连接顺序和连接方法提示同时指定且二者间存在自相矛盾，优化器会以连接顺序提示为准。</span>
<span class="token comment">/*+ ORDER (T1, T2 , T3, … tn ) */</span>

<span class="token comment">/*
如果期望表的连接顺序是 T1, T2, T3，那么可以加入这样的提示：
SELECT /*+ ORDER(T1, T2, T3 )*/</span><span class="token operator">*</span> <span class="token keyword">FROM</span> T1<span class="token punctuation">,</span> T2 <span class="token punctuation">,</span> T3<span class="token punctuation">,</span> T4 <span class="token keyword">WHERE</span> …
在指定上述连接顺序后，T4<span class="token punctuation">,</span>T1<span class="token punctuation">,</span>T2<span class="token punctuation">,</span>T3 或 T1<span class="token punctuation">,</span>T2<span class="token punctuation">,</span>T4<span class="token punctuation">,</span>T3 会被考虑；T3<span class="token punctuation">,</span>T1<span class="token punctuation">,</span>T2 或 T1<span class="token punctuation">,</span>T3<span class="token punctuation">,</span>T2 不被考虑。
<span class="token operator">*</span><span class="token operator">/</span>

<span class="token comment">-- 更特定的执行计划</span>
<span class="token comment">-- EXPLAIN SELECT /*+ OPTIMIZER_MODE(1), ORDER(T1,T2,T3,T4) ,USE_HASH(T1,T2), USE_HASH(T2,T3), USE_HASH(T3,T4)*/* FROM T1,T2,T3,T4 WHERE T1.c1=T2.d1 AND T2.d2 = T3.e2 AND T3.e1 = T4.f1;</span>
</code></pre></div><h4 id="统计信息提示"><a href="#统计信息提示" class="header-anchor">#</a> 统计信息提示</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 统计信息提示只能针对基表设置，视图和派生表等对象设置无效。如果表对象存在别名则必须使用别名。行数只能使用整数，或者整数 +K（千），整数 +M（百万），整数 +G（十亿）。行数提示设置后，统计信息的其它内容也会做相应的调整。</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">+</span> STAT <span class="token punctuation">(</span>表名<span class="token punctuation">,</span> 行数<span class="token punctuation">)</span> <span class="token operator">*</span>
</code></pre></div><h4 id="其他-hint"><a href="#其他-hint" class="header-anchor">#</a> 其他 Hint</h4> <p><strong>MPP 本地对象提示</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- MPP 环境下，提供一种将用户表或动态视图作为本地对象处理的方法，通过指示符 LOCAL_OBJECT(对象名/别名) 进行处理。</span>
<span class="token comment">-- 对于系统表当做本地对象的处理，本方法不适用，系统表只能在主站点才能做本地对象处理。</span>
<span class="token comment">/*+ LOCAL_OBJECT(对象名/别名) */</span>
</code></pre></div><p><strong>忽略重复键值提示</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 当执行 INSERT 操作时，如果存在 UNIQUE 索引，那么发生了重复键值冲突。使用 HINT IGNORE_ROW_ON_DUPKEY_INDEX 则可以忽略该冲突，冲突数据既不进行插入也不会报错，其他非冲突插入正常进行。</span>
<span class="token comment">/*+IGNORE_ROW_ON_DUPKEY_INDEX(&lt;表名&gt; [(&lt;列名&gt;{,&lt;列名&gt;})])*/</span>
</code></pre></div><p><strong>禁用计划缓存提示</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 使用 HINT PLAN_NO_CACHE 禁用计划缓存，当前语句的执行计划将不会被缓存。</span>
<span class="token comment">/*+PLAN_NO_CACHE*/</span>
</code></pre></div><p><strong>DMDPC 数据分发方式提示</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code>DMDPC 环境下提供了一种专门针对指定的连接、分组、排序、去重和分析函数操作符数据分发方式进行人工干预的优化器提示。该提示被采纳的前提是指定的分发路径有效，因为代价原因没有被优化器选中。
<span class="token comment">/*+DPC(分发方式探测序号 分发方式字符串)*/</span>
</code></pre></div><h2 id="dts-迁移"><a href="#dts-迁移" class="header-anchor">#</a> DTS 迁移</h2> <h4 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h4> <ol><li><strong>一定要用新版本DTS工具，旧版本一堆坑</strong></li> <li>如果允许的话，迁移表勾选已存在的先删除表再创建（绕过奇奇怪怪的报错）</li> <li>数据库区分大小写时，是否有字段名转大写的选项（去掉 保持对象名大小写 的勾选）</li> <li>表已存在且不能删表时：一定要先禁用触发器、索引等（Oracle不能禁用唯一索引，DM不知道能行不）</li> <li>报错：数据迁移 A 模式时报 B 模式主键冲突；原因可能是有 A 模式同步到 B 模式的触发器</li></ol> <h2 id="常用sql"><a href="#常用sql" class="header-anchor">#</a> 常用SQL</h2> <h4 id="博客"><a href="#博客" class="header-anchor">#</a> 博客</h4> <p><a href="https://mp.weixin.qq.com/s/kQ93CD6oRivs6haQecchqg" target="_blank" rel="noopener noreferrer">达梦8数据库运维常用基础sql<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="新建用户及表空间"><a href="#新建用户及表空间" class="header-anchor">#</a> 新建用户及表空间</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 表空间文件</span>
<span class="token keyword">create</span> <span class="token keyword">tablespace</span> user_name datafile <span class="token string">'/data/dmdata/DAMENG/user_name.DBF'</span> size <span class="token number">61952</span> autoextend <span class="token keyword">on</span> <span class="token keyword">next</span> <span class="token number">512</span> maxsize <span class="token number">67108863</span> CACHE <span class="token operator">=</span> NORMAL<span class="token punctuation">;</span>  <span class="token comment">-- 最大64TB</span>
<span class="token comment">-- 创建用户模式</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> user_name IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&quot;PASSWD&quot;</span>
  <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> user_name
  <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token keyword">TEMP</span>
  QUOTA UNLIMITED <span class="token keyword">ON</span> user_name<span class="token punctuation">;</span>
<span class="token comment">-- 授权</span>
<span class="token keyword">GRANT</span> DBA <span class="token keyword">TO</span> user_name<span class="token punctuation">;</span>


<span class="token keyword">DROP</span> <span class="token keyword">USER</span> 用户名 <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>  <span class="token comment">-- 强制删除用户及其所有对象</span>
<span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span> SEGMENT_TYPE <span class="token keyword">FROM</span> DBA_SEGMENTS <span class="token keyword">WHERE</span> TABLESPACE_NAME <span class="token operator">=</span> <span class="token string">'表空间名'</span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLESPACE</span> 表空间名 <span class="token punctuation">;</span>
</code></pre></div><h3 id="元数据获取"><a href="#元数据获取" class="header-anchor">#</a> 元数据获取</h3> <h4 id="常用系统视图"><a href="#常用系统视图" class="header-anchor">#</a> 常用系统视图</h4> <p><code>v$dynamic_tables</code> 可以获取所有动态视图</p> <div class="language-sql extra-class"><pre class="language-sql"><code>user_tables  <span class="token comment">-- dba_tables</span>
user_tab_columns
user_indexes
<span class="token comment">-- 查看系统中的作业信息</span>
<span class="token keyword">select</span> t<span class="token punctuation">.</span>job<span class="token punctuation">,</span> t<span class="token punctuation">.</span>schema_user<span class="token punctuation">,</span> t<span class="token punctuation">.</span>last_date<span class="token punctuation">,</span> t<span class="token punctuation">.</span>last_sec<span class="token punctuation">,</span> t<span class="token punctuation">.</span>next_date<span class="token punctuation">,</span> t<span class="token punctuation">.</span>next_sec<span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token string">&quot;INTERVAL&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>broken<span class="token punctuation">,</span> t<span class="token punctuation">.</span>failures<span class="token punctuation">,</span>t<span class="token punctuation">.</span>what <span class="token keyword">from</span> dba_jobs t<span class="token punctuation">;</span>
<span class="token comment">-- 查询数据库实例启动状态</span>
<span class="token keyword">select</span> name<span class="token punctuation">,</span> <span class="token keyword">status</span>$ <span class="token keyword">from</span> v$instance<span class="token punctuation">;</span>
<span class="token comment">-- 查询license信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> V$LICENSE<span class="token punctuation">;</span>
<span class="token comment">-- 查询系统函数及其参数</span>
<span class="token keyword">select</span> a<span class="token punctuation">.</span>name<span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> v$ifun a<span class="token punctuation">,</span> v$ifun_arg b <span class="token keyword">where</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>id <span class="token operator">and</span> a<span class="token punctuation">.</span>name <span class="token operator">like</span> <span class="token string">'SF_ARCHIVELOG_%'</span><span class="token punctuation">;</span>  <span class="token comment">--系统函数名</span>
<span class="token comment">-- 查询函数/存储过程/包源码信息</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBA_SOURCE t <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'P_TEST'</span><span class="token punctuation">;</span>  <span class="token comment">--查询对象名</span>
</code></pre></div><p><strong>触发器</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> DBA_TRIGGERS <span class="token keyword">where</span> owner <span class="token operator">=</span> <span class="token string">'xxx'</span> <span class="token operator">and</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">'xxx'</span><span class="token punctuation">;</span>

<span class="token comment">-- 禁用启用触发器</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> 触发器名称 <span class="token keyword">DISABLE</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> 触发器名称 <span class="token keyword">ENABLE</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="建表语句获取"><a href="#建表语句获取" class="header-anchor">#</a> 建表语句获取</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'TABLE'</span><span class="token punctuation">,</span> <span class="token string">'表名'</span><span class="token punctuation">,</span> <span class="token string">'模式名'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>

<span class="token comment">-- 未使用，理论上没问题，不知道是否有错误的地方</span>
<span class="token keyword">WITH</span> <span class="token keyword">TABLES</span> <span class="token keyword">AS</span>
 <span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLE_NAME <span class="token keyword">AS</span> T_NAME<span class="token punctuation">,</span> OWNER
    <span class="token keyword">FROM</span> DBA_TABLES
   <span class="token keyword">WHERE</span> OWNER <span class="token operator">=</span> <span class="token string">'OWNER'</span>
     <span class="token operator">AND</span> TABLE_NAME <span class="token operator">=</span> <span class="token string">'TABLE_NAME'</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> SUB<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span>
       LISTAGG<span class="token punctuation">(</span>SQL_PART<span class="token punctuation">,</span> CHR<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">WITHIN</span> <span class="token keyword">GROUP</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SUB<span class="token punctuation">.</span>FLAG<span class="token punctuation">)</span> <span class="token keyword">AS</span> FULL_DDL
  <span class="token keyword">FROM</span> <span class="token punctuation">(</span>
        <span class="token comment">-- 表定义</span>
        <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">AS</span> FLAG<span class="token punctuation">,</span>
                T<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span>
                DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'TABLE'</span><span class="token punctuation">,</span> T<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span> T<span class="token punctuation">.</span>OWNER<span class="token punctuation">)</span> <span class="token operator">||</span> CHR<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> SQL_PART
          <span class="token keyword">FROM</span> <span class="token keyword">TABLES</span> T
        <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
        <span class="token comment">-- 表注释</span>
        <span class="token keyword">SELECT</span> <span class="token number">2</span> <span class="token keyword">AS</span> FLAG<span class="token punctuation">,</span>
                T<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span>
                <span class="token string">'COMMENT ON TABLE '</span> <span class="token operator">||</span> T<span class="token punctuation">.</span>T_NAME <span class="token operator">||</span> <span class="token string">' IS '''</span> <span class="token operator">||</span> TC<span class="token punctuation">.</span>COMMENTS <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">AS</span> SQL_PART
          <span class="token keyword">FROM</span> <span class="token keyword">TABLES</span> T
          <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ALL_TAB_COMMENTS TC
            <span class="token keyword">ON</span> TC<span class="token punctuation">.</span>TABLE_NAME <span class="token operator">=</span> T<span class="token punctuation">.</span>T_NAME
           <span class="token operator">AND</span> TC<span class="token punctuation">.</span>OWNER <span class="token operator">=</span> T<span class="token punctuation">.</span>OWNER
         <span class="token keyword">WHERE</span> TC<span class="token punctuation">.</span>COMMENTS <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
        <span class="token comment">-- 字段注释</span>
        <span class="token keyword">SELECT</span> <span class="token number">3</span> <span class="token keyword">AS</span> FLAG<span class="token punctuation">,</span>
                T<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span>
                <span class="token string">'COMMENT ON COLUMN '</span> <span class="token operator">||</span> T<span class="token punctuation">.</span>T_NAME <span class="token operator">||</span> <span class="token string">'.'</span> <span class="token operator">||</span> CC<span class="token punctuation">.</span>COLUMN_NAME <span class="token operator">||</span> <span class="token string">' IS '''</span> <span class="token operator">||</span> CC<span class="token punctuation">.</span>COMMENTS <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">AS</span> SQL_PART
          <span class="token keyword">FROM</span> <span class="token keyword">TABLES</span> T
          <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ALL_COL_COMMENTS CC
            <span class="token keyword">ON</span> CC<span class="token punctuation">.</span>TABLE_NAME <span class="token operator">=</span> T<span class="token punctuation">.</span>T_NAME
           <span class="token operator">AND</span> CC<span class="token punctuation">.</span>OWNER <span class="token operator">=</span> T<span class="token punctuation">.</span>OWNER
         <span class="token keyword">WHERE</span> CC<span class="token punctuation">.</span>COMMENTS <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
        <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
        <span class="token comment">-- 索引定义</span>
        <span class="token keyword">SELECT</span> <span class="token number">4</span> <span class="token keyword">AS</span> FLAG<span class="token punctuation">,</span>
                T<span class="token punctuation">.</span>T_NAME<span class="token punctuation">,</span>
                DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'INDEX'</span><span class="token punctuation">,</span> I<span class="token punctuation">.</span>INDEX_NAME<span class="token punctuation">,</span> T<span class="token punctuation">.</span>OWNER<span class="token punctuation">)</span> <span class="token keyword">AS</span> SQL_PART
          <span class="token keyword">FROM</span> <span class="token keyword">TABLES</span> T
          <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> ALL_INDEXES I
            <span class="token keyword">ON</span> I<span class="token punctuation">.</span>TABLE_NAME <span class="token operator">=</span> T<span class="token punctuation">.</span>T_NAME
           <span class="token operator">AND</span> I<span class="token punctuation">.</span>TABLE_OWNER <span class="token operator">=</span> T<span class="token punctuation">.</span>OWNER
         <span class="token keyword">WHERE</span> I<span class="token punctuation">.</span>INDEX_TYPE <span class="token operator">=</span> <span class="token string">'NORMAL'</span>
           <span class="token operator">AND</span> I<span class="token punctuation">.</span>UNIQUENESS <span class="token operator">=</span> <span class="token string">'NONUNIQUE'</span><span class="token punctuation">)</span> SUB
 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> SUB<span class="token punctuation">.</span>T_NAME<span class="token punctuation">;</span>
</code></pre></div><h4 id="查询表空间占用率"><a href="#查询表空间占用率" class="header-anchor">#</a> 查询表空间占用率</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> b<span class="token punctuation">.</span>file_name<span class="token punctuation">,</span>
       b<span class="token punctuation">.</span>tablespace_name<span class="token punctuation">,</span>
       b<span class="token punctuation">.</span>bytes<span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> size_m<span class="token punctuation">,</span>
       <span class="token punctuation">(</span>b<span class="token punctuation">.</span>bytes<span class="token operator">-</span><span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>a<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span>  used_m<span class="token punctuation">,</span>
       <span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>bytes<span class="token operator">-</span><span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>a<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  usedrate
  <span class="token keyword">from</span> dba_free_space a<span class="token punctuation">,</span>dba_data_files b
 <span class="token keyword">where</span> a<span class="token punctuation">.</span>file_id<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>file_id
   <span class="token operator">and</span> a<span class="token punctuation">.</span>tablespace_name<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> b<span class="token punctuation">.</span>tablespace_name
 <span class="token keyword">order</span> <span class="token keyword">by</span> b<span class="token punctuation">.</span>tablespace_name<span class="token punctuation">;</span>
</code></pre></div><h4 id="查看单表-索引-占用空间"><a href="#查看单表-索引-占用空间" class="header-anchor">#</a> 查看单表（索引）占用空间</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- user_segments </span>
<span class="token comment">-- dba_segments</span>
<span class="token keyword">select</span>  t<span class="token punctuation">.</span>segment_name<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>segment_type<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>tablespace_name<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>owner<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>bytes<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>bytes<span class="token operator">/</span><span class="token number">1024</span> byte_kb<span class="token punctuation">,</span>
       t<span class="token punctuation">.</span>bytes<span class="token operator">/</span><span class="token number">1024</span> byte_mb
  <span class="token keyword">from</span> dba_segments t
 <span class="token keyword">where</span> t<span class="token punctuation">.</span>owner <span class="token operator">=</span> <span class="token string">'DMHR'</span>   <span class="token comment">-- 用户/模式名 </span>
   <span class="token operator">and</span> t<span class="token punctuation">.</span>SEGMENT_TYPE <span class="token operator">=</span> <span class="token string">'TABLE'</span>  <span class="token comment">-- 'INDEX'</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>bytes <span class="token keyword">desc</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="查看达梦数据库是否是集群"><a href="#查看达梦数据库是否是集群" class="header-anchor">#</a> 查看达梦数据库是否是集群</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$instance<span class="token punctuation">;</span>    <span class="token comment">-- MODE$为STANDBY/PRIMARY是 数据守护集群，否则普通单机或DSC集群</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$dsc_ep_info<span class="token punctuation">;</span>   <span class="token comment">-- 返回空  则不是dsc集群</span>
</code></pre></div><h4 id="查看模式和用户对应关系"><a href="#查看模式和用户对应关系" class="header-anchor">#</a> 查看模式和用户对应关系</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> a<span class="token punctuation">.</span>NAME schname<span class="token punctuation">,</span> a<span class="token punctuation">.</span>ID schid<span class="token punctuation">,</span> b<span class="token punctuation">.</span>id userid<span class="token punctuation">,</span> b<span class="token punctuation">.</span>NAME username
  <span class="token keyword">from</span> sysobjects a<span class="token punctuation">,</span> sysobjects b
<span class="token keyword">where</span> a<span class="token punctuation">.</span><span class="token string">&quot;TYPE$&quot;</span><span class="token operator">=</span><span class="token string">'SCH'</span>
  <span class="token operator">and</span> a<span class="token punctuation">.</span>pid <span class="token operator">=</span> b<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre></div><h3 id="问题排查"><a href="#问题排查" class="header-anchor">#</a> 问题排查</h3> <h4 id="查询锁表-杀会话"><a href="#查询锁表-杀会话" class="header-anchor">#</a> 查询锁表 &amp; 杀会话</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询锁表</span>
<span class="token keyword">SELECT</span> obs<span class="token punctuation">.</span>OBJECT_NAME<span class="token punctuation">,</span> ob<span class="token punctuation">.</span>OBJECT_ID<span class="token punctuation">,</span> ob<span class="token punctuation">.</span>SESSION_ID<span class="token punctuation">,</span> ob<span class="token punctuation">.</span>USERNAME
  <span class="token keyword">FROM</span> V$LOCKED_OBJECT ob
  <span class="token keyword">JOIN</span> DBA_OBJECTS obs
    <span class="token keyword">ON</span> ob<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">=</span> obs<span class="token punctuation">.</span>OBJECT_ID
 <span class="token keyword">WHERE</span> obs<span class="token punctuation">.</span>OBJECT_TYPE <span class="token operator">=</span> <span class="token string">'TABLE'</span><span class="token punctuation">;</span>

<span class="token comment">-- 终止会话</span>
SP_CLOSE_SESSION<span class="token punctuation">(</span>SESS_ID<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 替换为实际会话ID</span>

<span class="token comment">-- 查询正在执行的SQL</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$sessions <span class="token keyword">where</span> state <span class="token operator">=</span> <span class="token string">'ACTIVE'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询阻塞</span>
<span class="token keyword">SELECT</span> DS<span class="token punctuation">.</span>SESS_ID     <span class="token string">&quot;被阻塞的会话ID&quot;</span><span class="token punctuation">,</span>
       DS<span class="token punctuation">.</span>SQL_TEXT    <span class="token string">&quot;被阻塞的SQL&quot;</span><span class="token punctuation">,</span>
       DS<span class="token punctuation">.</span>TRX_ID      <span class="token string">&quot;被阻塞的事务ID&quot;</span><span class="token punctuation">,</span>
       DS<span class="token punctuation">.</span>CREATE_TIME <span class="token string">&quot;开始阻塞时间&quot;</span><span class="token punctuation">,</span>
       SS<span class="token punctuation">.</span>SESS_ID     <span class="token string">&quot;占用锁的会话ID&quot;</span><span class="token punctuation">,</span>
       SS<span class="token punctuation">.</span>SQL_TEXT    <span class="token string">&quot;占用锁的SQL&quot;</span><span class="token punctuation">,</span>
       SS<span class="token punctuation">.</span>CLNT_IP     <span class="token string">&quot;占用锁的IP&quot;</span><span class="token punctuation">,</span>
       L<span class="token punctuation">.</span>wait_for_id  <span class="token string">&quot;占用锁的事务ID&quot;</span>
  <span class="token keyword">FROM</span> v$trxwait L
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> V$SESSIONS DS
    <span class="token keyword">ON</span> DS<span class="token punctuation">.</span>TRX_ID <span class="token operator">=</span> L<span class="token punctuation">.</span>ID
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> V$SESSIONS SS
    <span class="token keyword">ON</span> SS<span class="token punctuation">.</span>TRX_ID <span class="token operator">=</span> L<span class="token punctuation">.</span>wait_for_id<span class="token punctuation">;</span>
</code></pre></div><h4 id="查询实例中已执行未提交的-sql"><a href="#查询实例中已执行未提交的-sql" class="header-anchor">#</a> 查询实例中已执行未提交的 SQL</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> t1<span class="token punctuation">.</span>sess_id<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>sql_text<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>state<span class="token punctuation">,</span> t1<span class="token punctuation">.</span>trx_id
<span class="token keyword">FROM</span> v$sessions t1<span class="token punctuation">,</span> v$trx t2
<span class="token keyword">WHERE</span> t1<span class="token punctuation">.</span>trx_id <span class="token operator">=</span> t2<span class="token punctuation">.</span>id
  <span class="token operator">AND</span> t1<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'IDLE'</span>
  <span class="token operator">AND</span> t2<span class="token punctuation">.</span><span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'ACTIVE'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="查询表上的锁"><a href="#查询表上的锁" class="header-anchor">#</a> 查询表上的锁</h4> <ol><li><strong>无锁（LOCK_MODE=0）</strong><br>
表示当前未对资源加锁，仅作为锁状态标识存在。</li> <li><strong>共享锁（S锁，LOCK_MODE=1）</strong> <ul><li>允许其他事务读取被锁资源，但禁止修改。</li> <li>适用于读多写少的场景，如 <code>SELECT ... LOCK IN SHARE MODE</code>。</li></ul></li> <li><strong>排他锁（X锁，LOCK_MODE=2）</strong> <ul><li>禁止其他事务读写被锁资源，仅当前事务可修改。</li> <li>常用于数据更新操作（如 <code>UPDATE</code>、<code>DELETE</code>）。</li></ul></li> <li><strong>意向共享锁（IS锁，LOCK_MODE=3）</strong> <ul><li><strong>表级锁</strong>，表示事务计划在表中某些行上添加共享锁（S锁）。</li> <li>作用：通过提前声明意向，避免其他事务对表结构进行不兼容操作（如加X锁）。</li></ul></li> <li><strong>意向排他锁（IX锁，LOCK_MODE=4）</strong> <ul><li><strong>表级锁</strong>，表示事务计划在表中某些行上添加排他锁（X锁）。</li> <li>作用：与IS锁类似，但用于更高粒度的排他操作声明，例如批量更新前的预检测。</li></ul></li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> V$<span class="token keyword">LOCK</span>
<span class="token keyword">WHERE</span> TABLE_ID <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> OBJECT_ID
                   <span class="token keyword">FROM</span> DBA_OBJECTS
                   <span class="token keyword">WHERE</span> OWNER <span class="token operator">=</span> <span class="token string">'OWNER'</span>
                     <span class="token operator">AND</span> OBJECT_NAME <span class="token operator">=</span> <span class="token string">'OBJECT_NAME'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="批量禁用某个用户-模式下所有外键约束"><a href="#批量禁用某个用户-模式下所有外键约束" class="header-anchor">#</a> 批量禁用某个用户/模式下所有外键约束</h4> <p>其他索引应该能以同样方式拼接禁用语句</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token string">'alter table '</span><span class="token operator">||</span> t<span class="token punctuation">.</span>owner<span class="token operator">||</span><span class="token string">'.'</span><span class="token operator">||</span>t<span class="token punctuation">.</span>table_name <span class="token operator">||</span><span class="token string">' disable constraint '</span><span class="token operator">||</span>t<span class="token punctuation">.</span>constraint_name<span class="token operator">||</span><span class="token string">';'</span>
  <span class="token keyword">from</span> dba_constraints t
 <span class="token keyword">where</span> t<span class="token punctuation">.</span>owner <span class="token operator">=</span> <span class="token string">'DMHR'</span>   <span class="token comment">-- 用户/模式名</span>
   <span class="token operator">and</span> t<span class="token punctuation">.</span>constraint_type <span class="token operator">=</span> <span class="token string">'R'</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="用户锁定-解锁"><a href="#用户锁定-解锁" class="header-anchor">#</a> 用户锁定/解锁</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查询系统中锁定的用户及对应的锁定时间：</span>
<span class="token keyword">select</span> t<span class="token punctuation">.</span>username<span class="token punctuation">,</span> 
       t<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> 
       t<span class="token punctuation">.</span>account_status<span class="token punctuation">,</span> 
       t<span class="token punctuation">.</span>lock_date
  <span class="token keyword">from</span> dba_users t
 <span class="token keyword">where</span> t<span class="token punctuation">.</span>account_status <span class="token operator">=</span> <span class="token string">'LOCKED'</span><span class="token punctuation">;</span>

<span class="token comment">-- 对于被锁定的用户，可以使用SYSDBA或者具有alter user权限的用户解锁。</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> hruser ACCOUNT <span class="token keyword">UNLOCK</span><span class="token punctuation">;</span>   <span class="token comment">--解锁用户</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> hruser ACCOUNT <span class="token keyword">LOCK</span><span class="token punctuation">;</span>      <span class="token comment">--锁定某用户</span>
</code></pre></div><h2 id="faq"><a href="#faq" class="header-anchor">#</a> FAQ</h2> <h4 id="大数据量表加字段慢"><a href="#大数据量表加字段慢" class="header-anchor">#</a> 大数据量表加字段慢</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">1.</span> <span class="token keyword">select</span> SF_GET_SESSION_PARA_VALUE <span class="token punctuation">(</span><span class="token string">'ALTER_TABLE_OPT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">-- 查询会话参数</span>
<span class="token number">2.</span> <span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> <span class="token string">'ALTER_TABLE_OPT'</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">PURGE</span><span class="token punctuation">;</span>    <span class="token comment">-- 修改会话参数</span>
<span class="token number">3.</span> <span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> <span class="token string">'ALTER_TABLE_OPT'</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">PURGE</span><span class="token punctuation">;</span>    <span class="token comment">-- 恢复会话参数（将0替换为第1步所查询参数）</span>
</code></pre></div></div></div> <div class="page-slot page-slot-bottom">
  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .pageB img{width:80px!important;}
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}
  </style>
  </div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/user-h/hdata-doc/edit/master/docs/03.数据库/06.国产数据库/03.达梦数据库.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/04/09, 14:11:14</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/hdata-doc/pages/36476d/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL琐碎知识点</div></a> <a href="/hdata-doc/pages/e461e3/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">华为高斯数据库</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/hdata-doc/pages/36476d/" class="prev">MySQL琐碎知识点</a></span> <span class="next"><a href="/hdata-doc/pages/e461e3/">华为高斯数据库</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:1033078928@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/user-h" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/aihb" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://music.163.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://bilibili.com" title="哔哩哔哩" target="_blank" class="iconfont icon-bilibili"></a><a href="https://douyin.com/" title="抖音" target="_blank" class="iconfont icon-douyin"></a><a href="" title="猫咪" target="_blank" class="iconfont icon-mao"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2025
    <span>Ai | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 10px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"></div></div>
    <script src="/hdata-doc/assets/js/app.37e4fbb6.js" defer></script><script src="/hdata-doc/assets/js/2.82afd9cb.js" defer></script><script src="/hdata-doc/assets/js/9.c7938acd.js" defer></script>
  </body>
</html>
